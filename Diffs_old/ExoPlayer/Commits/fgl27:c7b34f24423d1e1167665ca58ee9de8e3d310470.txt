diff --git a/RELEASENOTES.md b/RELEASENOTES.md
index ef6eedbe1c..c90129e7ba 100644
--- a/RELEASENOTES.md
+++ b/RELEASENOTES.md
@@ -2,6 +2,12 @@
 
 ### dev-v2 (not yet released) ###
 
+* Add `DataSpec.httpRequestHeaders` to set HTTP request headers when connecting
+  to an HTTP source. `DefaultHttpDataSource`, `CronetDataSource` and
+  `OkHttpDataSource` include headers set in the DataSpec when connecting to the
+  source.
+* Bypass sniffing in `ProgressiveMediaPeriod` in case a single extractor is
+  provided ([#6325](https://github.com/google/ExoPlayer/issues/6325)).
 * Surface information provided by methods `isHardwareAccelerated`,
   `isSoftwareOnly` and `isVendor` added in Android Q in `MediaCodecInfo` class
   ([#5839](https://github.com/google/ExoPlayer/issues/5839)).
@@ -56,6 +62,8 @@
   [#4249](https://github.com/google/ExoPlayer/issues/4249),
   [#4319](https://github.com/google/ExoPlayer/issues/4319),
   [#4337](https://github.com/google/ExoPlayer/issues/4337)).
+* Publish `testutils` module to simplify unit testing with ExoPlayer
+  ([#6267](https://github.com/google/ExoPlayer/issues/6267)).
 
 ### 2.10.4 ###
 
diff --git a/constants.gradle b/constants.gradle
index 8dd7ed589d..c3085a963a 100644
--- a/constants.gradle
+++ b/constants.gradle
@@ -26,10 +26,13 @@ project.ext {
     checkerframeworkVersion = '2.11.0'
     checkerframeworkVersionC = '2.5.5'
     jsr305Version = '3.0.2'
-    kotlinAnnotationsVersion = '1.3.50'
-    androidXTestVersion = '1.2.0'
+    kotlinAnnotationsVersion = '1.3.31'
+    androidxAnnotationVersion = '1.1.0'
+    androidxCollectionVersion = '1.1.0'
+    androidxMediaVersion = '1.0.1'
+    androidxTestVersion = '1.2.0'
     androidXTestVersionJ = '1.1.1'
-    truthVersion = '1.0'
+    truthVersion = '0.44'
     modulePrefix = ':'
     if (gradle.ext.has('exoplayerModulePrefix')) {
         modulePrefix += gradle.ext.exoplayerModulePrefix
diff --git a/demos/cast/build.gradle b/demos/cast/build.gradle
index 60b9cdbc4e..ea058d95d4 100644
--- a/demos/cast/build.gradle
+++ b/demos/cast/build.gradle
@@ -57,7 +57,6 @@ dependencies {
     implementation project(modulePrefix + 'library-ui')
     implementation project(modulePrefix + 'extension-cast')
     implementation 'androidx.appcompat:appcompat:1.0.2'
-    implementation 'androidx.legacy:legacy-support-v4:1.0.0'
     implementation 'androidx.recyclerview:recyclerview:1.0.0'
     implementation 'com.google.android.material:material:1.0.0'
 }
diff --git a/demos/gvr/build.gradle b/demos/gvr/build.gradle
index 37d8fbbb99..96c699b2e6 100644
--- a/demos/gvr/build.gradle
+++ b/demos/gvr/build.gradle
@@ -53,7 +53,7 @@ dependencies {
     implementation project(modulePrefix + 'library-hls')
     implementation project(modulePrefix + 'library-smoothstreaming')
     implementation project(modulePrefix + 'extension-gvr')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
 }
 
 apply plugin: 'com.google.android.gms.strict-version-matcher-plugin'
diff --git a/demos/ima/build.gradle b/demos/ima/build.gradle
index 124555d9b5..289fa1dc83 100644
--- a/demos/ima/build.gradle
+++ b/demos/ima/build.gradle
@@ -53,7 +53,7 @@ dependencies {
     implementation project(modulePrefix + 'library-hls')
     implementation project(modulePrefix + 'library-smoothstreaming')
     implementation project(modulePrefix + 'extension-ima')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
 }
 
 apply plugin: 'com.google.android.gms.strict-version-matcher-plugin'
diff --git a/demos/main/build.gradle b/demos/main/build.gradle
index be08ca9ea2..06c734986c 100644
--- a/demos/main/build.gradle
+++ b/demos/main/build.gradle
@@ -62,7 +62,7 @@ android {
 }
 
 dependencies {
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     implementation 'com.google.android.material:material:1.0.0'
     implementation project(modulePrefix + 'library-core')
     implementation project(modulePrefix + 'library-dash')
diff --git a/extensions/cast/build.gradle b/extensions/cast/build.gradle
index 79f5c1f9ae..a17863ab01 100644
--- a/extensions/cast/build.gradle
+++ b/extensions/cast/build.gradle
@@ -32,7 +32,7 @@ android {
 
 dependencies {
     api 'com.google.android.gms:play-services-cast-framework:17.0.0'
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     implementation project(modulePrefix + 'library-core')
     implementation project(modulePrefix + 'library-ui')
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
diff --git a/extensions/cronet/build.gradle b/extensions/cronet/build.gradle
index 3851f6b45c..d5b7a99f96 100644
--- a/extensions/cronet/build.gradle
+++ b/extensions/cronet/build.gradle
@@ -33,7 +33,7 @@ android {
 dependencies {
     api 'org.chromium.net:cronet-embedded:76.3809.111'
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     testImplementation project(modulePrefix + 'library')
     testImplementation project(modulePrefix + 'testutils')
diff --git a/extensions/cronet/src/main/java/com/google/android/exoplayer2/ext/cronet/CronetDataSource.java b/extensions/cronet/src/main/java/com/google/android/exoplayer2/ext/cronet/CronetDataSource.java
index 241b879b9a..91bceb9aee 100644
--- a/extensions/cronet/src/main/java/com/google/android/exoplayer2/ext/cronet/CronetDataSource.java
+++ b/extensions/cronet/src/main/java/com/google/android/exoplayer2/ext/cronet/CronetDataSource.java
@@ -37,6 +37,7 @@
 import java.net.UnknownHostException;
 import java.nio.ByteBuffer;
 import java.util.Collections;
+import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 import java.util.Map.Entry;
@@ -54,7 +55,9 @@
 /**
  * DataSource without intermediate buffer based on Cronet API set using UrlRequest.
  *
- * <p>This class's methods are organized in the sequence of expected calls.
+ * <p>Note: HTTP request headers will be set using all parameters passed via (in order of decreasing
+ * priority) the {@code dataSpec}, {@link #setRequestProperty} and the default parameters used to
+ * construct the instance.
  */
 public class CronetDataSource extends BaseDataSource implements HttpDataSource {
 
@@ -685,22 +688,22 @@ protected UrlResponseInfo getCurrentUrlResponseInfo() {
         cronetEngine
             .newUrlRequestBuilder(dataSpec.uri.toString(), urlRequestCallback, executor)
             .allowDirectExecutor();
+
     // Set the headers.
-    boolean isContentTypeHeaderSet = false;
+    Map<String, String> requestHeaders = new HashMap<>();
     if (defaultRequestProperties != null) {
-      for (Entry<String, String> headerEntry : defaultRequestProperties.getSnapshot().entrySet()) {
-        String key = headerEntry.getKey();
-        isContentTypeHeaderSet = isContentTypeHeaderSet || CONTENT_TYPE.equals(key);
-        requestBuilder.addHeader(key, headerEntry.getValue());
-      }
+      requestHeaders.putAll(defaultRequestProperties.getSnapshot());
     }
-    Map<String, String> requestPropertiesSnapshot = requestProperties.getSnapshot();
-    for (Entry<String, String> headerEntry : requestPropertiesSnapshot.entrySet()) {
+    requestHeaders.putAll(requestProperties.getSnapshot());
+    requestHeaders.putAll(dataSpec.httpRequestHeaders);
+
+    for (Entry<String, String> headerEntry : requestHeaders.entrySet()) {
       String key = headerEntry.getKey();
-      isContentTypeHeaderSet = isContentTypeHeaderSet || CONTENT_TYPE.equals(key);
-      requestBuilder.addHeader(key, headerEntry.getValue());
+      String value = headerEntry.getValue();
+      requestBuilder.addHeader(key, value);
     }
-    if (dataSpec.httpBody != null && !isContentTypeHeaderSet) {
+
+    if (dataSpec.httpBody != null && !requestHeaders.containsKey(CONTENT_TYPE)) {
       throw new IOException("HTTP request with non-empty body must set Content-Type");
     }
     if (dataSpec.isFlagSet(DataSpec.FLAG_ALLOW_ICY_METADATA)) {
diff --git a/extensions/cronet/src/test/java/com/google/android/exoplayer2/ext/cronet/CronetDataSourceTest.java b/extensions/cronet/src/test/java/com/google/android/exoplayer2/ext/cronet/CronetDataSourceTest.java
index 2be369bad9..47f6fa7d2f 100644
--- a/extensions/cronet/src/test/java/com/google/android/exoplayer2/ext/cronet/CronetDataSourceTest.java
+++ b/extensions/cronet/src/test/java/com/google/android/exoplayer2/ext/cronet/CronetDataSourceTest.java
@@ -60,6 +60,7 @@
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.mockito.ArgumentMatchers;
 import org.mockito.Mock;
 import org.mockito.MockitoAnnotations;
 
@@ -95,6 +96,12 @@
   @Before
   public void setUp() {
     MockitoAnnotations.initMocks(this);
+
+    HttpDataSource.RequestProperties defaultRequestProperties =
+        new HttpDataSource.RequestProperties();
+    defaultRequestProperties.set("defaultHeader1", "defaultValue1");
+    defaultRequestProperties.set("defaultHeader2", "defaultValue2");
+
     dataSourceUnderTest =
         new CronetDataSource(
             mockCronetEngine,
@@ -103,7 +110,7 @@ public void setUp() {
             TEST_READ_TIMEOUT_MS,
             /* resetTimeoutOnRedirects= */ true,
             Clock.DEFAULT,
-            /* defaultRequestProperties= */ null,
+            defaultRequestProperties,
             /* handleSetCookieRequests= */ false);
     dataSourceUnderTest.addTransferListener(mockTransferListener);
     when(mockCronetEngine.newUrlRequestBuilder(
@@ -189,18 +196,59 @@ public void testRequestStartCalled() throws HttpDataSourceException {
   }
 
   @Test
-  public void testRequestHeadersSet() throws HttpDataSourceException {
+  public void testRequestSetsRangeHeader() throws HttpDataSourceException {
     testDataSpec = new DataSpec(Uri.parse(TEST_URL), 1000, 5000, null);
     mockResponseStartSuccess();
 
-    dataSourceUnderTest.setRequestProperty("firstHeader", "firstValue");
-    dataSourceUnderTest.setRequestProperty("secondHeader", "secondValue");
-
     dataSourceUnderTest.open(testDataSpec);
     // The header value to add is current position to current position + length - 1.
     verify(mockUrlRequestBuilder).addHeader("Range", "bytes=1000-5999");
-    verify(mockUrlRequestBuilder).addHeader("firstHeader", "firstValue");
-    verify(mockUrlRequestBuilder).addHeader("secondHeader", "secondValue");
+  }
+
+  @Test
+  public void testRequestHeadersSet() throws HttpDataSourceException {
+
+    Map<String, String> headersSet = new HashMap<>();
+    doAnswer(
+            (invocation) -> {
+              String key = invocation.getArgument(0);
+              String value = invocation.getArgument(1);
+              headersSet.put(key, value);
+              return null;
+            })
+        .when(mockUrlRequestBuilder)
+        .addHeader(ArgumentMatchers.anyString(), ArgumentMatchers.anyString());
+
+    dataSourceUnderTest.setRequestProperty("defaultHeader2", "dataSourceOverridesDefault");
+    dataSourceUnderTest.setRequestProperty("dataSourceHeader1", "dataSourceValue1");
+    dataSourceUnderTest.setRequestProperty("dataSourceHeader2", "dataSourceValue2");
+
+    Map<String, String> dataSpecRequestProperties = new HashMap<>();
+    dataSpecRequestProperties.put("defaultHeader3", "dataSpecOverridesAll");
+    dataSpecRequestProperties.put("dataSourceHeader2", "dataSpecOverridesDataSource");
+    dataSpecRequestProperties.put("dataSpecHeader1", "dataSpecValue1");
+    testDataSpec =
+        new DataSpec(
+            /* uri= */ Uri.parse(TEST_URL),
+            /* httpMethod= */ DataSpec.HTTP_METHOD_GET,
+            /* httpBody= */ null,
+            /* absoluteStreamPosition= */ 1000,
+            /* position= */ 1000,
+            /* length= */ 5000,
+            /* key= */ null,
+            /* flags= */ 0,
+            dataSpecRequestProperties);
+    mockResponseStartSuccess();
+
+    dataSourceUnderTest.open(testDataSpec);
+
+    assertThat(headersSet.get("defaultHeader1")).isEqualTo("defaultValue1");
+    assertThat(headersSet.get("defaultHeader2")).isEqualTo("dataSourceOverridesDefault");
+    assertThat(headersSet.get("defaultHeader3")).isEqualTo("dataSpecOverridesAll");
+    assertThat(headersSet.get("dataSourceHeader1")).isEqualTo("dataSourceValue1");
+    assertThat(headersSet.get("dataSourceHeader2")).isEqualTo("dataSpecOverridesDataSource");
+    assertThat(headersSet.get("dataSpecHeader1")).isEqualTo("dataSpecValue1");
+
     verify(mockUrlRequest).start();
   }
 
@@ -241,6 +289,26 @@ public void testRequestOpenFail() {
     }
   }
 
+  @Test
+  public void open_ifBodyIsSetWithoutContentTypeHeader_fails() {
+    testDataSpec =
+        new DataSpec(
+            /* uri= */ Uri.parse(TEST_URL),
+            /* postBody= */ new byte[1024],
+            /* absoluteStreamPosition= */ 200,
+            /* position= */ 200,
+            /* length= */ 1024,
+            /* key= */ "key",
+            /* flags= */ 0);
+
+    try {
+      dataSourceUnderTest.open(testDataSpec);
+      fail();
+    } catch (IOException expected) {
+      // Expected
+    }
+  }
+
   @Test
   public void testRequestOpenFailDueToDnsFailure() {
     mockResponseStartFailure();
diff --git a/extensions/ffmpeg/build.gradle b/extensions/ffmpeg/build.gradle
index 2b5a6010a9..657fa75c24 100644
--- a/extensions/ffmpeg/build.gradle
+++ b/extensions/ffmpeg/build.gradle
@@ -38,7 +38,7 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
diff --git a/extensions/flac/build.gradle b/extensions/flac/build.gradle
index dfac2e1c26..5d68711aa7 100644
--- a/extensions/flac/build.gradle
+++ b/extensions/flac/build.gradle
@@ -39,10 +39,10 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     androidTestImplementation project(modulePrefix + 'testutils')
-    androidTestImplementation 'androidx.test:runner:' + androidXTestVersion
+    androidTestImplementation 'androidx.test:runner:' + androidxTestVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
 }
diff --git a/extensions/gvr/build.gradle b/extensions/gvr/build.gradle
index 1031d6f4b7..f8992616a2 100644
--- a/extensions/gvr/build.gradle
+++ b/extensions/gvr/build.gradle
@@ -33,7 +33,7 @@ android {
 dependencies {
     implementation project(modulePrefix + 'library-core')
     implementation project(modulePrefix + 'library-ui')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     api 'com.google.vr:sdk-base:1.190.0'
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
 }
diff --git a/extensions/ima/build.gradle b/extensions/ima/build.gradle
index e330b13e47..e2292aed8f 100644
--- a/extensions/ima/build.gradle
+++ b/extensions/ima/build.gradle
@@ -34,7 +34,7 @@ android {
 dependencies {
     api 'com.google.ads.interactivemedia.v3:interactivemedia:3.11.3'
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     implementation 'com.google.android.gms:play-services-ads-identifier:17.0.0'
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
diff --git a/extensions/leanback/build.gradle b/extensions/leanback/build.gradle
index ecaa78e25b..f0be172c90 100644
--- a/extensions/leanback/build.gradle
+++ b/extensions/leanback/build.gradle
@@ -32,7 +32,7 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     implementation 'androidx.leanback:leanback:1.0.0'
 }
 
diff --git a/extensions/mediasession/build.gradle b/extensions/mediasession/build.gradle
index 7ee973723c..537c5ba534 100644
--- a/extensions/mediasession/build.gradle
+++ b/extensions/mediasession/build.gradle
@@ -32,7 +32,7 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    api 'androidx.media:media:1.0.1'
+    api 'androidx.media:media:' + androidxMediaVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
 }
 
diff --git a/extensions/okhttp/build.gradle b/extensions/okhttp/build.gradle
index 753f472e5a..b9aef13920 100644
--- a/extensions/okhttp/build.gradle
+++ b/extensions/okhttp/build.gradle
@@ -33,8 +33,10 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
+    testImplementation project(modulePrefix + 'testutils')
+    testImplementation 'org.robolectric:robolectric:' + robolectricVersion
     api 'com.squareup.okhttp3:okhttp:4.1.0'
 }
 
diff --git a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
index da3cf33fb4..c75b162df5 100644
--- a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
+++ b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSource.java
@@ -34,6 +34,7 @@
 import java.io.InputStream;
 import java.io.InterruptedIOException;
 import java.util.Collections;
+import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 import okhttp3.CacheControl;
@@ -45,7 +46,13 @@
 import okhttp3.Response;
 import okhttp3.ResponseBody;
 
-/** An {@link HttpDataSource} that delegates to Square's {@link Call.Factory}. */
+/**
+ * An {@link HttpDataSource} that delegates to Square's {@link Call.Factory}.
+ *
+ * <p>Note: HTTP request headers will be set using all parameters passed via (in order of decreasing
+ * priority) the {@code dataSpec}, {@link #setRequestProperty} and the default parameters used to
+ * construct the instance.
+ */
 public class OkHttpDataSource extends BaseDataSource implements HttpDataSource {
 
   static {
@@ -328,14 +335,19 @@ private Request makeRequest(DataSpec dataSpec) throws HttpDataSourceException {
     if (cacheControl != null) {
       builder.cacheControl(cacheControl);
     }
+
+    Map<String, String> headers = new HashMap<>();
     if (defaultRequestProperties != null) {
-      for (Map.Entry<String, String> property : defaultRequestProperties.getSnapshot().entrySet()) {
-        builder.header(property.getKey(), property.getValue());
-      }
+      headers.putAll(defaultRequestProperties.getSnapshot());
     }
-    for (Map.Entry<String, String> property : requestProperties.getSnapshot().entrySet()) {
-      builder.header(property.getKey(), property.getValue());
+
+    headers.putAll(requestProperties.getSnapshot());
+    headers.putAll(dataSpec.httpRequestHeaders);
+
+    for (Map.Entry<String, String> header : headers.entrySet()) {
+      builder.header(header.getKey(), header.getValue());
     }
+
     if (!(position == 0 && length == C.LENGTH_UNSET)) {
       String rangeRequest = "bytes=" + position + "-";
       if (length != C.LENGTH_UNSET) {
diff --git a/extensions/okhttp/src/test/AndroidManifest.xml b/extensions/okhttp/src/test/AndroidManifest.xml
new file mode 100644
index 0000000000..3efff43f6b
--- /dev/null
+++ b/extensions/okhttp/src/test/AndroidManifest.xml
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+  ~ Copyright (C) 2019 The Android Open Source Project
+  ~
+  ~ Licensed under the Apache License, Version 2.0 (the "License");
+  ~ you may not use this file except in compliance with the License.
+  ~ You may obtain a copy of the License at
+  ~
+  ~      http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing, software
+  ~ distributed under the License is distributed on an "AS IS" BASIS,
+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  ~ See the License for the specific language governing permissions and
+  ~ limitations under the License.
+  -->
+
+<manifest package="com.google.android.exoplayer2.ext.okhttp.test">
+    <uses-sdk/>
+</manifest>
diff --git a/extensions/okhttp/src/test/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSourceTest.java b/extensions/okhttp/src/test/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSourceTest.java
new file mode 100644
index 0000000000..dab62b06e8
--- /dev/null
+++ b/extensions/okhttp/src/test/java/com/google/android/exoplayer2/ext/okhttp/OkHttpDataSourceTest.java
@@ -0,0 +1,128 @@
+/*
+ * Copyright (C) 2019 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.google.android.exoplayer2.ext.okhttp;
+
+import static com.google.common.truth.Truth.assertThat;
+
+import android.net.Uri;
+import androidx.test.ext.junit.runners.AndroidJUnit4;
+import com.google.android.exoplayer2.upstream.DataSpec;
+import com.google.android.exoplayer2.upstream.HttpDataSource;
+import java.util.HashMap;
+import java.util.Map;
+import okhttp3.Call;
+import okhttp3.MediaType;
+import okhttp3.Protocol;
+import okhttp3.Request;
+import okhttp3.Response;
+import okhttp3.ResponseBody;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.ArgumentMatchers;
+import org.mockito.Mockito;
+
+/** Unit tests for {@link OkHttpDataSource}. */
+@RunWith(AndroidJUnit4.class)
+public class OkHttpDataSourceTest {
+
+  @Test
+  public void open_setsCorrectHeaders() throws HttpDataSource.HttpDataSourceException {
+    /*
+     * This test will set HTTP default request parameters (1) in the OkHttpDataSource, (2) via
+     * OkHttpDataSource.setRequestProperty() and (3) in the DataSpec instance according to the table
+     * below. Values wrapped in '*' are the ones that should be set in the connection request.
+     *
+     * +-----------------------+---+-----+-----+-----+-----+-----+
+     * |                       |            Header Key           |
+     * +-----------------------+---+-----+-----+-----+-----+-----+
+     * |       Location        | 0 |  1  |  2  |  3  |  4  |  5  |
+     * +-----------------------+---+-----+-----+-----+-----+-----+
+     * | Default               |*Y*|  Y  |  Y  |     |     |     |
+     * | OkHttpDataSource      |   | *Y* |  Y  |  Y  | *Y* |     |
+     * | DataSpec              |   |     | *Y* | *Y* |     | *Y* |
+     * +-----------------------+---+-----+-----+-----+-----+-----+
+     */
+
+    String defaultValue = "Default";
+    String okHttpDataSourceValue = "OkHttpDataSource";
+    String dataSpecValue = "DataSpec";
+
+    // 1. Default properties on OkHttpDataSource
+    HttpDataSource.RequestProperties defaultRequestProperties =
+        new HttpDataSource.RequestProperties();
+    defaultRequestProperties.set("0", defaultValue);
+    defaultRequestProperties.set("1", defaultValue);
+    defaultRequestProperties.set("2", defaultValue);
+
+    Call.Factory mockCallFactory = Mockito.mock(Call.Factory.class);
+    OkHttpDataSource okHttpDataSource =
+        new OkHttpDataSource(
+            mockCallFactory, "testAgent", /* cacheControl= */ null, defaultRequestProperties);
+
+    // 2. Additional properties set with setRequestProperty().
+    okHttpDataSource.setRequestProperty("1", okHttpDataSourceValue);
+    okHttpDataSource.setRequestProperty("2", okHttpDataSourceValue);
+    okHttpDataSource.setRequestProperty("3", okHttpDataSourceValue);
+    okHttpDataSource.setRequestProperty("4", okHttpDataSourceValue);
+
+    // 3. DataSpec properties
+    Map<String, String> dataSpecRequestProperties = new HashMap<>();
+    dataSpecRequestProperties.put("2", dataSpecValue);
+    dataSpecRequestProperties.put("3", dataSpecValue);
+    dataSpecRequestProperties.put("5", dataSpecValue);
+
+    DataSpec dataSpec =
+        new DataSpec(
+            /* uri= */ Uri.parse("http://www.google.com"),
+            /* httpMethod= */ 1,
+            /* httpBody= */ null,
+            /* absoluteStreamPosition= */ 1000,
+            /* position= */ 1000,
+            /* length= */ 5000,
+            /* key= */ null,
+            /* flags= */ 0,
+            dataSpecRequestProperties);
+
+    Mockito.doAnswer(
+            invocation -> {
+              Request request = invocation.getArgument(0);
+              assertThat(request.header("0")).isEqualTo(defaultValue);
+              assertThat(request.header("1")).isEqualTo(okHttpDataSourceValue);
+              assertThat(request.header("2")).isEqualTo(dataSpecValue);
+              assertThat(request.header("3")).isEqualTo(dataSpecValue);
+              assertThat(request.header("4")).isEqualTo(okHttpDataSourceValue);
+              assertThat(request.header("5")).isEqualTo(dataSpecValue);
+
+              // return a Call whose .execute() will return a mock Response
+              Call returnValue = Mockito.mock(Call.class);
+              Mockito.doReturn(
+                      new Response.Builder()
+                          .request(request)
+                          .protocol(Protocol.HTTP_1_1)
+                          .code(200)
+                          .message("OK")
+                          .body(ResponseBody.create(MediaType.parse("text/plain"), ""))
+                          .build())
+                  .when(returnValue)
+                  .execute();
+              return returnValue;
+            })
+        .when(mockCallFactory)
+        .newCall(ArgumentMatchers.any());
+    okHttpDataSource.open(dataSpec);
+  }
+}
diff --git a/extensions/opus/build.gradle b/extensions/opus/build.gradle
index 415deba6a4..f474ff8595 100644
--- a/extensions/opus/build.gradle
+++ b/extensions/opus/build.gradle
@@ -39,7 +39,7 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
     androidTestImplementation 'androidx.test:runner:' + androidXTestVersion
diff --git a/extensions/rtmp/build.gradle b/extensions/rtmp/build.gradle
index 9c709305bf..88d3524d72 100644
--- a/extensions/rtmp/build.gradle
+++ b/extensions/rtmp/build.gradle
@@ -33,7 +33,7 @@ android {
 dependencies {
     implementation project(modulePrefix + 'library-core')
     implementation 'net.butterflytv.utils:rtmp-client:3.1.0'
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
 }
diff --git a/extensions/vp9/build.gradle b/extensions/vp9/build.gradle
index 71e4f7c7d1..7f925d1173 100644
--- a/extensions/vp9/build.gradle
+++ b/extensions/vp9/build.gradle
@@ -39,7 +39,7 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
     androidTestImplementation 'androidx.test:runner:' + androidXTestVersion
diff --git a/library/core/build.gradle b/library/core/build.gradle
index fcc943787b..1c7d2aeabc 100644
--- a/library/core/build.gradle
+++ b/library/core/build.gradle
@@ -57,7 +57,7 @@ android {
 }
 
 dependencies {
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'com.google.code.findbugs:jsr305:' + jsr305Version
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     compileOnly 'org.checkerframework:checker-compat-qual:' + checkerframeworkVersionC
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/FormatHolder.java b/library/core/src/main/java/com/google/android/exoplayer2/FormatHolder.java
index c1b2ace9b7..7d21182de2 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/FormatHolder.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/FormatHolder.java
@@ -33,4 +33,11 @@
 
   /** The held {@link Format}. */
   @Nullable public Format format;
+
+  /** Clears the holder. */
+  public void clear() {
+    includesDrmSession = false;
+    drmSession = null;
+    format = null;
+  }
 }
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/Timeline.java b/library/core/src/main/java/com/google/android/exoplayer2/Timeline.java
index 0018a15157..172d9c4107 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/Timeline.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/Timeline.java
@@ -657,17 +657,8 @@ public final Window getWindow(int windowIndex, Window window, boolean setTag) {
    *     default start position should be projected.
    * @return The populated {@link Window}, for convenience.
    */
-  @SuppressWarnings("deprecation")
-  public Window getWindow(int windowIndex, Window window, long defaultPositionProjectionUs) {
-    return getWindow(windowIndex, window, /* setTag= */ true, defaultPositionProjectionUs);
-  }
-
-  /** @deprecated Implement {@link #getWindow(int, Window, long)} instead and always set the tag. */
-  @Deprecated
-  public Window getWindow(
-      int windowIndex, Window window, boolean setTag, long defaultPositionProjectionUs) {
-    return getWindow(windowIndex, window, defaultPositionProjectionUs);
-  }
+  public abstract Window getWindow(
+      int windowIndex, Window window, long defaultPositionProjectionUs);
 
   /**
    * Returns the number of periods in the timeline.
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/audio/SimpleDecoderAudioRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/audio/SimpleDecoderAudioRenderer.java
index e4691db7c0..52d55b2c31 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/audio/SimpleDecoderAudioRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/audio/SimpleDecoderAudioRenderer.java
@@ -271,10 +271,12 @@ public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackEx
     // Try and read a format if we don't have one already.
     if (inputFormat == null) {
       // We don't have a format yet, so try and read one.
+      formatHolder.clear();
       flagsOnlyBuffer.clear();
       int result = readSource(formatHolder, flagsOnlyBuffer, true);
       if (result == C.RESULT_FORMAT_READ) {
         onInputFormatChanged(formatHolder);
+        formatHolder.clear();
       } else if (result == C.RESULT_BUFFER_READ) {
         // End of stream read having not read a format.
         Assertions.checkState(flagsOnlyBuffer.isEndOfStream());
@@ -359,6 +361,17 @@ protected Format getOutputFormat() {
         null, null, 0, null);
   }
 
+  /**
+   * Returns whether the existing decoder can be kept for a new format.
+   *
+   * @param oldFormat The previous format.
+   * @param newFormat The new format.
+   * @return True if the existing decoder can be kept.
+   */
+  protected boolean canKeepCodec(Format oldFormat, Format newFormat) {
+    return false;
+  }
+
   private boolean drainOutputBuffer() throws ExoPlaybackException, AudioDecoderException,
       AudioSink.ConfigurationException, AudioSink.InitializationException,
       AudioSink.WriteException {
@@ -432,6 +445,7 @@ private boolean feedInputBuffer() throws AudioDecoderException, ExoPlaybackExcep
       // We've already read an encrypted sample into buffer, and are waiting for keys.
       result = C.RESULT_BUFFER_READ;
     } else {
+      formatHolder.clear();
       result = readSource(formatHolder, inputBuffer, false);
     }
 
@@ -440,6 +454,7 @@ private boolean feedInputBuffer() throws AudioDecoderException, ExoPlaybackExcep
     }
     if (result == C.RESULT_FORMAT_READ) {
       onInputFormatChanged(formatHolder);
+      formatHolder.clear();
       return true;
     }
     if (inputBuffer.isEndOfStream()) {
@@ -685,14 +700,16 @@ private void onInputFormatChanged(FormatHolder formatHolder) throws ExoPlaybackE
       }
     }
 
-    if (decoderReceivedBuffers) {
-      // Signal end of stream and wait for any final output buffers before re-initialization.
-      decoderReinitializationState = REINITIALIZATION_STATE_SIGNAL_END_OF_STREAM;
-    } else {
-      // There aren't any final output buffers, so release the decoder immediately.
-      releaseDecoder();
-      maybeInitDecoder();
-      audioTrackNeedsConfigure = true;
+    if (!canKeepCodec(oldFormat, inputFormat)) {
+      if (decoderReceivedBuffers) {
+        // Signal end of stream and wait for any final output buffers before re-initialization.
+        decoderReinitializationState = REINITIALIZATION_STATE_SIGNAL_END_OF_STREAM;
+      } else {
+        // There aren't any final output buffers, so release the decoder immediately.
+        releaseDecoder();
+        maybeInitDecoder();
+        audioTrackNeedsConfigure = true;
+      }
     }
 
     encoderDelay = inputFormat.encoderDelay;
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSession.java b/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSession.java
index a667c8374a..763405aa65 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSession.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSession.java
@@ -22,13 +22,13 @@
 import android.os.HandlerThread;
 import android.os.Looper;
 import android.os.Message;
+import android.os.SystemClock;
 import android.util.Pair;
 import androidx.annotation.Nullable;
 import com.google.android.exoplayer2.C;
 import com.google.android.exoplayer2.drm.DrmInitData.SchemeData;
 import com.google.android.exoplayer2.drm.ExoMediaDrm.KeyRequest;
 import com.google.android.exoplayer2.drm.ExoMediaDrm.ProvisionRequest;
-import com.google.android.exoplayer2.upstream.DefaultLoadErrorHandlingPolicy;
 import com.google.android.exoplayer2.upstream.LoadErrorHandlingPolicy;
 import com.google.android.exoplayer2.util.Assertions;
 import com.google.android.exoplayer2.util.EventDispatcher;
@@ -112,12 +112,12 @@ public UnexpectedDrmSessionException(Throwable cause) {
 
   /* package */ final MediaDrmCallback callback;
   /* package */ final UUID uuid;
-  /* package */ final PostResponseHandler postResponseHandler;
+  /* package */ final ResponseHandler responseHandler;
 
   private @DrmSession.State int state;
   private int referenceCount;
   @Nullable private HandlerThread requestHandlerThread;
-  @Nullable private PostRequestHandler postRequestHandler;
+  @Nullable private RequestHandler requestHandler;
   @Nullable private T mediaCrypto;
   @Nullable private DrmSessionException lastException;
   private byte @NullableType [] sessionId;
@@ -142,8 +142,8 @@ public UnexpectedDrmSessionException(Throwable cause) {
    * @param callback The media DRM callback.
    * @param playbackLooper The playback looper.
    * @param eventDispatcher The dispatcher for DRM session manager events.
-   * @param initialDrmRequestRetryCount The number of times to retry for initial provisioning and
-   *     key request before reporting error.
+   * @param loadErrorHandlingPolicy The {@link LoadErrorHandlingPolicy} for key and provisioning
+   *     requests.
    */
   public DefaultDrmSession(
       UUID uuid,
@@ -157,7 +157,7 @@ public DefaultDrmSession(
       MediaDrmCallback callback,
       Looper playbackLooper,
       EventDispatcher<DefaultDrmSessionEventListener> eventDispatcher,
-      int initialDrmRequestRetryCount) {
+      LoadErrorHandlingPolicy loadErrorHandlingPolicy) {
     if (mode == DefaultDrmSessionManager.MODE_QUERY
         || mode == DefaultDrmSessionManager.MODE_RELEASE) {
       Assertions.checkNotNull(offlineLicenseKeySetId);
@@ -176,11 +176,9 @@ public DefaultDrmSession(
     this.optionalKeyRequestParameters = optionalKeyRequestParameters;
     this.callback = callback;
     this.eventDispatcher = eventDispatcher;
-    loadErrorHandlingPolicy =
-        new DefaultLoadErrorHandlingPolicy(
-            /* minimumLoadableRetryCount= */ initialDrmRequestRetryCount);
+    this.loadErrorHandlingPolicy = loadErrorHandlingPolicy;
     state = STATE_OPENING;
-    postResponseHandler = new PostResponseHandler(playbackLooper);
+    responseHandler = new ResponseHandler(playbackLooper);
   }
 
   public boolean hasSessionId(byte[] sessionId) {
@@ -201,7 +199,7 @@ public void onMediaDrmEvent(int what) {
 
   public void provision() {
     currentProvisionRequest = mediaDrm.getProvisionRequest();
-    Util.castNonNull(postRequestHandler)
+    Util.castNonNull(requestHandler)
         .post(
             MSG_PROVISION,
             Assertions.checkNotNull(currentProvisionRequest),
@@ -254,7 +252,7 @@ public void acquireReference() {
       Assertions.checkState(state == STATE_OPENING);
       requestHandlerThread = new HandlerThread("DrmRequestHandler");
       requestHandlerThread.start();
-      postRequestHandler = new PostRequestHandler(requestHandlerThread.getLooper());
+      requestHandler = new RequestHandler(requestHandlerThread.getLooper());
       if (openInternal(true)) {
         doLicense(true);
       }
@@ -266,9 +264,9 @@ public void releaseReference() {
     if (--referenceCount == 0) {
       // Assigning null to various non-null variables for clean-up.
       state = STATE_RELEASED;
-      Util.castNonNull(postResponseHandler).removeCallbacksAndMessages(null);
-      Util.castNonNull(postRequestHandler).removeCallbacksAndMessages(null);
-      postRequestHandler = null;
+      Util.castNonNull(responseHandler).removeCallbacksAndMessages(null);
+      Util.castNonNull(requestHandler).removeCallbacksAndMessages(null);
+      requestHandler = null;
       Util.castNonNull(requestHandlerThread).quit();
       requestHandlerThread = null;
       mediaCrypto = null;
@@ -417,7 +415,7 @@ private void postKeyRequest(byte[] scope, int type, boolean allowRetry) {
     try {
       currentKeyRequest =
           mediaDrm.getKeyRequest(scope, schemeDatas, type, optionalKeyRequestParameters);
-      Util.castNonNull(postRequestHandler)
+      Util.castNonNull(requestHandler)
           .post(MSG_KEYS, Assertions.checkNotNull(currentKeyRequest), allowRetry);
     } catch (Exception e) {
       onKeysError(e);
@@ -490,9 +488,9 @@ private boolean isOpen() {
   // Internal classes.
 
   @SuppressLint("HandlerLeak")
-  private class PostResponseHandler extends Handler {
+  private class ResponseHandler extends Handler {
 
-    public PostResponseHandler(Looper looper) {
+    public ResponseHandler(Looper looper) {
       super(looper);
     }
 
@@ -516,29 +514,30 @@ public void handleMessage(Message msg) {
   }
 
   @SuppressLint("HandlerLeak")
-  private class PostRequestHandler extends Handler {
+  private class RequestHandler extends Handler {
 
-    public PostRequestHandler(Looper backgroundLooper) {
+    public RequestHandler(Looper backgroundLooper) {
       super(backgroundLooper);
     }
 
     void post(int what, Object request, boolean allowRetry) {
-      int allowRetryInt = allowRetry ? 1 : 0;
-      int errorCount = 0;
-      obtainMessage(what, allowRetryInt, errorCount, request).sendToTarget();
+      RequestTask requestTask =
+          new RequestTask(allowRetry, /* startTimeMs= */ SystemClock.elapsedRealtime(), request);
+      obtainMessage(what, requestTask).sendToTarget();
     }
 
     @Override
     public void handleMessage(Message msg) {
-      Object request = msg.obj;
+      RequestTask requestTask = (RequestTask) msg.obj;
       Object response;
       try {
         switch (msg.what) {
           case MSG_PROVISION:
-            response = callback.executeProvisionRequest(uuid, (ProvisionRequest) request);
+            response =
+                callback.executeProvisionRequest(uuid, (ProvisionRequest) requestTask.request);
             break;
           case MSG_KEYS:
-            response = callback.executeKeyRequest(uuid, (KeyRequest) request);
+            response = callback.executeKeyRequest(uuid, (KeyRequest) requestTask.request);
             break;
           default:
             throw new RuntimeException();
@@ -549,30 +548,47 @@ public void handleMessage(Message msg) {
         }
         response = e;
       }
-      postResponseHandler.obtainMessage(msg.what, Pair.create(request, response)).sendToTarget();
+      responseHandler
+          .obtainMessage(msg.what, Pair.create(requestTask.request, response))
+          .sendToTarget();
     }
 
     private boolean maybeRetryRequest(Message originalMsg, Exception e) {
-      boolean allowRetry = originalMsg.arg1 == 1;
-      if (!allowRetry) {
+      RequestTask requestTask = (RequestTask) originalMsg.obj;
+      if (!requestTask.allowRetry) {
         return false;
       }
-      int errorCount = originalMsg.arg2 + 1;
-      if (errorCount > loadErrorHandlingPolicy.getMinimumLoadableRetryCount(C.DATA_TYPE_DRM)) {
+      requestTask.errorCount++;
+      if (requestTask.errorCount
+          > loadErrorHandlingPolicy.getMinimumLoadableRetryCount(C.DATA_TYPE_DRM)) {
         return false;
       }
       Message retryMsg = Message.obtain(originalMsg);
-      retryMsg.arg2 = errorCount;
 
       IOException ioException =
           e instanceof IOException ? (IOException) e : new UnexpectedDrmSessionException(e);
-      // TODO: Add loadDurationMs calculation before allowing user-provided load error handling
-      // policies.
       long retryDelayMs =
           loadErrorHandlingPolicy.getRetryDelayMsFor(
-              C.DATA_TYPE_DRM, /* loadDurationMs= */ C.TIME_UNSET, ioException, errorCount);
+              C.DATA_TYPE_DRM,
+              /* loadDurationMs= */ SystemClock.elapsedRealtime() - requestTask.startTimeMs,
+              ioException,
+              requestTask.errorCount);
       sendMessageDelayed(retryMsg, retryDelayMs);
       return true;
     }
   }
+
+  private static final class RequestTask {
+
+    public final boolean allowRetry;
+    public final long startTimeMs;
+    public final Object request;
+    public int errorCount;
+
+    public RequestTask(boolean allowRetry, long startTimeMs, Object request) {
+      this.allowRetry = allowRetry;
+      this.startTimeMs = startTimeMs;
+      this.request = request;
+    }
+  }
 }
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSessionManager.java b/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSessionManager.java
index 042a30e440..0757ad12e0 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSessionManager.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/drm/DefaultDrmSessionManager.java
@@ -28,6 +28,8 @@
 import com.google.android.exoplayer2.drm.DrmInitData.SchemeData;
 import com.google.android.exoplayer2.drm.DrmSession.DrmSessionException;
 import com.google.android.exoplayer2.drm.ExoMediaDrm.OnEventListener;
+import com.google.android.exoplayer2.upstream.DefaultLoadErrorHandlingPolicy;
+import com.google.android.exoplayer2.upstream.LoadErrorHandlingPolicy;
 import com.google.android.exoplayer2.util.Assertions;
 import com.google.android.exoplayer2.util.EventDispatcher;
 import com.google.android.exoplayer2.util.Log;
@@ -91,7 +93,7 @@ private MissingSchemeDataException(UUID uuid) {
   @Nullable private final HashMap<String, String> optionalKeyRequestParameters;
   private final EventDispatcher<DefaultDrmSessionEventListener> eventDispatcher;
   private final boolean multiSession;
-  private final int initialDrmRequestRetryCount;
+  private final LoadErrorHandlingPolicy loadErrorHandlingPolicy;
 
   private final List<DefaultDrmSession<T>> sessions;
   private final List<DefaultDrmSession<T>> provisioningSessions;
@@ -224,6 +226,22 @@ public DefaultDrmSessionManager(
       @Nullable HashMap<String, String> optionalKeyRequestParameters,
       boolean multiSession,
       int initialDrmRequestRetryCount) {
+    this(
+        uuid,
+        mediaDrm,
+        callback,
+        optionalKeyRequestParameters,
+        multiSession,
+        new DefaultLoadErrorHandlingPolicy(initialDrmRequestRetryCount));
+  }
+
+  private DefaultDrmSessionManager(
+      UUID uuid,
+      ExoMediaDrm<T> mediaDrm,
+      MediaDrmCallback callback,
+      @Nullable HashMap<String, String> optionalKeyRequestParameters,
+      boolean multiSession,
+      LoadErrorHandlingPolicy loadErrorHandlingPolicy) {
     Assertions.checkNotNull(uuid);
     Assertions.checkNotNull(mediaDrm);
     Assertions.checkArgument(!C.COMMON_PSSH_UUID.equals(uuid), "Use C.CLEARKEY_UUID instead");
@@ -233,7 +251,7 @@ public DefaultDrmSessionManager(
     this.optionalKeyRequestParameters = optionalKeyRequestParameters;
     this.eventDispatcher = new EventDispatcher<>();
     this.multiSession = multiSession;
-    this.initialDrmRequestRetryCount = initialDrmRequestRetryCount;
+    this.loadErrorHandlingPolicy = loadErrorHandlingPolicy;
     mode = MODE_PLAYBACK;
     sessions = new ArrayList<>();
     provisioningSessions = new ArrayList<>();
@@ -429,7 +447,7 @@ public boolean canAcquireSession(DrmInitData drmInitData) {
               callback,
               playbackLooper,
               eventDispatcher,
-              initialDrmRequestRetryCount);
+              loadErrorHandlingPolicy);
       sessions.add(session);
     }
     session.acquireReference();
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/mediacodec/MediaCodecRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/mediacodec/MediaCodecRenderer.java
index c077d8d227..45ae82d049 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/mediacodec/MediaCodecRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/mediacodec/MediaCodecRenderer.java
@@ -770,10 +770,12 @@ protected DecoderException createDecoderException(
 
   /** Reads into {@link #flagsOnlyBuffer} and returns whether a format was read. */
   private boolean readToFlagsOnlyBuffer(boolean requireFormat) throws ExoPlaybackException {
+    formatHolder.clear();
     flagsOnlyBuffer.clear();
     int result = readSource(formatHolder, flagsOnlyBuffer, requireFormat);
     if (result == C.RESULT_FORMAT_READ) {
       onInputFormatChanged(formatHolder);
+      formatHolder.clear();
       return true;
     } else if (result == C.RESULT_BUFFER_READ && flagsOnlyBuffer.isEndOfStream()) {
       inputStreamEnded = true;
@@ -1056,6 +1058,7 @@ private boolean feedInputBuffer() throws ExoPlaybackException {
         codecReconfigurationState = RECONFIGURATION_STATE_QUEUE_PENDING;
       }
       adaptiveReconfigurationBytes = buffer.data.position();
+      formatHolder.clear();
       result = readSource(formatHolder, buffer, false);
     }
 
@@ -1075,6 +1078,7 @@ private boolean feedInputBuffer() throws ExoPlaybackException {
         codecReconfigurationState = RECONFIGURATION_STATE_WRITE_PENDING;
       }
       onInputFormatChanged(formatHolder);
+      formatHolder.clear();
       return true;
     }
 
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/metadata/MetadataRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/metadata/MetadataRenderer.java
index 0dc0dc6096..d162164f79 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/metadata/MetadataRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/metadata/MetadataRenderer.java
@@ -114,6 +114,7 @@ protected void onPositionReset(long positionUs, boolean joining) {
   public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackException {
     if (!inputStreamEnded && pendingMetadataCount < MAX_PENDING_METADATA_COUNT) {
       buffer.clear();
+      formatHolder.clear();
       int result = readSource(formatHolder, buffer, false);
       if (result == C.RESULT_BUFFER_READ) {
         if (buffer.isEndOfStream()) {
@@ -141,6 +142,7 @@ public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackEx
         }
       } else if (result == C.RESULT_FORMAT_READ) {
         subsampleOffsetUs = formatHolder.format.subsampleOffsetUs;
+        formatHolder.clear();
       }
     }
 
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/source/ForwardingTimeline.java b/library/core/src/main/java/com/google/android/exoplayer2/source/ForwardingTimeline.java
index c36e62db86..38b373b26c 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/source/ForwardingTimeline.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/source/ForwardingTimeline.java
@@ -61,12 +61,6 @@ public Window getWindow(int windowIndex, Window window, long defaultPositionProj
     return timeline.getWindow(windowIndex, window, defaultPositionProjectionUs);
   }
 
-  @Override
-  public final Window getWindow(
-      int windowIndex, Window window, boolean setIds, long defaultPositionProjectionUs) {
-    return getWindow(windowIndex, window, defaultPositionProjectionUs);
-  }
-
   @Override
   public int getPeriodCount() {
     return timeline.getPeriodCount();
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/source/ProgressiveMediaPeriod.java b/library/core/src/main/java/com/google/android/exoplayer2/source/ProgressiveMediaPeriod.java
index d25fff5104..41fefafab7 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/source/ProgressiveMediaPeriod.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/source/ProgressiveMediaPeriod.java
@@ -1068,21 +1068,28 @@ public Extractor selectExtractor(ExtractorInput input, ExtractorOutput output, U
       if (extractor != null) {
         return extractor;
       }
-      for (Extractor extractor : extractors) {
-        try {
-          if (extractor.sniff(input)) {
-            this.extractor = extractor;
-            break;
+      if (extractors.length == 1) {
+        this.extractor = extractors[0];
+      } else {
+        for (Extractor extractor : extractors) {
+          try {
+            if (extractor.sniff(input)) {
+              this.extractor = extractor;
+              break;
+            }
+          } catch (EOFException e) {
+            // Do nothing.
+          } finally {
+            input.resetPeekPosition();
           }
-        } catch (EOFException e) {
-          // Do nothing.
-        } finally {
-          input.resetPeekPosition();
         }
-      }
-      if (extractor == null) {
-        throw new UnrecognizedInputFormatException("None of the available extractors ("
-            + Util.getCommaDelimitedSimpleClassNames(extractors) + ") could read the stream.", uri);
+        if (extractor == null) {
+          throw new UnrecognizedInputFormatException(
+              "None of the available extractors ("
+                  + Util.getCommaDelimitedSimpleClassNames(extractors)
+                  + ") could read the stream.",
+              uri);
+        }
       }
       extractor.init(output);
       return extractor;
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSource.java b/library/core/src/main/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSource.java
index 0cf54a153c..37329a4868 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSource.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSource.java
@@ -52,6 +52,10 @@
  * HTTP to HTTPS or vice versa). Cross-protocol redirects can be enabled by using the {@link
  * #DefaultHttpDataSource(String, Predicate, int, int, boolean, RequestProperties)} constructor and
  * passing {@code true} as the second last argument.
+ *
+ * <p>Note: HTTP request headers will be set using all parameters passed via (in order of decreasing
+ * priority) the {@code dataSpec}, {@link #setRequestProperty} and the default parameters used to
+ * construct the instance.
  */
 public class DefaultHttpDataSource extends BaseDataSource implements HttpDataSource {
 
@@ -265,10 +269,6 @@ public void clearAllRequestProperties() {
 
   /**
    * Opens the source to read the specified data.
-   *
-   * <p>Note: HTTP request headers will be set using parameters passed via (in order of decreasing
-   * priority) the {@code dataSpec}, {@link #setRequestProperty} and the default parameters used to
-   * construct the instance.
    */
   @Override
   public long open(DataSpec dataSpec) throws HttpDataSourceException {
@@ -381,13 +381,6 @@ public void close() throws HttpDataSourceException {
     }
   }
 
-  /** Creates an {@link HttpURLConnection} that is connected with the {@code url}. */
-  @VisibleForTesting
-  /* package */
-  HttpURLConnection openConnection(URL url) throws IOException {
-    return (HttpURLConnection) url.openConnection();
-  }
-
   /**
    * Returns the current connection, or null if the source is not currently opened.
    *
@@ -568,6 +561,12 @@ private HttpURLConnection makeConnection(
     return connection;
   }
 
+  /** Creates an {@link HttpURLConnection} that is connected with the {@code url}. */
+  @VisibleForTesting
+  /* package */ HttpURLConnection openConnection(URL url) throws IOException {
+    return (HttpURLConnection) url.openConnection();
+  }
+
   /**
    * Handles a redirect.
    *
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/upstream/HttpDataSource.java b/library/core/src/main/java/com/google/android/exoplayer2/upstream/HttpDataSource.java
index 4d3aca570e..63cad8786b 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/upstream/HttpDataSource.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/upstream/HttpDataSource.java
@@ -326,6 +326,13 @@ public InvalidResponseCodeException(
 
   }
 
+  /**
+   * Opens the source to read the specified data.
+   *
+   * <p>Note: {@link HttpDataSource} implementations are advised to set request headers passed via
+   * (in order of decreasing priority) the {@code dataSpec}, {@link #setRequestProperty} and the
+   * default parameters set in the {@link Factory}.
+   */
   @Override
   long open(DataSpec dataSpec) throws HttpDataSourceException;
 
@@ -339,6 +346,10 @@ public InvalidResponseCodeException(
    * Sets the value of a request header. The value will be used for subsequent connections
    * established by the source.
    *
+   * <p>Note: If the same header is set as a default parameter in the {@link Factory}, then the
+   * header value set with this method should be preferred when connecting with the data source. See
+   * {@link #open}.
+   *
    * @param name The name of the header field.
    * @param value The value of the field.
    */
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/upstream/LoadErrorHandlingPolicy.java b/library/core/src/main/java/com/google/android/exoplayer2/upstream/LoadErrorHandlingPolicy.java
index 3432935d5f..293d1e7510 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/upstream/LoadErrorHandlingPolicy.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/upstream/LoadErrorHandlingPolicy.java
@@ -44,8 +44,8 @@
    *
    * @param dataType One of the {@link C C.DATA_TYPE_*} constants indicating the type of data to
    *     load.
-   * @param loadDurationMs The duration in milliseconds of the load up to the point at which the
-   *     error occurred, including any previous attempts.
+   * @param loadDurationMs The duration in milliseconds of the load from the start of the first load
+   *     attempt up to the point at which the error occurred.
    * @param exception The load error.
    * @param errorCount The number of errors this load has encountered, including this one.
    * @return The blacklist duration in milliseconds, or {@link C#TIME_UNSET} if the resource should
@@ -64,8 +64,8 @@ long getBlacklistDurationMsFor(
    *
    * @param dataType One of the {@link C C.DATA_TYPE_*} constants indicating the type of data to
    *     load.
-   * @param loadDurationMs The duration in milliseconds of the load up to the point at which the
-   *     error occurred, including any previous attempts.
+   * @param loadDurationMs The duration in milliseconds of the load from the start of the first load
+   *     attempt up to the point at which the error occurred.
    * @param exception The load error.
    * @param errorCount The number of errors this load has encountered, including this one.
    * @return The number of milliseconds to wait before attempting the load again, or {@link
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/util/AtomicFile.java b/library/core/src/main/java/com/google/android/exoplayer2/util/AtomicFile.java
index f2259e8f1a..fa40f0f012 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/util/AtomicFile.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/util/AtomicFile.java
@@ -107,8 +107,9 @@ public OutputStream startWrite() throws IOException {
     } catch (FileNotFoundException e) {
       File parent = baseName.getParentFile();
       if (parent == null || !parent.mkdirs()) {
-        throw new IOException("Couldn't create directory " + baseName, e);
+        throw new IOException("Couldn't create " + baseName, e);
       }
+      // Try again now that we've created the parent directory.
       try {
         str = new AtomicFileOutputStream(baseName);
       } catch (FileNotFoundException e2) {
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/video/MediaCodecVideoRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/video/MediaCodecVideoRenderer.java
index 10827f8aa7..f73dde58c3 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/video/MediaCodecVideoRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/video/MediaCodecVideoRenderer.java
@@ -319,7 +319,7 @@ protected int supportsFormat(
     if (!MimeTypes.isVideo(mimeType)) {
       return FORMAT_UNSUPPORTED_TYPE;
     }
-    DrmInitData drmInitData = format.drmInitData;
+    @Nullable DrmInitData drmInitData = format.drmInitData;
     // Assume encrypted content requires secure decoders.
     boolean requiresSecureDecryption = drmInitData != null;
     List<MediaCodecInfo> decoderInfos =
@@ -341,10 +341,10 @@ protected int supportsFormat(
       return FORMAT_UNSUPPORTED_SUBTYPE;
     }
     boolean supportsFormatDrm =
-        format.drmInitData == null
+        drmInitData == null
             || FrameworkMediaCrypto.class.equals(format.exoMediaCryptoType)
             || (format.exoMediaCryptoType == null
-                && supportsFormatDrm(drmSessionManager, format.drmInitData));
+                && supportsFormatDrm(drmSessionManager, drmInitData));
     if (!supportsFormatDrm) {
       return FORMAT_UNSUPPORTED_DRM;
     }
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/video/SimpleDecoderVideoRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/video/SimpleDecoderVideoRenderer.java
index 83f528e322..39c3aa2621 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/video/SimpleDecoderVideoRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/video/SimpleDecoderVideoRenderer.java
@@ -168,10 +168,12 @@ public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackEx
 
     if (format == null) {
       // We don't have a format yet, so try and read one.
+      formatHolder.clear();
       flagsOnlyBuffer.clear();
       int result = readSource(formatHolder, flagsOnlyBuffer, true);
       if (result == C.RESULT_FORMAT_READ) {
         onInputFormatChanged(formatHolder);
+        formatHolder.clear();
       } else if (result == C.RESULT_BUFFER_READ) {
         // End of stream read having not read a format.
         Assertions.checkState(flagsOnlyBuffer.isEndOfStream());
@@ -701,6 +703,7 @@ private boolean feedInputBuffer() throws VideoDecoderException, ExoPlaybackExcep
       // We've already read an encrypted sample into buffer, and are waiting for keys.
       result = C.RESULT_BUFFER_READ;
     } else {
+      formatHolder.clear();
       result = readSource(formatHolder, inputBuffer, false);
     }
 
@@ -709,6 +712,7 @@ private boolean feedInputBuffer() throws VideoDecoderException, ExoPlaybackExcep
     }
     if (result == C.RESULT_FORMAT_READ) {
       onInputFormatChanged(formatHolder);
+      formatHolder.clear();
       return true;
     }
     if (inputBuffer.isEndOfStream()) {
diff --git a/library/core/src/main/java/com/google/android/exoplayer2/video/spherical/CameraMotionRenderer.java b/library/core/src/main/java/com/google/android/exoplayer2/video/spherical/CameraMotionRenderer.java
index 7d76f43d04..9384d32a6f 100644
--- a/library/core/src/main/java/com/google/android/exoplayer2/video/spherical/CameraMotionRenderer.java
+++ b/library/core/src/main/java/com/google/android/exoplayer2/video/spherical/CameraMotionRenderer.java
@@ -85,8 +85,10 @@ public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackEx
     // Keep reading available samples as long as the sample time is not too far into the future.
     while (!hasReadStreamToEnd() && lastTimestampUs < positionUs + SAMPLE_WINDOW_DURATION_US) {
       buffer.clear();
+      formatHolder.clear();
       int result = readSource(formatHolder, buffer, /* formatRequired= */ false);
       if (result != C.RESULT_BUFFER_READ || buffer.isEndOfStream()) {
+        formatHolder.clear();
         return;
       }
 
diff --git a/library/core/src/test/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSourceTest.java b/library/core/src/test/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSourceTest.java
index 7c2b63c941..d724369d93 100644
--- a/library/core/src/test/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSourceTest.java
+++ b/library/core/src/test/java/com/google/android/exoplayer2/upstream/DefaultHttpDataSourceTest.java
@@ -39,9 +39,9 @@
   public void open_withSpecifiedRequestParameters_usesCorrectParameters() throws IOException {
 
     /*
-     * This test will set HTTP request parameters in the HttpDataSourceFactory (default),
-     * in the DefaultHttpDataSource instance and in the DataSpec instance according to the table
-     * below. Values wrapped in '*' are the ones that should be set in the connection request.
+     * This test will set HTTP default request parameters (1) in the DefaultHttpDataSource, (2) via
+     * DefaultHttpDataSource.setRequestProperty() and (3) in the DataSpec instance according to the
+     * table below. Values wrapped in '*' are the ones that should be set in the connection request.
      *
      * +-----------------------+---+-----+-----+-----+-----+-----+
      * |                       |            Header Key           |
diff --git a/library/dash/build.gradle b/library/dash/build.gradle
index f8b7f65f93..24210f1629 100644
--- a/library/dash/build.gradle
+++ b/library/dash/build.gradle
@@ -42,7 +42,7 @@ dependencies {
     implementation project(modulePrefix + 'library-core')
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     compileOnly 'org.checkerframework:checker-compat-qual:' + checkerframeworkVersionC
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
 }
diff --git a/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParser.java b/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParser.java
index 42436d9593..6feb529958 100644
--- a/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParser.java
+++ b/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParser.java
@@ -237,15 +237,15 @@ protected UtcTimingElement buildUtcTimingElement(String schemeIdUri, String valu
           seenFirstBaseUrl = true;
         }
       } else if (XmlPullParserUtil.isStartTag(xpp, "AdaptationSet")) {
-        adaptationSets.add(parseAdaptationSet(xpp, baseUrl, segmentBase));
+        adaptationSets.add(parseAdaptationSet(xpp, baseUrl, segmentBase, durationMs));
       } else if (XmlPullParserUtil.isStartTag(xpp, "EventStream")) {
         eventStreams.add(parseEventStream(xpp));
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentBase")) {
         segmentBase = parseSegmentBase(xpp, null);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentList")) {
-        segmentBase = parseSegmentList(xpp, null);
+        segmentBase = parseSegmentList(xpp, null, durationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentTemplate")) {
-        segmentBase = parseSegmentTemplate(xpp, null, Collections.emptyList());
+        segmentBase = parseSegmentTemplate(xpp, null, Collections.emptyList(), durationMs);
       } else {
         maybeSkipTag(xpp);
       }
@@ -262,7 +262,7 @@ protected Period buildPeriod(String id, long startMs, List<AdaptationSet> adapta
   // AdaptationSet parsing.
 
   protected AdaptationSet parseAdaptationSet(
-      XmlPullParser xpp, String baseUrl, @Nullable SegmentBase segmentBase)
+      XmlPullParser xpp, String baseUrl, @Nullable SegmentBase segmentBase, long periodDurationMs)
       throws XmlPullParserException, IOException {
     int id = parseInt(xpp, "id", AdaptationSet.ID_UNSET);
     int contentType = parseContentType(xpp);
@@ -328,17 +328,19 @@ protected AdaptationSet parseAdaptationSet(
                 roleDescriptors,
                 accessibilityDescriptors,
                 supplementalProperties,
-                segmentBase);
+                segmentBase,
+                periodDurationMs);
         contentType = checkContentTypeConsistency(contentType,
             getContentType(representationInfo.format));
         representationInfos.add(representationInfo);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentBase")) {
         segmentBase = parseSegmentBase(xpp, (SingleSegmentBase) segmentBase);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentList")) {
-        segmentBase = parseSegmentList(xpp, (SegmentList) segmentBase);
+        segmentBase = parseSegmentList(xpp, (SegmentList) segmentBase, periodDurationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentTemplate")) {
         segmentBase =
-            parseSegmentTemplate(xpp, (SegmentTemplate) segmentBase, supplementalProperties);
+            parseSegmentTemplate(
+                xpp, (SegmentTemplate) segmentBase, supplementalProperties, periodDurationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "InbandEventStream")) {
         inbandEventStreams.add(parseDescriptor(xpp, "InbandEventStream"));
       } else if (XmlPullParserUtil.isStartTag(xpp)) {
@@ -492,7 +494,8 @@ protected RepresentationInfo parseRepresentation(
       List<Descriptor> adaptationSetRoleDescriptors,
       List<Descriptor> adaptationSetAccessibilityDescriptors,
       List<Descriptor> adaptationSetSupplementalProperties,
-      @Nullable SegmentBase segmentBase)
+      @Nullable SegmentBase segmentBase,
+      long periodDurationMs)
       throws XmlPullParserException, IOException {
     String id = xpp.getAttributeValue(null, "id");
     int bandwidth = parseInt(xpp, "bandwidth", Format.NO_VALUE);
@@ -522,11 +525,14 @@ protected RepresentationInfo parseRepresentation(
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentBase")) {
         segmentBase = parseSegmentBase(xpp, (SingleSegmentBase) segmentBase);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentList")) {
-        segmentBase = parseSegmentList(xpp, (SegmentList) segmentBase);
+        segmentBase = parseSegmentList(xpp, (SegmentList) segmentBase, periodDurationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentTemplate")) {
         segmentBase =
             parseSegmentTemplate(
-                xpp, (SegmentTemplate) segmentBase, adaptationSetSupplementalProperties);
+                xpp,
+                (SegmentTemplate) segmentBase,
+                adaptationSetSupplementalProperties,
+                periodDurationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "ContentProtection")) {
         Pair<String, SchemeData> contentProtection = parseContentProtection(xpp);
         if (contentProtection.first != null) {
@@ -717,7 +723,8 @@ protected SingleSegmentBase buildSingleSegmentBase(RangedUri initialization, lon
         indexLength);
   }
 
-  protected SegmentList parseSegmentList(XmlPullParser xpp, @Nullable SegmentList parent)
+  protected SegmentList parseSegmentList(
+      XmlPullParser xpp, @Nullable SegmentList parent, long periodDurationMs)
       throws XmlPullParserException, IOException {
 
     long timescale = parseLong(xpp, "timescale", parent != null ? parent.timescale : 1);
@@ -735,7 +742,7 @@ protected SegmentList parseSegmentList(XmlPullParser xpp, @Nullable SegmentList
       if (XmlPullParserUtil.isStartTag(xpp, "Initialization")) {
         initialization = parseInitialization(xpp);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentTimeline")) {
-        timeline = parseSegmentTimeline(xpp);
+        timeline = parseSegmentTimeline(xpp, timescale, periodDurationMs);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentURL")) {
         if (segments == null) {
           segments = new ArrayList<>();
@@ -771,7 +778,8 @@ protected SegmentList buildSegmentList(
   protected SegmentTemplate parseSegmentTemplate(
       XmlPullParser xpp,
       @Nullable SegmentTemplate parent,
-      List<Descriptor> adaptationSetSupplementalProperties)
+      List<Descriptor> adaptationSetSupplementalProperties,
+      long periodDurationMs)
       throws XmlPullParserException, IOException {
     long timescale = parseLong(xpp, "timescale", parent != null ? parent.timescale : 1);
     long presentationTimeOffset = parseLong(xpp, "presentationTimeOffset",
@@ -794,7 +802,7 @@ protected SegmentTemplate parseSegmentTemplate(
       if (XmlPullParserUtil.isStartTag(xpp, "Initialization")) {
         initialization = parseInitialization(xpp);
       } else if (XmlPullParserUtil.isStartTag(xpp, "SegmentTimeline")) {
-        timeline = parseSegmentTimeline(xpp);
+        timeline = parseSegmentTimeline(xpp, timescale, periodDurationMs);
       } else {
         maybeSkipTag(xpp);
       }
@@ -989,29 +997,79 @@ protected EventMessage buildEvent(
     return new EventMessage(schemeIdUri, value, durationMs, id, messageData);
   }
 
-  protected List<SegmentTimelineElement> parseSegmentTimeline(XmlPullParser xpp)
+  protected List<SegmentTimelineElement> parseSegmentTimeline(
+      XmlPullParser xpp, long timescale, long periodDurationMs)
       throws XmlPullParserException, IOException {
     List<SegmentTimelineElement> segmentTimeline = new ArrayList<>();
-    long elapsedTime = 0;
+    long startTime = 0;
+    long elementDuration = C.TIME_UNSET;
+    int elementRepeatCount = 0;
+    boolean havePreviousTimelineElement = false;
     do {
       xpp.next();
       if (XmlPullParserUtil.isStartTag(xpp, "S")) {
-        elapsedTime = parseLong(xpp, "t", elapsedTime);
-        long duration = parseLong(xpp, "d", C.TIME_UNSET);
-        int count = 1 + parseInt(xpp, "r", 0);
-        for (int i = 0; i < count; i++) {
-          segmentTimeline.add(buildSegmentTimelineElement(elapsedTime, duration));
-          elapsedTime += duration;
+        long newStartTime = parseLong(xpp, "t", C.TIME_UNSET);
+        if (havePreviousTimelineElement) {
+          startTime =
+              addSegmentTimelineElementsToList(
+                  segmentTimeline,
+                  startTime,
+                  elementDuration,
+                  elementRepeatCount,
+                  /* endTime= */ newStartTime);
         }
+        if (newStartTime != C.TIME_UNSET) {
+          startTime = newStartTime;
+        }
+        elementDuration = parseLong(xpp, "d", C.TIME_UNSET);
+        elementRepeatCount = parseInt(xpp, "r", 0);
+        havePreviousTimelineElement = true;
       } else {
         maybeSkipTag(xpp);
       }
     } while (!XmlPullParserUtil.isEndTag(xpp, "SegmentTimeline"));
+    if (havePreviousTimelineElement) {
+      long periodDuration = Util.scaleLargeTimestamp(periodDurationMs, timescale, 1000);
+      addSegmentTimelineElementsToList(
+          segmentTimeline,
+          startTime,
+          elementDuration,
+          elementRepeatCount,
+          /* endTime= */ periodDuration);
+    }
     return segmentTimeline;
   }
 
-  protected SegmentTimelineElement buildSegmentTimelineElement(long elapsedTime, long duration) {
-    return new SegmentTimelineElement(elapsedTime, duration);
+  /**
+   * Adds timeline elements for one S tag to the segment timeline.
+   *
+   * @param startTime Start time of the first timeline element.
+   * @param elementDuration Duration of one timeline element.
+   * @param elementRepeatCount Number of timeline elements minus one. May be negative to indicate
+   *     that the count is determined by the total duration and the element duration.
+   * @param endTime End time of the last timeline element for this S tag, or {@link C#TIME_UNSET} if
+   *     unknown. Only needed if {@code repeatCount} is negative.
+   * @return Calculated next start time.
+   */
+  private long addSegmentTimelineElementsToList(
+      List<SegmentTimelineElement> segmentTimeline,
+      long startTime,
+      long elementDuration,
+      int elementRepeatCount,
+      long endTime) {
+    int count =
+        elementRepeatCount >= 0
+            ? 1 + elementRepeatCount
+            : (int) Util.ceilDivide(endTime - startTime, elementDuration);
+    for (int i = 0; i < count; i++) {
+      segmentTimeline.add(buildSegmentTimelineElement(startTime, elementDuration));
+      startTime += elementDuration;
+    }
+    return startTime;
+  }
+
+  protected SegmentTimelineElement buildSegmentTimelineElement(long startTime, long duration) {
+    return new SegmentTimelineElement(startTime, duration);
   }
 
   @Nullable
diff --git a/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/SegmentBase.java b/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/SegmentBase.java
index a31e0329af..db7c8d6471 100644
--- a/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/SegmentBase.java
+++ b/library/dash/src/main/java/com/google/android/exoplayer2/source/dash/manifest/SegmentBase.java
@@ -397,6 +397,22 @@ public SegmentTimelineElement(long startTime, long duration) {
       this.duration = duration;
     }
 
+    @Override
+    public boolean equals(@Nullable Object o) {
+      if (this == o) {
+        return true;
+      }
+      if (o == null || getClass() != o.getClass()) {
+        return false;
+      }
+      SegmentTimelineElement that = (SegmentTimelineElement) o;
+      return startTime == that.startTime && duration == that.duration;
+    }
+
+    @Override
+    public int hashCode() {
+      return 31 * (int) startTime + (int) duration;
+    }
   }
 
 }
diff --git a/library/dash/src/test/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParserTest.java b/library/dash/src/test/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParserTest.java
index d1e795e643..6f5bc5c83d 100644
--- a/library/dash/src/test/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParserTest.java
+++ b/library/dash/src/test/java/com/google/android/exoplayer2/source/dash/manifest/DashManifestParserTest.java
@@ -23,14 +23,18 @@
 import com.google.android.exoplayer2.C;
 import com.google.android.exoplayer2.Format;
 import com.google.android.exoplayer2.metadata.emsg.EventMessage;
+import com.google.android.exoplayer2.source.dash.manifest.SegmentBase.SegmentTimelineElement;
 import com.google.android.exoplayer2.testutil.TestUtil;
 import com.google.android.exoplayer2.util.Util;
 import java.io.IOException;
+import java.io.StringReader;
 import java.nio.charset.Charset;
 import java.util.Collections;
 import java.util.List;
 import org.junit.Test;
 import org.junit.runner.RunWith;
+import org.xmlpull.v1.XmlPullParser;
+import org.xmlpull.v1.XmlPullParserFactory;
 
 /** Unit tests for {@link DashManifestParser}. */
 @RunWith(AndroidJUnit4.class)
@@ -255,6 +259,74 @@ public void testParseCea708AccessibilityChannel() {
         .isEqualTo(Format.NO_VALUE);
   }
 
+  @Test
+  public void parseSegmentTimeline_withRepeatCount() throws Exception {
+    DashManifestParser parser = new DashManifestParser();
+    XmlPullParser xpp = XmlPullParserFactory.newInstance().newPullParser();
+    xpp.setInput(
+        new StringReader(
+            "<SegmentTimeline><S d=\"96000\" r=\"2\"/><S d=\"48000\" r=\"0\"/></SegmentTimeline>"));
+    xpp.next();
+
+    List<SegmentTimelineElement> elements =
+        parser.parseSegmentTimeline(xpp, /* timescale= */ 48000, /* periodDurationMs= */ 10000);
+
+    assertThat(elements)
+        .containsExactly(
+            new SegmentTimelineElement(/* startTime= */ 0, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 96000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 192000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 288000, /* duration= */ 48000))
+        .inOrder();
+  }
+
+  @Test
+  public void parseSegmentTimeline_withSingleUndefinedRepeatCount() throws Exception {
+    DashManifestParser parser = new DashManifestParser();
+    XmlPullParser xpp = XmlPullParserFactory.newInstance().newPullParser();
+    xpp.setInput(new StringReader("<SegmentTimeline><S d=\"96000\" r=\"-1\"/></SegmentTimeline>"));
+    xpp.next();
+
+    List<SegmentTimelineElement> elements =
+        parser.parseSegmentTimeline(xpp, /* timescale= */ 48000, /* periodDurationMs= */ 10000);
+
+    assertThat(elements)
+        .containsExactly(
+            new SegmentTimelineElement(/* startTime= */ 0, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 96000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 192000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 288000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 384000, /* duration= */ 96000))
+        .inOrder();
+  }
+
+  @Test
+  public void parseSegmentTimeline_withTimeOffsetsAndUndefinedRepeatCount() throws Exception {
+    DashManifestParser parser = new DashManifestParser();
+    XmlPullParser xpp = XmlPullParserFactory.newInstance().newPullParser();
+    xpp.setInput(
+        new StringReader(
+            "<SegmentTimeline><S t=\"0\" "
+                + "d=\"96000\" r=\"-1\"/><S t=\"192000\" d=\"48000\" r=\"-1\"/>"
+                + "</SegmentTimeline>"));
+    xpp.next();
+
+    List<SegmentTimelineElement> elements =
+        parser.parseSegmentTimeline(xpp, /* timescale= */ 48000, /* periodDurationMs= */ 10000);
+
+    assertThat(elements)
+        .containsExactly(
+            new SegmentTimelineElement(/* startTime= */ 0, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 96000, /* duration= */ 96000),
+            new SegmentTimelineElement(/* startTime= */ 192000, /* duration= */ 48000),
+            new SegmentTimelineElement(/* startTime= */ 240000, /* duration= */ 48000),
+            new SegmentTimelineElement(/* startTime= */ 288000, /* duration= */ 48000),
+            new SegmentTimelineElement(/* startTime= */ 336000, /* duration= */ 48000),
+            new SegmentTimelineElement(/* startTime= */ 384000, /* duration= */ 48000),
+            new SegmentTimelineElement(/* startTime= */ 432000, /* duration= */ 48000))
+        .inOrder();
+  }
+
   private static List<Descriptor> buildCea608AccessibilityDescriptors(String value) {
     return Collections.singletonList(new Descriptor("urn:scte:dash:cc:cea-608:2015", value, null));
   }
diff --git a/library/hls/build.gradle b/library/hls/build.gradle
index 07e27960d5..7017491127 100644
--- a/library/hls/build.gradle
+++ b/library/hls/build.gradle
@@ -39,7 +39,7 @@ android {
 }
 
 dependencies {
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     compileOnly 'org.checkerframework:checker-compat-qual:' + checkerframeworkVersionC
     implementation project(modulePrefix + 'library-core')
diff --git a/library/smoothstreaming/build.gradle b/library/smoothstreaming/build.gradle
index c5815b424f..7b1d6fe58f 100644
--- a/library/smoothstreaming/build.gradle
+++ b/library/smoothstreaming/build.gradle
@@ -42,7 +42,7 @@ dependencies {
     implementation project(modulePrefix + 'library-core')
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     compileOnly 'org.checkerframework:checker-compat-qual:' + checkerframeworkVersionC
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
 }
diff --git a/library/ui/build.gradle b/library/ui/build.gradle
index 5b3123e302..509dd22a28 100644
--- a/library/ui/build.gradle
+++ b/library/ui/build.gradle
@@ -40,8 +40,8 @@ android {
 
 dependencies {
     implementation project(modulePrefix + 'library-core')
-    implementation 'androidx.media:media:1.0.1'
-    implementation 'androidx.annotation:annotation:1.1.0'
+    api 'androidx.media:media:' + androidxMediaVersion
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     compileOnly 'org.checkerframework:checker-qual:' + checkerframeworkVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
diff --git a/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerControlView.java b/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerControlView.java
index 0765105314..fd949db6a2 100644
--- a/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerControlView.java
+++ b/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerControlView.java
@@ -238,7 +238,7 @@
   private final View fastForwardButton;
   private final View rewindButton;
   private final ImageView repeatToggleButton;
-  private final View shuffleButton;
+  private final ImageView shuffleButton;
   private final View vrButton;
   private final TextView durationView;
   private final TextView positionView;
@@ -256,6 +256,12 @@
   private final String repeatOffButtonContentDescription;
   private final String repeatOneButtonContentDescription;
   private final String repeatAllButtonContentDescription;
+  private final Drawable shuffleOnButtonDrawable;
+  private final Drawable shuffleOffButtonDrawable;
+  private final float buttonAlphaEnabled;
+  private final float buttonAlphaDisabled;
+  private final String shuffleOnContentDescription;
+  private final String shuffleOffContentDescription;
 
   @Nullable private Player player;
   private com.google.android.exoplayer2.ControlDispatcher controlDispatcher;
@@ -403,16 +409,28 @@ public PlayerControlView(
     }
     vrButton = findViewById(R.id.exo_vr);
     setShowVrButton(false);
+
     Resources resources = context.getResources();
+
+    buttonAlphaEnabled =
+        (float) resources.getInteger(R.integer.exo_media_button_opacity_percentage_enabled) / 100;
+    buttonAlphaDisabled =
+        (float) resources.getInteger(R.integer.exo_media_button_opacity_percentage_disabled) / 100;
+
     repeatOffButtonDrawable = resources.getDrawable(R.drawable.exo_controls_repeat_off);
     repeatOneButtonDrawable = resources.getDrawable(R.drawable.exo_controls_repeat_one);
     repeatAllButtonDrawable = resources.getDrawable(R.drawable.exo_controls_repeat_all);
+    shuffleOnButtonDrawable = resources.getDrawable(R.drawable.exo_controls_shuffle_on);
+    shuffleOffButtonDrawable = resources.getDrawable(R.drawable.exo_controls_shuffle_off);
     repeatOffButtonContentDescription =
         resources.getString(R.string.exo_controls_repeat_off_description);
     repeatOneButtonContentDescription =
         resources.getString(R.string.exo_controls_repeat_one_description);
     repeatAllButtonContentDescription =
         resources.getString(R.string.exo_controls_repeat_all_description);
+    shuffleOnContentDescription = resources.getString(R.string.exo_controls_shuffle_on_description);
+    shuffleOffContentDescription =
+        resources.getString(R.string.exo_controls_shuffle_off_description);
   }
 
   @SuppressWarnings("ResourceType")
@@ -787,6 +805,8 @@ private void updateRepeatModeButton() {
     }
     if (player == null) {
       setButtonEnabled(false, repeatToggleButton);
+      repeatToggleButton.setImageDrawable(repeatOffButtonDrawable);
+      repeatToggleButton.setContentDescription(repeatOffButtonContentDescription);
       return;
     }
     setButtonEnabled(true, repeatToggleButton);
@@ -817,10 +837,16 @@ private void updateShuffleButton() {
       shuffleButton.setVisibility(GONE);
     } else if (player == null) {
       setButtonEnabled(false, shuffleButton);
+      shuffleButton.setImageDrawable(shuffleOffButtonDrawable);
+      shuffleButton.setContentDescription(shuffleOffContentDescription);
     } else {
-      shuffleButton.setAlpha(player.getShuffleModeEnabled() ? 1f : 0.3f);
-      shuffleButton.setEnabled(true);
-      shuffleButton.setVisibility(VISIBLE);
+      setButtonEnabled(true, shuffleButton);
+      shuffleButton.setImageDrawable(
+          player.getShuffleModeEnabled() ? shuffleOnButtonDrawable : shuffleOffButtonDrawable);
+      shuffleButton.setContentDescription(
+          player.getShuffleModeEnabled()
+              ? shuffleOnContentDescription
+              : shuffleOffContentDescription);
     }
   }
 
@@ -954,7 +980,7 @@ private void setButtonEnabled(boolean enabled, View view) {
       return;
     }
     view.setEnabled(enabled);
-    view.setAlpha(enabled ? 1f : 0.3f);
+    view.setAlpha(enabled ? buttonAlphaEnabled : buttonAlphaDisabled);
     view.setVisibility(VISIBLE);
   }
 
diff --git a/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerNotificationManager.java b/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerNotificationManager.java
index 8ad00e1dda..e4fcb37af3 100644
--- a/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerNotificationManager.java
+++ b/library/ui/src/main/java/com/google/android/exoplayer2/ui/PlayerNotificationManager.java
@@ -1182,10 +1182,10 @@ private void stopNotification(boolean dismissedByUser) {
     if (skipPreviousActionIndex != -1) {
       actionIndices[actionCounter++] = skipPreviousActionIndex;
     }
-    boolean playWhenReady = player.getPlayWhenReady();
-    if (pauseActionIndex != -1 && playWhenReady) {
+    boolean isPlaying = isPlaying(player);
+    if (pauseActionIndex != -1 && isPlaying) {
       actionIndices[actionCounter++] = pauseActionIndex;
-    } else if (playActionIndex != -1 && !playWhenReady) {
+    } else if (playActionIndex != -1 && !isPlaying) {
       actionIndices[actionCounter++] = playActionIndex;
     }
     if (skipNextActionIndex != -1) {
diff --git a/library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle_off.xml b/library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle_off.xml
new file mode 100644
index 0000000000..283ce30c3c
--- /dev/null
+++ b/library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle_off.xml
@@ -0,0 +1,26 @@
+<!-- Copyright (C) 2017 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="32dp"
+    android:height="32dp"
+    android:viewportWidth="24.0"
+    android:viewportHeight="24.0">
+
+    <path
+        android:fillColor="#4EFFFFFF"
+        android:pathData="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20
+17.96 7.46 20 9.5V4h-5.5zm0.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04
+2.04-3.13-3.13z" />
+</vector>
diff --git a/library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle.xml b/library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle_on.xml
similarity index 100%
rename from library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle.xml
rename to library/ui/src/main/res/drawable-anydpi-v21/exo_controls_shuffle_on.xml
diff --git a/library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle_off.png b/library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle_off.png
new file mode 100644
index 0000000000..b693422db7
Binary files /dev/null and b/library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle_off.png differ
diff --git a/library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle.png b/library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle_on.png
similarity index 100%
rename from library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle.png
rename to library/ui/src/main/res/drawable-hdpi/exo_controls_shuffle_on.png
diff --git a/library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle_off.png b/library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle_off.png
new file mode 100644
index 0000000000..2353dd4289
Binary files /dev/null and b/library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle_off.png differ
diff --git a/library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle.png b/library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle_on.png
similarity index 100%
rename from library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle.png
rename to library/ui/src/main/res/drawable-ldpi/exo_controls_shuffle_on.png
diff --git a/library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle_off.png b/library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle_off.png
new file mode 100644
index 0000000000..a55d716cce
Binary files /dev/null and b/library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle_off.png differ
diff --git a/library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle.png b/library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle_on.png
similarity index 100%
rename from library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle.png
rename to library/ui/src/main/res/drawable-mdpi/exo_controls_shuffle_on.png
diff --git a/library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle_off.png b/library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle_off.png
new file mode 100644
index 0000000000..2b67cabf5a
Binary files /dev/null and b/library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle_off.png differ
diff --git a/library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle.png b/library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle_on.png
similarity index 100%
rename from library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle.png
rename to library/ui/src/main/res/drawable-xhdpi/exo_controls_shuffle_on.png
diff --git a/library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle_off.png b/library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle_off.png
new file mode 100644
index 0000000000..22209d1f88
Binary files /dev/null and b/library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle_off.png differ
diff --git a/library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle.png b/library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle_on.png
similarity index 100%
rename from library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle.png
rename to library/ui/src/main/res/drawable-xxhdpi/exo_controls_shuffle_on.png
diff --git a/library/ui/src/main/res/layout/exo_playback_control_view.xml b/library/ui/src/main/res/layout/exo_playback_control_view.xml
index 027e57ee92..acfddf1146 100644
--- a/library/ui/src/main/res/layout/exo_playback_control_view.xml
+++ b/library/ui/src/main/res/layout/exo_playback_control_view.xml
@@ -37,7 +37,7 @@
       style="@style/ExoMediaButton.Rewind"/>
 
     <ImageButton android:id="@id/exo_shuffle"
-      style="@style/ExoMediaButton.Shuffle"/>
+      style="@style/ExoMediaButton"/>
 
     <ImageButton android:id="@id/exo_repeat_toggle"
       style="@style/ExoMediaButton"/>
diff --git a/library/ui/src/main/res/values-af/strings.xml b/library/ui/src/main/res/values-af/strings.xml
index 8a983c543a..fa630292a9 100644
--- a/library/ui/src/main/res/values-af/strings.xml
+++ b/library/ui/src/main/res/values-af/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Vorige snit</string>
   <string name="exo_controls_next_description">Volgende snit</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Herhaal niks</string>
   <string name="exo_controls_repeat_one_description">Herhaal een</string>
   <string name="exo_controls_repeat_all_description">Herhaal alles</string>
-  <string name="exo_controls_shuffle_description">Skommel</string>
+  <string name="exo_controls_shuffle_on_description">Skommel</string>
   <string name="exo_controls_fullscreen_description">Volskermmodus</string>
   <string name="exo_controls_vr_description">VR-modus</string>
   <string name="exo_download_description">Aflaai</string>
diff --git a/library/ui/src/main/res/values-am/strings.xml b/library/ui/src/main/res/values-am/strings.xml
index f56a6c06bf..b754aa90ea 100644
--- a/library/ui/src/main/res/values-am/strings.xml
+++ b/library/ui/src/main/res/values-am/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ar/strings.xml b/library/ui/src/main/res/values-ar/strings.xml
index 91063e1a54..87cad1be25 100644
--- a/library/ui/src/main/res/values-ar/strings.xml
+++ b/library/ui/src/main/res/values-ar/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">  </string>
   <string name="exo_controls_next_description">  </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description">   </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-az/strings.xml b/library/ui/src/main/res/values-az/strings.xml
index 0f5fbe3f4d..ddfc653731 100644
--- a/library/ui/src/main/res/values-az/strings.xml
+++ b/library/ui/src/main/res/values-az/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">vvlki trek</string>
   <string name="exo_controls_next_description">Nvbti trek</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">He biri tkrarlanmasn</string>
   <string name="exo_controls_repeat_one_description">Biri tkrarlansn</string>
   <string name="exo_controls_repeat_all_description">Hams tkrarlansn</string>
-  <string name="exo_controls_shuffle_description">Qardrn</string>
+  <string name="exo_controls_shuffle_on_description">Qardrn</string>
   <string name="exo_controls_fullscreen_description">Tam ekran rejimi</string>
   <string name="exo_controls_vr_description">VR rejimi</string>
   <string name="exo_download_description">Endirin</string>
diff --git a/library/ui/src/main/res/values-b+sr+Latn/strings.xml b/library/ui/src/main/res/values-b+sr+Latn/strings.xml
index 16300747f7..73c4223d8c 100644
--- a/library/ui/src/main/res/values-b+sr+Latn/strings.xml
+++ b/library/ui/src/main/res/values-b+sr+Latn/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Prethodna pesma</string>
   <string name="exo_controls_next_description">Sledeca pesma</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ne ponavljaj nijednu</string>
   <string name="exo_controls_repeat_one_description">Ponovi jednu</string>
   <string name="exo_controls_repeat_all_description">Ponovi sve</string>
-  <string name="exo_controls_shuffle_description">Pusti nasumino</string>
+  <string name="exo_controls_shuffle_on_description">Pusti nasumino</string>
   <string name="exo_controls_fullscreen_description">Reim celog ekrana</string>
   <string name="exo_controls_vr_description">VR reim</string>
   <string name="exo_download_description">Preuzmi</string>
diff --git a/library/ui/src/main/res/values-be/strings.xml b/library/ui/src/main/res/values-be/strings.xml
index 6a33be2a8f..7187494eca 100644
--- a/library/ui/src/main/res/values-be/strings.xml
+++ b/library/ui/src/main/res/values-be/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR-</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-bg/strings.xml b/library/ui/src/main/res/values-bg/strings.xml
index 511a5e4f19..f7dcd29e49 100644
--- a/library/ui/src/main/res/values-bg/strings.xml
+++ b/library/ui/src/main/res/values-bg/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description">   </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">   </string>
   <string name="exo_controls_vr_description">  VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-bn/strings.xml b/library/ui/src/main/res/values-bn/strings.xml
index cca445feca..6ccd22744c 100644
--- a/library/ui/src/main/res/values-bn/strings.xml
+++ b/library/ui/src/main/res/values-bn/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">    </string>
   <string name="exo_controls_repeat_one_description">   </string>
   <string name="exo_controls_repeat_all_description">   </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-bs/strings.xml b/library/ui/src/main/res/values-bs/strings.xml
index 24fb7b2b3b..a9a960285f 100644
--- a/library/ui/src/main/res/values-bs/strings.xml
+++ b/library/ui/src/main/res/values-bs/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Prethodna numera</string>
   <string name="exo_controls_next_description">Sljedea numera</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ne ponavljaj</string>
   <string name="exo_controls_repeat_one_description">Ponovi jedno</string>
   <string name="exo_controls_repeat_all_description">Ponovi sve</string>
-  <string name="exo_controls_shuffle_description">Izmijeaj</string>
+  <string name="exo_controls_shuffle_on_description">Izmijeaj</string>
   <string name="exo_controls_fullscreen_description">Nain rada preko cijelog ekrana</string>
   <string name="exo_controls_vr_description">VR nain rada</string>
   <string name="exo_download_description">Preuzmi</string>
diff --git a/library/ui/src/main/res/values-ca/strings.xml b/library/ui/src/main/res/values-ca/strings.xml
index 3b48eab3b8..39a3ce85c9 100644
--- a/library/ui/src/main/res/values-ca/strings.xml
+++ b/library/ui/src/main/res/values-ca/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Pista anterior</string>
   <string name="exo_controls_next_description">Pista segent</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">No en repeteixis cap</string>
   <string name="exo_controls_repeat_one_description">Repeteix una</string>
   <string name="exo_controls_repeat_all_description">Repeteix tot</string>
-  <string name="exo_controls_shuffle_description">Reprodueix aleatriament</string>
+  <string name="exo_controls_shuffle_on_description">Reprodueix aleatriament</string>
   <string name="exo_controls_fullscreen_description">Mode de pantalla completa</string>
   <string name="exo_controls_vr_description">ModeRV</string>
   <string name="exo_download_description">Baixa</string>
diff --git a/library/ui/src/main/res/values-cs/strings.xml b/library/ui/src/main/res/values-cs/strings.xml
index 1568074f9f..1ad837b32d 100644
--- a/library/ui/src/main/res/values-cs/strings.xml
+++ b/library/ui/src/main/res/values-cs/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Pedchoz skladba</string>
   <string name="exo_controls_next_description">Dal skladba</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Neopakovat</string>
   <string name="exo_controls_repeat_one_description">Opakovat jednu</string>
   <string name="exo_controls_repeat_all_description">Opakovat ve</string>
-  <string name="exo_controls_shuffle_description">Nhodn</string>
+  <string name="exo_controls_shuffle_on_description">Nhodn</string>
   <string name="exo_controls_fullscreen_description">Reim cel obrazovky</string>
   <string name="exo_controls_vr_description">Reim VR</string>
   <string name="exo_download_description">Sthnout</string>
diff --git a/library/ui/src/main/res/values-da/strings.xml b/library/ui/src/main/res/values-da/strings.xml
index 19b0f09446..2bef98e781 100644
--- a/library/ui/src/main/res/values-da/strings.xml
+++ b/library/ui/src/main/res/values-da/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Afspil forrige</string>
   <string name="exo_controls_next_description">Afspil nste</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Gentag ingen</string>
   <string name="exo_controls_repeat_one_description">Gentag n</string>
   <string name="exo_controls_repeat_all_description">Gentag alle</string>
-  <string name="exo_controls_shuffle_description">Bland</string>
+  <string name="exo_controls_shuffle_on_description">Bland</string>
   <string name="exo_controls_fullscreen_description">Fuld skrm</string>
   <string name="exo_controls_vr_description">VR-tilstand</string>
   <string name="exo_download_description">Download</string>
diff --git a/library/ui/src/main/res/values-de/strings.xml b/library/ui/src/main/res/values-de/strings.xml
index 1bb620dd2b..e06459de8d 100644
--- a/library/ui/src/main/res/values-de/strings.xml
+++ b/library/ui/src/main/res/values-de/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Vorheriger Titel</string>
   <string name="exo_controls_next_description">Nchster Titel</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Keinen wiederholen</string>
   <string name="exo_controls_repeat_one_description">Einen wiederholen</string>
   <string name="exo_controls_repeat_all_description">Alle wiederholen</string>
-  <string name="exo_controls_shuffle_description">Zufallsmix</string>
+  <string name="exo_controls_shuffle_on_description">Zufallsmix</string>
   <string name="exo_controls_fullscreen_description">Vollbildmodus</string>
   <string name="exo_controls_vr_description">VR-Modus</string>
   <string name="exo_download_description">Herunterladen</string>
diff --git a/library/ui/src/main/res/values-el/strings.xml b/library/ui/src/main/res/values-el/strings.xml
index 1ddbe4a5fa..47144dc00c 100644
--- a/library/ui/src/main/res/values-el/strings.xml
+++ b/library/ui/src/main/res/values-el/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> VR mode</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-en-rAU/strings.xml b/library/ui/src/main/res/values-en-rAU/strings.xml
index cf25e2ada0..62125c5226 100644
--- a/library/ui/src/main/res/values-en-rAU/strings.xml
+++ b/library/ui/src/main/res/values-en-rAU/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Previous track</string>
   <string name="exo_controls_next_description">Next track</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Repeat none</string>
   <string name="exo_controls_repeat_one_description">Repeat one</string>
   <string name="exo_controls_repeat_all_description">Repeat all</string>
-  <string name="exo_controls_shuffle_description">Shuffle</string>
+  <string name="exo_controls_shuffle_on_description">Shuffle</string>
   <string name="exo_controls_fullscreen_description">Full-screen mode</string>
   <string name="exo_controls_vr_description">VR mode</string>
   <string name="exo_download_description">Download</string>
diff --git a/library/ui/src/main/res/values-en-rGB/strings.xml b/library/ui/src/main/res/values-en-rGB/strings.xml
index cf25e2ada0..62125c5226 100644
--- a/library/ui/src/main/res/values-en-rGB/strings.xml
+++ b/library/ui/src/main/res/values-en-rGB/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Previous track</string>
   <string name="exo_controls_next_description">Next track</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Repeat none</string>
   <string name="exo_controls_repeat_one_description">Repeat one</string>
   <string name="exo_controls_repeat_all_description">Repeat all</string>
-  <string name="exo_controls_shuffle_description">Shuffle</string>
+  <string name="exo_controls_shuffle_on_description">Shuffle</string>
   <string name="exo_controls_fullscreen_description">Full-screen mode</string>
   <string name="exo_controls_vr_description">VR mode</string>
   <string name="exo_download_description">Download</string>
diff --git a/library/ui/src/main/res/values-en-rIN/strings.xml b/library/ui/src/main/res/values-en-rIN/strings.xml
index cf25e2ada0..62125c5226 100644
--- a/library/ui/src/main/res/values-en-rIN/strings.xml
+++ b/library/ui/src/main/res/values-en-rIN/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Previous track</string>
   <string name="exo_controls_next_description">Next track</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Repeat none</string>
   <string name="exo_controls_repeat_one_description">Repeat one</string>
   <string name="exo_controls_repeat_all_description">Repeat all</string>
-  <string name="exo_controls_shuffle_description">Shuffle</string>
+  <string name="exo_controls_shuffle_on_description">Shuffle</string>
   <string name="exo_controls_fullscreen_description">Full-screen mode</string>
   <string name="exo_controls_vr_description">VR mode</string>
   <string name="exo_download_description">Download</string>
diff --git a/library/ui/src/main/res/values-es-rUS/strings.xml b/library/ui/src/main/res/values-es-rUS/strings.xml
index ceeb0b8497..beeeba4e9c 100644
--- a/library/ui/src/main/res/values-es-rUS/strings.xml
+++ b/library/ui/src/main/res/values-es-rUS/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Pista anterior</string>
   <string name="exo_controls_next_description">Pista siguiente</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">No repetir</string>
   <string name="exo_controls_repeat_one_description">Repetir uno</string>
   <string name="exo_controls_repeat_all_description">Repetir todo</string>
-  <string name="exo_controls_shuffle_description">Reproducir aleatoriamente</string>
+  <string name="exo_controls_shuffle_on_description">Reproducir aleatoriamente</string>
   <string name="exo_controls_fullscreen_description">Modo de pantalla completa</string>
   <string name="exo_controls_vr_description">Modo RV</string>
   <string name="exo_download_description">Descargar</string>
diff --git a/library/ui/src/main/res/values-es/strings.xml b/library/ui/src/main/res/values-es/strings.xml
index 0118da57be..e880d66bf0 100644
--- a/library/ui/src/main/res/values-es/strings.xml
+++ b/library/ui/src/main/res/values-es/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Pista anterior</string>
   <string name="exo_controls_next_description">Siguiente pista</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">No repetir</string>
   <string name="exo_controls_repeat_one_description">Repetir uno</string>
   <string name="exo_controls_repeat_all_description">Repetir todo</string>
-  <string name="exo_controls_shuffle_description">Reproducir aleatoriamente</string>
+  <string name="exo_controls_shuffle_on_description">Reproducir aleatoriamente</string>
   <string name="exo_controls_fullscreen_description">Modo de pantalla completa</string>
   <string name="exo_controls_vr_description">ModoRV</string>
   <string name="exo_download_description">Descargar</string>
diff --git a/library/ui/src/main/res/values-et/strings.xml b/library/ui/src/main/res/values-et/strings.xml
index 99ca9548ed..515c665181 100644
--- a/library/ui/src/main/res/values-et/strings.xml
+++ b/library/ui/src/main/res/values-et/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Eelmine lugu</string>
   <string name="exo_controls_next_description">Jrgmine lugu</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">ra korda htegi</string>
   <string name="exo_controls_repeat_one_description">Korda hte</string>
   <string name="exo_controls_repeat_all_description">Korda kiki</string>
-  <string name="exo_controls_shuffle_description">Esita juhuslikus jrjekorras</string>
+  <string name="exo_controls_shuffle_on_description">Esita juhuslikus jrjekorras</string>
   <string name="exo_controls_fullscreen_description">Tisekraani reiim</string>
   <string name="exo_controls_vr_description">VR-reiim</string>
   <string name="exo_download_description">Allalaadimine</string>
diff --git a/library/ui/src/main/res/values-eu/strings.xml b/library/ui/src/main/res/values-eu/strings.xml
index 4d992fee0f..3f3d75d4f8 100644
--- a/library/ui/src/main/res/values-eu/strings.xml
+++ b/library/ui/src/main/res/values-eu/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Aurreko pista</string>
   <string name="exo_controls_next_description">Hurrengo pista</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ez errepikatu</string>
   <string name="exo_controls_repeat_one_description">Errepikatu bat</string>
   <string name="exo_controls_repeat_all_description">Errepikatu guztiak</string>
-  <string name="exo_controls_shuffle_description">Erreproduzitu ausaz</string>
+  <string name="exo_controls_shuffle_on_description">Erreproduzitu ausaz</string>
   <string name="exo_controls_fullscreen_description">Pantaila osoko modua</string>
   <string name="exo_controls_vr_description">EB modua</string>
   <string name="exo_download_description">Deskargak</string>
diff --git a/library/ui/src/main/res/values-fa/strings.xml b/library/ui/src/main/res/values-fa/strings.xml
index fed94b5569..dfc74a9c21 100644
--- a/library/ui/src/main/res/values-fa/strings.xml
+++ b/library/ui/src/main/res/values-fa/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">  </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-fi/strings.xml b/library/ui/src/main/res/values-fi/strings.xml
index 0dc2f9d346..c0e53c437b 100644
--- a/library/ui/src/main/res/values-fi/strings.xml
+++ b/library/ui/src/main/res/values-fi/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Edellinen kappale</string>
   <string name="exo_controls_next_description">Seuraava kappale</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ei uudelleentoistoa</string>
   <string name="exo_controls_repeat_one_description">Toista yksi uudelleen</string>
   <string name="exo_controls_repeat_all_description">Toista kaikki uudelleen</string>
-  <string name="exo_controls_shuffle_description">Satunnaistoisto</string>
+  <string name="exo_controls_shuffle_on_description">Satunnaistoisto</string>
   <string name="exo_controls_fullscreen_description">Koko nytn tila</string>
   <string name="exo_controls_vr_description">VR-tila</string>
   <string name="exo_download_description">Lataa</string>
diff --git a/library/ui/src/main/res/values-fr-rCA/strings.xml b/library/ui/src/main/res/values-fr-rCA/strings.xml
index 0f3534924f..ef42066df3 100644
--- a/library/ui/src/main/res/values-fr-rCA/strings.xml
+++ b/library/ui/src/main/res/values-fr-rCA/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Chanson prcdente</string>
   <string name="exo_controls_next_description">Chanson suivante</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ne rien lire en boucle</string>
   <string name="exo_controls_repeat_one_description">Lire une chanson en boucle</string>
   <string name="exo_controls_repeat_all_description">Tout lire en boucle</string>
-  <string name="exo_controls_shuffle_description">Lecture alatoire</string>
+  <string name="exo_controls_shuffle_on_description">Lecture alatoire</string>
   <string name="exo_controls_fullscreen_description">Mode Plein cran</string>
   <string name="exo_controls_vr_description">ModeRV</string>
   <string name="exo_download_description">Tlcharger</string>
diff --git a/library/ui/src/main/res/values-fr/strings.xml b/library/ui/src/main/res/values-fr/strings.xml
index 46c07f531e..057a6a8f67 100644
--- a/library/ui/src/main/res/values-fr/strings.xml
+++ b/library/ui/src/main/res/values-fr/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Titre prcdent</string>
   <string name="exo_controls_next_description">Titre suivant</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ne rien lire en boucle</string>
   <string name="exo_controls_repeat_one_description">Lire un titre en boucle</string>
   <string name="exo_controls_repeat_all_description">Tout lire en boucle</string>
-  <string name="exo_controls_shuffle_description">Alatoire</string>
+  <string name="exo_controls_shuffle_on_description">Alatoire</string>
   <string name="exo_controls_fullscreen_description">Mode plein cran</string>
   <string name="exo_controls_vr_description">Mode RV</string>
   <string name="exo_download_description">Tlcharger</string>
diff --git a/library/ui/src/main/res/values-gl/strings.xml b/library/ui/src/main/res/values-gl/strings.xml
index e6689353f1..419ea0c552 100644
--- a/library/ui/src/main/res/values-gl/strings.xml
+++ b/library/ui/src/main/res/values-gl/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Pista anterior</string>
   <string name="exo_controls_next_description">Pista seguinte</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Non repetir</string>
   <string name="exo_controls_repeat_one_description">Repetir unha pista</string>
   <string name="exo_controls_repeat_all_description">Repetir todas as pistas</string>
-  <string name="exo_controls_shuffle_description">Reproducin aleatoria</string>
+  <string name="exo_controls_shuffle_on_description">Reproducin aleatoria</string>
   <string name="exo_controls_fullscreen_description">Modo de pantalla completa</string>
   <string name="exo_controls_vr_description">Modo RV</string>
   <string name="exo_download_description">Descargar</string>
diff --git a/library/ui/src/main/res/values-gu/strings.xml b/library/ui/src/main/res/values-gu/strings.xml
index 488eb39f6a..daec2b447d 100644
--- a/library/ui/src/main/res/values-gu/strings.xml
+++ b/library/ui/src/main/res/values-gu/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">   </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-hi/strings.xml b/library/ui/src/main/res/values-hi/strings.xml
index 8ba92054ff..0435e3eb84 100644
--- a/library/ui/src/main/res/values-hi/strings.xml
+++ b/library/ui/src/main/res/values-hi/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">   </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-hr/strings.xml b/library/ui/src/main/res/values-hr/strings.xml
index 4fa1942986..b36c9ff9e7 100644
--- a/library/ui/src/main/res/values-hr/strings.xml
+++ b/library/ui/src/main/res/values-hr/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Prethodni zapis</string>
   <string name="exo_controls_next_description">Sljedei zapis</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Bez ponavljanja</string>
   <string name="exo_controls_repeat_one_description">Ponovi jedno</string>
   <string name="exo_controls_repeat_all_description">Ponovi sve</string>
-  <string name="exo_controls_shuffle_description">Reproduciraj nasumino</string>
+  <string name="exo_controls_shuffle_on_description">Reproduciraj nasumino</string>
   <string name="exo_controls_fullscreen_description">Prikaz na cijelom zaslonu</string>
   <string name="exo_controls_vr_description">VR nain</string>
   <string name="exo_download_description">Preuzmi</string>
diff --git a/library/ui/src/main/res/values-hu/strings.xml b/library/ui/src/main/res/values-hu/strings.xml
index baf77650e0..ad67165cf8 100644
--- a/library/ui/src/main/res/values-hu/strings.xml
+++ b/library/ui/src/main/res/values-hu/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Elz szm</string>
   <string name="exo_controls_next_description">Kvetkez szm</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Nincs ismtls</string>
   <string name="exo_controls_repeat_one_description">Egy szm ismtlse</string>
   <string name="exo_controls_repeat_all_description">sszes szm ismtlse</string>
-  <string name="exo_controls_shuffle_description">Kevers</string>
+  <string name="exo_controls_shuffle_on_description">Kevers</string>
   <string name="exo_controls_fullscreen_description">Teljes kpernys md</string>
   <string name="exo_controls_vr_description">VR-md</string>
   <string name="exo_download_description">Letlts</string>
diff --git a/library/ui/src/main/res/values-hy/strings.xml b/library/ui/src/main/res/values-hy/strings.xml
index 04a2aeb140..31f4db37d2 100644
--- a/library/ui/src/main/res/values-hy/strings.xml
+++ b/library/ui/src/main/res/values-hy/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-in/strings.xml b/library/ui/src/main/res/values-in/strings.xml
index 7410576e81..d7bae9719d 100644
--- a/library/ui/src/main/res/values-in/strings.xml
+++ b/library/ui/src/main/res/values-in/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Lagu sebelumnya</string>
   <string name="exo_controls_next_description">Lagu berikutnya</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Jangan ulangi</string>
   <string name="exo_controls_repeat_one_description">Ulangi 1</string>
   <string name="exo_controls_repeat_all_description">Ulangi semua</string>
-  <string name="exo_controls_shuffle_description">Acak</string>
+  <string name="exo_controls_shuffle_on_description">Acak</string>
   <string name="exo_controls_fullscreen_description">Mode layar penuh</string>
   <string name="exo_controls_vr_description">Mode VR</string>
   <string name="exo_download_description">Download</string>
diff --git a/library/ui/src/main/res/values-is/strings.xml b/library/ui/src/main/res/values-is/strings.xml
index bdb27a6648..4c09db5251 100644
--- a/library/ui/src/main/res/values-is/strings.xml
+++ b/library/ui/src/main/res/values-is/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Fyrra lag</string>
   <string name="exo_controls_next_description">Nsta lag</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Endurtaka ekkert</string>
   <string name="exo_controls_repeat_one_description">Endurtaka eitt</string>
   <string name="exo_controls_repeat_all_description">Endurtaka allt</string>
-  <string name="exo_controls_shuffle_description">Stokka</string>
+  <string name="exo_controls_shuffle_on_description">Stokka</string>
   <string name="exo_controls_fullscreen_description">Allur skjrinn</string>
   <string name="exo_controls_vr_description">sndarveruleikastilling</string>
   <string name="exo_download_description">Skja</string>
diff --git a/library/ui/src/main/res/values-it/strings.xml b/library/ui/src/main/res/values-it/strings.xml
index ffa05821e9..e10a62a11b 100644
--- a/library/ui/src/main/res/values-it/strings.xml
+++ b/library/ui/src/main/res/values-it/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Traccia precedente</string>
   <string name="exo_controls_next_description">Traccia successiva</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Non ripetere nulla</string>
   <string name="exo_controls_repeat_one_description">Ripeti uno</string>
   <string name="exo_controls_repeat_all_description">Ripeti tutto</string>
-  <string name="exo_controls_shuffle_description">Riproduzione casuale</string>
+  <string name="exo_controls_shuffle_on_description">Riproduzione casuale</string>
   <string name="exo_controls_fullscreen_description">Modalit a schermo intero</string>
   <string name="exo_controls_vr_description">Modalit VR</string>
   <string name="exo_download_description">Scarica</string>
diff --git a/library/ui/src/main/res/values-iw/strings.xml b/library/ui/src/main/res/values-iw/strings.xml
index 695196c5be..8dd08278a3 100644
--- a/library/ui/src/main/res/values-iw/strings.xml
+++ b/library/ui/src/main/res/values-iw/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">    </string>
   <string name="exo_controls_repeat_one_description">   </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ja/strings.xml b/library/ui/src/main/res/values-ja/strings.xml
index b4158736a8..dc479596b9 100644
--- a/library/ui/src/main/res/values-ja/strings.xml
+++ b/library/ui/src/main/res/values-ja/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description">1 </string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ka/strings.xml b/library/ui/src/main/res/values-ka/strings.xml
index 13ceaaf51f..7b9ecc7a3a 100644
--- a/library/ui/src/main/res/values-ka/strings.xml
+++ b/library/ui/src/main/res/values-ka/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-kk/strings.xml b/library/ui/src/main/res/values-kk/strings.xml
index 92119d1fe5..ef2c1ab2b7 100644
--- a/library/ui/src/main/res/values-kk/strings.xml
+++ b/library/ui/src/main/res/values-kk/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-km/strings.xml b/library/ui/src/main/res/values-km/strings.xml
index 62728de026..3636a6e6d6 100644
--- a/library/ui/src/main/res/values-km/strings.xml
+++ b/library/ui/src/main/res/values-km/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description"> VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-kn/strings.xml b/library/ui/src/main/res/values-kn/strings.xml
index 6e6bfcb165..85df144fca 100644
--- a/library/ui/src/main/res/values-kn/strings.xml
+++ b/library/ui/src/main/res/values-kn/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ko/strings.xml b/library/ui/src/main/res/values-ko/strings.xml
index 230660ad6a..3442318047 100644
--- a/library/ui/src/main/res/values-ko/strings.xml
+++ b/library/ui/src/main/res/values-ko/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">  </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ky/strings.xml b/library/ui/src/main/res/values-ky/strings.xml
index 57b8bbb5f5..a4c5b36a6c 100644
--- a/library/ui/src/main/res/values-ky/strings.xml
+++ b/library/ui/src/main/res/values-ky/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-lo/strings.xml b/library/ui/src/main/res/values-lo/strings.xml
index d7996610b2..8d380f2808 100644
--- a/library/ui/src/main/res/values-lo/strings.xml
+++ b/library/ui/src/main/res/values-lo/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description"> VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-lt/strings.xml b/library/ui/src/main/res/values-lt/strings.xml
index 3e9a63dc99..1b3cfe4573 100644
--- a/library/ui/src/main/res/values-lt/strings.xml
+++ b/library/ui/src/main/res/values-lt/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Ankstesnis takelis</string>
   <string name="exo_controls_next_description">Kitas takelis</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Nekartoti nieko</string>
   <string name="exo_controls_repeat_one_description">Kartoti vien</string>
   <string name="exo_controls_repeat_all_description">Kartoti visk</string>
-  <string name="exo_controls_shuffle_description">Maiyti</string>
+  <string name="exo_controls_shuffle_on_description">Maiyti</string>
   <string name="exo_controls_fullscreen_description">Viso ekrano reimas</string>
   <string name="exo_controls_vr_description">VR reimas</string>
   <string name="exo_download_description">Atsisisti</string>
diff --git a/library/ui/src/main/res/values-lv/strings.xml b/library/ui/src/main/res/values-lv/strings.xml
index 59b541808a..6d7a232bcc 100644
--- a/library/ui/src/main/res/values-lv/strings.xml
+++ b/library/ui/src/main/res/values-lv/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Iepriekjais ieraksts</string>
   <string name="exo_controls_next_description">Nkamais ieraksts</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Neatkrtot nevienu</string>
   <string name="exo_controls_repeat_one_description">Atkrtot vienu</string>
   <string name="exo_controls_repeat_all_description">Atkrtot visu</string>
-  <string name="exo_controls_shuffle_description">Atskaot jaukt secb</string>
+  <string name="exo_controls_shuffle_on_description">Atskaot jaukt secb</string>
   <string name="exo_controls_fullscreen_description">Pilnekrna rems</string>
   <string name="exo_controls_vr_description">VR rems</string>
   <string name="exo_download_description">Lejupieldt</string>
diff --git a/library/ui/src/main/res/values-mk/strings.xml b/library/ui/src/main/res/values-mk/strings.xml
index 08a54d7240..1ad12a14d7 100644
--- a/library/ui/src/main/res/values-mk/strings.xml
+++ b/library/ui/src/main/res/values-mk/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">   </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">   </string>
   <string name="exo_controls_vr_description">  VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ml/strings.xml b/library/ui/src/main/res/values-ml/strings.xml
index 6e79db0903..a227434e7a 100644
--- a/library/ui/src/main/res/values-ml/strings.xml
+++ b/library/ui/src/main/res/values-ml/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-mn/strings.xml b/library/ui/src/main/res/values-mn/strings.xml
index 383d102520..8b8df3f9d4 100644
--- a/library/ui/src/main/res/values-mn/strings.xml
+++ b/library/ui/src/main/res/values-mn/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">    </string>
   <string name="exo_controls_repeat_one_description">     </string>
   <string name="exo_controls_repeat_all_description">   </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-mr/strings.xml b/library/ui/src/main/res/values-mr/strings.xml
index a0900ab851..5c2bbc738c 100644
--- a/library/ui/src/main/res/values-mr/strings.xml
+++ b/library/ui/src/main/res/values-mr/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-ms/strings.xml b/library/ui/src/main/res/values-ms/strings.xml
index 6dab5be8de..8bc50c7605 100644
--- a/library/ui/src/main/res/values-ms/strings.xml
+++ b/library/ui/src/main/res/values-ms/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Lagu sebelumnya</string>
   <string name="exo_controls_next_description">Lagu seterusnya</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Jangan ulang</string>
   <string name="exo_controls_repeat_one_description">Ulang satu</string>
   <string name="exo_controls_repeat_all_description">Ulang semua</string>
-  <string name="exo_controls_shuffle_description">Rombak</string>
+  <string name="exo_controls_shuffle_on_description">Rombak</string>
   <string name="exo_controls_fullscreen_description">Mod skrin penuh</string>
   <string name="exo_controls_vr_description">Mod VR</string>
   <string name="exo_download_description">Muat turun</string>
diff --git a/library/ui/src/main/res/values-my/strings.xml b/library/ui/src/main/res/values-my/strings.xml
index b30b76d516..e8a88a312d 100644
--- a/library/ui/src/main/res/values-my/strings.xml
+++ b/library/ui/src/main/res/values-my/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-nb/strings.xml b/library/ui/src/main/res/values-nb/strings.xml
index f2847dd829..f9a0850bec 100644
--- a/library/ui/src/main/res/values-nb/strings.xml
+++ b/library/ui/src/main/res/values-nb/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Forrige spor</string>
   <string name="exo_controls_next_description">Neste spor</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Ikke gjenta noen</string>
   <string name="exo_controls_repeat_one_description">Gjenta n</string>
   <string name="exo_controls_repeat_all_description">Gjenta alle</string>
-  <string name="exo_controls_shuffle_description">Tilfeldig rekkeflge</string>
+  <string name="exo_controls_shuffle_on_description">Tilfeldig rekkeflge</string>
   <string name="exo_controls_fullscreen_description">Fullskjermmodus</string>
   <string name="exo_controls_vr_description">VR-modus</string>
   <string name="exo_download_description">Last ned</string>
diff --git a/library/ui/src/main/res/values-ne/strings.xml b/library/ui/src/main/res/values-ne/strings.xml
index ff56480df1..f633a13af4 100644
--- a/library/ui/src/main/res/values-ne/strings.xml
+++ b/library/ui/src/main/res/values-ne/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-nl/strings.xml b/library/ui/src/main/res/values-nl/strings.xml
index 3fbf113f1e..4c71815136 100644
--- a/library/ui/src/main/res/values-nl/strings.xml
+++ b/library/ui/src/main/res/values-nl/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Vorige track</string>
   <string name="exo_controls_next_description">Volgende track</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Niets herhalen</string>
   <string name="exo_controls_repeat_one_description">En herhalen</string>
   <string name="exo_controls_repeat_all_description">Alles herhalen</string>
-  <string name="exo_controls_shuffle_description">Shuffle</string>
+  <string name="exo_controls_shuffle_on_description">Shuffle</string>
   <string name="exo_controls_fullscreen_description">Modus \'Volledig scherm\'</string>
   <string name="exo_controls_vr_description">VR-modus</string>
   <string name="exo_download_description">Downloaden</string>
diff --git a/library/ui/src/main/res/values-pa/strings.xml b/library/ui/src/main/res/values-pa/strings.xml
index 9f25759878..0d30c2c519 100644
--- a/library/ui/src/main/res/values-pa/strings.xml
+++ b/library/ui/src/main/res/values-pa/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">   </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">- </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-pl/strings.xml b/library/ui/src/main/res/values-pl/strings.xml
index 8df3b62b0c..46f76e975a 100644
--- a/library/ui/src/main/res/values-pl/strings.xml
+++ b/library/ui/src/main/res/values-pl/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Poprzedni utwr</string>
   <string name="exo_controls_next_description">Nastpny utwr</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Nie powtarzaj</string>
   <string name="exo_controls_repeat_one_description">Powtrz jeden</string>
   <string name="exo_controls_repeat_all_description">Powtrz wszystkie</string>
-  <string name="exo_controls_shuffle_description">Odtwarzanie losowe</string>
+  <string name="exo_controls_shuffle_on_description">Odtwarzanie losowe</string>
   <string name="exo_controls_fullscreen_description">Tryb penoekranowy</string>
   <string name="exo_controls_vr_description">Tryb VR</string>
   <string name="exo_download_description">Pobierz</string>
diff --git a/library/ui/src/main/res/values-pt-rPT/strings.xml b/library/ui/src/main/res/values-pt-rPT/strings.xml
index 188e18f6b5..60df32be81 100644
--- a/library/ui/src/main/res/values-pt-rPT/strings.xml
+++ b/library/ui/src/main/res/values-pt-rPT/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Faixa anterior</string>
   <string name="exo_controls_next_description">Faixa seguinte</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">No repetir nenhum</string>
   <string name="exo_controls_repeat_one_description">Repetir um</string>
   <string name="exo_controls_repeat_all_description">Repetir tudo</string>
-  <string name="exo_controls_shuffle_description">Reproduzir aleatoriamente</string>
+  <string name="exo_controls_shuffle_on_description">Reproduzir aleatoriamente</string>
   <string name="exo_controls_fullscreen_description">Modo de ecr inteiro</string>
   <string name="exo_controls_vr_description">Modo de RV</string>
   <string name="exo_download_description">Transferir</string>
diff --git a/library/ui/src/main/res/values-pt/strings.xml b/library/ui/src/main/res/values-pt/strings.xml
index 9e83387a76..63f3abd343 100644
--- a/library/ui/src/main/res/values-pt/strings.xml
+++ b/library/ui/src/main/res/values-pt/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Faixa anterior</string>
   <string name="exo_controls_next_description">Prxima faixa</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">No repetir</string>
   <string name="exo_controls_repeat_one_description">Repetir uma</string>
   <string name="exo_controls_repeat_all_description">Repetir tudo</string>
-  <string name="exo_controls_shuffle_description">Aleatrio</string>
+  <string name="exo_controls_shuffle_on_description">Aleatrio</string>
   <string name="exo_controls_fullscreen_description">Modo de tela cheia</string>
   <string name="exo_controls_vr_description">Modo RV</string>
   <string name="exo_download_description">Fazer o download</string>
diff --git a/library/ui/src/main/res/values-ro/strings.xml b/library/ui/src/main/res/values-ro/strings.xml
index 9bb8cfc8ee..b7f5a6b63e 100644
--- a/library/ui/src/main/res/values-ro/strings.xml
+++ b/library/ui/src/main/res/values-ro/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Melodia anterioar</string>
   <string name="exo_controls_next_description">Urmtoarea nregistrare</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Nu repetai niciunul</string>
   <string name="exo_controls_repeat_one_description">Repetai unul</string>
   <string name="exo_controls_repeat_all_description">Repetai-le pe toate</string>
-  <string name="exo_controls_shuffle_description">Redai aleatoriu</string>
+  <string name="exo_controls_shuffle_on_description">Redai aleatoriu</string>
   <string name="exo_controls_fullscreen_description">Modul Ecran complet</string>
   <string name="exo_controls_vr_description">Mod RV</string>
   <string name="exo_download_description">Descrcai</string>
diff --git a/library/ui/src/main/res/values-ru/strings.xml b/library/ui/src/main/res/values-ru/strings.xml
index e66a282da4..c72ea716bf 100644
--- a/library/ui/src/main/res/values-ru/strings.xml
+++ b/library/ui/src/main/res/values-ru/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR-</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-si/strings.xml b/library/ui/src/main/res/values-si/strings.xml
index b6bfb1848f..19d37854fd 100644
--- a/library/ui/src/main/res/values-si/strings.xml
+++ b/library/ui/src/main/res/values-si/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-sk/strings.xml b/library/ui/src/main/res/values-sk/strings.xml
index 6d5ddaea28..c45fd13dcf 100644
--- a/library/ui/src/main/res/values-sk/strings.xml
+++ b/library/ui/src/main/res/values-sk/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Predchdzajca skladba</string>
   <string name="exo_controls_next_description">alia skladba</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Neopakova</string>
   <string name="exo_controls_repeat_one_description">Opakova jednu</string>
   <string name="exo_controls_repeat_all_description">Opakova vetko</string>
-  <string name="exo_controls_shuffle_description">Nhodne prehrva</string>
+  <string name="exo_controls_shuffle_on_description">Nhodne prehrva</string>
   <string name="exo_controls_fullscreen_description">Reim celej obrazovky</string>
   <string name="exo_controls_vr_description">reim VR</string>
   <string name="exo_download_description">Stiahnu</string>
diff --git a/library/ui/src/main/res/values-sl/strings.xml b/library/ui/src/main/res/values-sl/strings.xml
index 1e3adff704..17f1e66764 100644
--- a/library/ui/src/main/res/values-sl/strings.xml
+++ b/library/ui/src/main/res/values-sl/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Prejnja skladba</string>
   <string name="exo_controls_next_description">Naslednja skladba</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Brez ponavljanja</string>
   <string name="exo_controls_repeat_one_description">Ponavljanje ene</string>
   <string name="exo_controls_repeat_all_description">Ponavljanje vseh</string>
-  <string name="exo_controls_shuffle_description">Nakljuno predvajanje</string>
+  <string name="exo_controls_shuffle_on_description">Nakljuno predvajanje</string>
   <string name="exo_controls_fullscreen_description">Celozaslonski nain</string>
   <string name="exo_controls_vr_description">Nain VR</string>
   <string name="exo_download_description">Prenos</string>
diff --git a/library/ui/src/main/res/values-sq/strings.xml b/library/ui/src/main/res/values-sq/strings.xml
index d5b8903ed7..950c867e8b 100644
--- a/library/ui/src/main/res/values-sq/strings.xml
+++ b/library/ui/src/main/res/values-sq/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Knga e mparshme</string>
   <string name="exo_controls_next_description">Knga tjetr</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Mos prsrit asnj</string>
   <string name="exo_controls_repeat_one_description">Prsrit nj</string>
   <string name="exo_controls_repeat_all_description">Prsrit t gjitha</string>
-  <string name="exo_controls_shuffle_description">Prziej</string>
+  <string name="exo_controls_shuffle_on_description">Prziej</string>
   <string name="exo_controls_fullscreen_description">Modaliteti me ekran t plot</string>
   <string name="exo_controls_vr_description">Modaliteti RV</string>
   <string name="exo_download_description">Shkarko</string>
diff --git a/library/ui/src/main/res/values-sr/strings.xml b/library/ui/src/main/res/values-sr/strings.xml
index b45fd8ab03..6c3074bc41 100644
--- a/library/ui/src/main/res/values-sr/strings.xml
+++ b/library/ui/src/main/res/values-sr/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description"> </string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description"> </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-sv/strings.xml b/library/ui/src/main/res/values-sv/strings.xml
index 7af95a4632..c7dafaf786 100644
--- a/library/ui/src/main/res/values-sv/strings.xml
+++ b/library/ui/src/main/res/values-sv/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Fregende spr</string>
   <string name="exo_controls_next_description">Nsta spr</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Upprepa inga</string>
   <string name="exo_controls_repeat_one_description">Upprepa en</string>
   <string name="exo_controls_repeat_all_description">Upprepa alla</string>
-  <string name="exo_controls_shuffle_description">Blanda spr</string>
+  <string name="exo_controls_shuffle_on_description">Blanda spr</string>
   <string name="exo_controls_fullscreen_description">Helskrmslge</string>
   <string name="exo_controls_vr_description">VR-lge</string>
   <string name="exo_download_description">Ladda ned</string>
diff --git a/library/ui/src/main/res/values-sw/strings.xml b/library/ui/src/main/res/values-sw/strings.xml
index 1cdd325278..66568a3acc 100644
--- a/library/ui/src/main/res/values-sw/strings.xml
+++ b/library/ui/src/main/res/values-sw/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Wimbo uliotangulia</string>
   <string name="exo_controls_next_description">Wimbo unaofuata</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Usirudie yoyote</string>
   <string name="exo_controls_repeat_one_description">Rudia moja</string>
   <string name="exo_controls_repeat_all_description">Rudia zote</string>
-  <string name="exo_controls_shuffle_description">Changanya</string>
+  <string name="exo_controls_shuffle_on_description">Changanya</string>
   <string name="exo_controls_fullscreen_description">Hali ya skrini nzima</string>
   <string name="exo_controls_vr_description">Hali ya Uhalisia Pepe</string>
   <string name="exo_download_description">Pakua</string>
diff --git a/library/ui/src/main/res/values-ta/strings.xml b/library/ui/src/main/res/values-ta/strings.xml
index 2b2b9e13d6..a4544299c0 100644
--- a/library/ui/src/main/res/values-ta/strings.xml
+++ b/library/ui/src/main/res/values-ta/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description">   </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description">  </string>
+  <string name="exo_controls_shuffle_on_description">  </string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-te/strings.xml b/library/ui/src/main/res/values-te/strings.xml
index ea344b0345..8fcb29cc2f 100644
--- a/library/ui/src/main/res/values-te/strings.xml
+++ b/library/ui/src/main/res/values-te/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">  </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">  </string>
   <string name="exo_controls_vr_description">  </string>
   <string name="exo_download_description"> </string>
diff --git a/library/ui/src/main/res/values-th/strings.xml b/library/ui/src/main/res/values-th/strings.xml
index 3cd933ccf1..918b62f099 100644
--- a/library/ui/src/main/res/values-th/strings.xml
+++ b/library/ui/src/main/res/values-th/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description"> VR</string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-tl/strings.xml b/library/ui/src/main/res/values-tl/strings.xml
index 21852c5011..df00a07299 100644
--- a/library/ui/src/main/res/values-tl/strings.xml
+++ b/library/ui/src/main/res/values-tl/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Nakaraang track</string>
   <string name="exo_controls_next_description">Susunod na track</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Walang uulitin</string>
   <string name="exo_controls_repeat_one_description">Mag-ulit ng isa</string>
   <string name="exo_controls_repeat_all_description">Ulitin lahat</string>
-  <string name="exo_controls_shuffle_description">I-shuffle</string>
+  <string name="exo_controls_shuffle_on_description">I-shuffle</string>
   <string name="exo_controls_fullscreen_description">Fullscreen mode</string>
   <string name="exo_controls_vr_description">VR mode</string>
   <string name="exo_download_description">I-download</string>
diff --git a/library/ui/src/main/res/values-tr/strings.xml b/library/ui/src/main/res/values-tr/strings.xml
index 2fbf36514f..5005f0bfb9 100644
--- a/library/ui/src/main/res/values-tr/strings.xml
+++ b/library/ui/src/main/res/values-tr/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">nceki para</string>
   <string name="exo_controls_next_description">Sonraki para</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Hibirini tekrarlama</string>
   <string name="exo_controls_repeat_one_description">Birini tekrarla</string>
   <string name="exo_controls_repeat_all_description">Tmn tekrarla</string>
-  <string name="exo_controls_shuffle_description">Kartr</string>
+  <string name="exo_controls_shuffle_on_description">Kartr</string>
   <string name="exo_controls_fullscreen_description">Tam ekran modu</string>
   <string name="exo_controls_vr_description">VR modu</string>
   <string name="exo_download_description">ndir</string>
diff --git a/library/ui/src/main/res/values-uk/strings.xml b/library/ui/src/main/res/values-uk/strings.xml
index 5d338b61af..a42a8128b3 100644
--- a/library/ui/src/main/res/values-uk/strings.xml
+++ b/library/ui/src/main/res/values-uk/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"> </string>
   <string name="exo_controls_repeat_one_description"> 1</string>
   <string name="exo_controls_repeat_all_description"> </string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"> </string>
   <string name="exo_controls_vr_description">  </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-ur/strings.xml b/library/ui/src/main/res/values-ur/strings.xml
index aa98b0728e..47f35d1bae 100644
--- a/library/ui/src/main/res/values-ur/strings.xml
+++ b/library/ui/src/main/res/values-ur/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"> </string>
   <string name="exo_controls_next_description"> </string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">   </string>
   <string name="exo_controls_repeat_one_description">  </string>
   <string name="exo_controls_repeat_all_description">  </string>
-  <string name="exo_controls_shuffle_description"> </string>
+  <string name="exo_controls_shuffle_on_description"> </string>
   <string name="exo_controls_fullscreen_description">   </string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description">  </string>
diff --git a/library/ui/src/main/res/values-uz/strings.xml b/library/ui/src/main/res/values-uz/strings.xml
index 2dcf5a518d..3d8e270636 100644
--- a/library/ui/src/main/res/values-uz/strings.xml
+++ b/library/ui/src/main/res/values-uz/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Avvalgi trek</string>
   <string name="exo_controls_next_description">Keyingi trek</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Takrorlanmasin</string>
   <string name="exo_controls_repeat_one_description">Bittasini takrorlash</string>
   <string name="exo_controls_repeat_all_description">Hammasini takrorlash</string>
-  <string name="exo_controls_shuffle_description">Aralash</string>
+  <string name="exo_controls_shuffle_on_description">Aralash</string>
   <string name="exo_controls_fullscreen_description">Butun ekran rejimi</string>
   <string name="exo_controls_vr_description">VR rejimi</string>
   <string name="exo_download_description">Yuklab olish</string>
diff --git a/library/ui/src/main/res/values-vi/strings.xml b/library/ui/src/main/res/values-vi/strings.xml
index 1cdb249ef0..dc78b504fd 100644
--- a/library/ui/src/main/res/values-vi/strings.xml
+++ b/library/ui/src/main/res/values-vi/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Bn nhc trc</string>
   <string name="exo_controls_next_description">Bn nhc tip theo</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Khng lp li</string>
   <string name="exo_controls_repeat_one_description">Lp li mt</string>
   <string name="exo_controls_repeat_all_description">Lp li tt c</string>
-  <string name="exo_controls_shuffle_description">Pht ngu nhin</string>
+  <string name="exo_controls_shuffle_on_description">Pht ngu nhin</string>
   <string name="exo_controls_fullscreen_description">Ch  ton mn hnh</string>
   <string name="exo_controls_vr_description">Ch  thc t o</string>
   <string name="exo_download_description">Ti xung</string>
diff --git a/library/ui/src/main/res/values-zh-rCN/strings.xml b/library/ui/src/main/res/values-zh-rCN/strings.xml
index fe21669ea4..d2c3fb93ca 100644
--- a/library/ui/src/main/res/values-zh-rCN/strings.xml
+++ b/library/ui/src/main/res/values-zh-rCN/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description">VR </string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-zh-rHK/strings.xml b/library/ui/src/main/res/values-zh-rHK/strings.xml
index 56e0a1a53b..d040db1b03 100644
--- a/library/ui/src/main/res/values-zh-rHK/strings.xml
+++ b/library/ui/src/main/res/values-zh-rHK/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description"></string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-zh-rTW/strings.xml b/library/ui/src/main/res/values-zh-rTW/strings.xml
index 7b29f7924e..c3a1b5521e 100644
--- a/library/ui/src/main/res/values-zh-rTW/strings.xml
+++ b/library/ui/src/main/res/values-zh-rTW/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description"></string>
   <string name="exo_controls_next_description"></string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description"></string>
   <string name="exo_controls_repeat_one_description"></string>
   <string name="exo_controls_repeat_all_description"></string>
-  <string name="exo_controls_shuffle_description"></string>
+  <string name="exo_controls_shuffle_on_description"></string>
   <string name="exo_controls_fullscreen_description"></string>
   <string name="exo_controls_vr_description"></string>
   <string name="exo_download_description"></string>
diff --git a/library/ui/src/main/res/values-zu/strings.xml b/library/ui/src/main/res/values-zu/strings.xml
index 83cf9b2e97..08922a5037 100644
--- a/library/ui/src/main/res/values-zu/strings.xml
+++ b/library/ui/src/main/res/values-zu/strings.xml
@@ -1,4 +1,18 @@
 <?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2019 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
   <string name="exo_controls_previous_description">Ithrekhi yangaphambilini</string>
   <string name="exo_controls_next_description">Ithrekhi elandelayo</string>
@@ -10,7 +24,7 @@
   <string name="exo_controls_repeat_off_description">Phinda okungekho</string>
   <string name="exo_controls_repeat_one_description">Phinda okukodwa</string>
   <string name="exo_controls_repeat_all_description">Phinda konke</string>
-  <string name="exo_controls_shuffle_description">Shova</string>
+  <string name="exo_controls_shuffle_on_description">Shova</string>
   <string name="exo_controls_fullscreen_description">Imodi yesikrini esigcwele</string>
   <string name="exo_controls_vr_description">Inqubo ye-VR</string>
   <string name="exo_download_description">Landa</string>
diff --git a/library/ui/src/main/res/values/constants.xml b/library/ui/src/main/res/values/constants.xml
index 9b374d8382..9bd616583e 100644
--- a/library/ui/src/main/res/values/constants.xml
+++ b/library/ui/src/main/res/values/constants.xml
@@ -18,6 +18,9 @@
   <dimen name="exo_media_button_width">71dp</dimen>
   <dimen name="exo_media_button_height">52dp</dimen>
 
+  <integer name="exo_media_button_opacity_percentage_enabled">100</integer>
+  <integer name="exo_media_button_opacity_percentage_disabled">33</integer>
+
   <color name="exo_error_message_background_color">#AA000000</color>
   <color name="exo_edit_mode_background_color">#FFF4F3F0</color>
 
diff --git a/library/ui/src/main/res/values/strings.xml b/library/ui/src/main/res/values/strings.xml
index bbb4aca8d5..e3f1c3aaec 100644
--- a/library/ui/src/main/res/values/strings.xml
+++ b/library/ui/src/main/res/values/strings.xml
@@ -34,8 +34,10 @@
   <string name="exo_controls_repeat_one_description">Repeat one</string>
   <!-- Description for a button that controls the repeat mode of a media playback. In this mode the entire playlist is repeated. [CHAR LIMIT=30] -->
   <string name="exo_controls_repeat_all_description">Repeat all</string>
-  <!-- Description for a media control button that toggles whether shuffle mode is enabled. [CHAR LIMIT=30] -->
-  <string name="exo_controls_shuffle_description">Shuffle</string>
+  <!-- Description for a button that controls the shuffle mode of media playback. In this mode shuffle is on. [CHAR LIMIT=30] -->
+  <string name="exo_controls_shuffle_on_description">Shuffle on</string>
+  <!-- Description for a button that controls the shuffle mode of media playback. In this mode shuffle is off. [CHAR LIMIT=30] -->
+  <string name="exo_controls_shuffle_off_description">Shuffle off</string>
   <!-- Description for a media control button that toggles whether a video playback is fullscreen. [CHAR LIMIT=30] -->
   <string name="exo_controls_fullscreen_description">Fullscreen mode</string>
   <!-- Description for a media control button that toggles whether a video playback is in VR mode. [CHAR LIMIT=30] -->
diff --git a/library/ui/src/main/res/values/styles.xml b/library/ui/src/main/res/values/styles.xml
index 89d7a2fc8e..c458a3ea99 100644
--- a/library/ui/src/main/res/values/styles.xml
+++ b/library/ui/src/main/res/values/styles.xml
@@ -51,11 +51,6 @@
     <item name="android:contentDescription">@string/exo_controls_pause_description</item>
   </style>
 
-  <style name="ExoMediaButton.Shuffle">
-    <item name="android:src">@drawable/exo_controls_shuffle</item>
-    <item name="android:contentDescription">@string/exo_controls_shuffle_description</item>
-  </style>
-
   <style name="ExoMediaButton.VR">
     <item name="android:src">@drawable/exo_icon_vr</item>
     <item name="android:contentDescription">@string/exo_controls_vr_description</item>
diff --git a/playbacktests/build.gradle b/playbacktests/build.gradle
index 5865d3c36d..d77944cf23 100644
--- a/playbacktests/build.gradle
+++ b/playbacktests/build.gradle
@@ -32,9 +32,9 @@ android {
 }
 
 dependencies {
-    androidTestImplementation 'androidx.test:rules:' + androidXTestVersion
-    androidTestImplementation 'androidx.test:runner:' + androidXTestVersion
-    androidTestImplementation 'androidx.annotation:annotation:1.1.0'
+    androidTestImplementation 'androidx.test:rules:' + androidxTestVersion
+    androidTestImplementation 'androidx.test:runner:' + androidxTestVersion
+    androidTestImplementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     androidTestImplementation project(modulePrefix + 'library-core')
     androidTestImplementation project(modulePrefix + 'library-dash')
     androidTestImplementation project(modulePrefix + 'library-hls')
diff --git a/testutils/README.md b/testutils/README.md
new file mode 100644
index 0000000000..d1ab6b1af5
--- /dev/null
+++ b/testutils/README.md
@@ -0,0 +1,10 @@
+# ExoPlayer test utils #
+
+Provides utility classes for ExoPlayer unit and instrumentation tests.
+
+## Links ##
+
+* [Javadoc][]: Classes matching `com.google.android.exoplayer2.testutil`
+  belong to this module.
+
+[Javadoc]: https://exoplayer.dev/doc/reference/index.html
diff --git a/testutils/build.gradle b/testutils/build.gradle
index 7d0019dba2..b08f98cf70 100644
--- a/testutils/build.gradle
+++ b/testutils/build.gradle
@@ -42,10 +42,21 @@ dependencies {
     api 'androidx.test:core:' + androidXTestVersion
     api 'androidx.test.ext:junit:' + androidXTestVersionJ
     api 'com.google.truth:truth:' + truthVersion
-    implementation 'androidx.annotation:annotation:1.1.0'
+    implementation 'androidx.annotation:annotation:' + androidxAnnotationVersion
     implementation project(modulePrefix + 'library-core')
     implementation 'com.google.auto.value:auto-value-annotations:' + autoValueVersion
     annotationProcessor 'com.google.auto.value:auto-value:' + autoValueVersion
     testImplementation project(modulePrefix + 'testutils')
     testImplementation 'org.robolectric:robolectric:' + robolectricVersion
 }
+
+ext {
+    javadocTitle = 'Test utils'
+}
+apply from: '../javadoc_library.gradle'
+
+ext {
+    releaseArtifact = 'exoplayer-testutils'
+    releaseDescription = 'Test utils for ExoPlayer.'
+}
+apply from: '../publish.gradle'
diff --git a/testutils/src/main/java/com/google/android/exoplayer2/testutil/ActionSchedule.java b/testutils/src/main/java/com/google/android/exoplayer2/testutil/ActionSchedule.java
index 1b0a00624e..e8abfdb73f 100644
--- a/testutils/src/main/java/com/google/android/exoplayer2/testutil/ActionSchedule.java
+++ b/testutils/src/main/java/com/google/android/exoplayer2/testutil/ActionSchedule.java
@@ -311,12 +311,12 @@ public Builder prepareSource(MediaSource mediaSource) {
 
     /**
      * Schedules a new source preparation action to be executed.
-     * @see com.google.android.exoplayer2.ExoPlayer#prepare(MediaSource, boolean, boolean).
      *
+     * @see com.google.android.exoplayer2.ExoPlayer#prepare(MediaSource, boolean, boolean)
      * @return The builder, for convenience.
      */
-    public Builder prepareSource(MediaSource mediaSource, boolean resetPosition,
-        boolean resetState) {
+    public Builder prepareSource(
+        MediaSource mediaSource, boolean resetPosition, boolean resetState) {
       return apply(new PrepareSource(tag, mediaSource, resetPosition, resetState));
     }
 
diff --git a/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeAdaptiveMediaPeriod.java b/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeAdaptiveMediaPeriod.java
index bcb97be287..6d141fe04a 100644
--- a/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeAdaptiveMediaPeriod.java
+++ b/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeAdaptiveMediaPeriod.java
@@ -34,7 +34,7 @@
 
 /**
  * Fake {@link MediaPeriod} that provides tracks from the given {@link TrackGroupArray}. Selecting a
- * track will give the player a {@link ChunkSampleStream<FakeChunkSource>}.
+ * track will give the player a {@link ChunkSampleStream}.
  */
 public class FakeAdaptiveMediaPeriod extends FakeMediaPeriod
     implements SequenceableLoader.Callback<ChunkSampleStream<FakeChunkSource>> {
diff --git a/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeRenderer.java b/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeRenderer.java
index 0d65d7fcc7..499aa1ec9e 100644
--- a/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeRenderer.java
+++ b/testutils/src/main/java/com/google/android/exoplayer2/testutil/FakeRenderer.java
@@ -79,13 +79,14 @@ public void render(long positionUs, long elapsedRealtimeUs) throws ExoPlaybackEx
     }
     playbackPositionUs = positionUs;
     while (lastSamplePositionUs < positionUs + SOURCE_READAHEAD_US) {
-      formatHolder.format = null;
+      formatHolder.clear();
       buffer.clear();
       int result = readSource(formatHolder, buffer, false);
       if (result == C.RESULT_FORMAT_READ) {
         formatReadCount++;
         assertThat(expectedFormats).contains(formatHolder.format);
         onFormatChanged(formatHolder.format);
+        formatHolder.clear();
       } else if (result == C.RESULT_BUFFER_READ) {
         if (buffer.isEndOfStream()) {
           isEnded = true;
