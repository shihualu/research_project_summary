diff --git a/facebook/src/main/AndroidManifest.xml b/facebook/src/main/AndroidManifest.xml
index ca7520f0c..5eb3dface 100644
--- a/facebook/src/main/AndroidManifest.xml
+++ b/facebook/src/main/AndroidManifest.xml
@@ -35,5 +35,6 @@
             android:name="com.facebook.CustomTabActivity"
             android:exported="true">
         </activity>
+        <activity android:name="com.facebook.CustomTabMainActivity" />
     </application>
 </manifest>
diff --git a/facebook/src/main/java/com/facebook/CustomTabActivity.java b/facebook/src/main/java/com/facebook/CustomTabActivity.java
index 8cd217204..bd4769cbf 100644
--- a/facebook/src/main/java/com/facebook/CustomTabActivity.java
+++ b/facebook/src/main/java/com/facebook/CustomTabActivity.java
@@ -21,24 +21,68 @@
 package com.facebook;
 
 import android.app.Activity;
+import android.content.BroadcastReceiver;
+import android.content.Context;
 import android.content.Intent;
+import android.content.IntentFilter;
 import android.os.Bundle;
+import android.support.v4.content.LocalBroadcastManager;
 
 /*
- * Login from a custom tab redirects here. Pass the url on to FacebookActivity so it can return the
- * result.
+ * Login from a custom tab redirects here. Pass the url on to CustomTabMainActivity so it can return
+ * the result.
  */
 public class CustomTabActivity extends Activity {
+    private static final int CUSTOM_TAB_REDIRECT_REQUEST_CODE = 2;
+    public static final String CUSTOM_TAB_REDIRECT_ACTION =
+            CustomTabActivity.class.getSimpleName() + ".action_customTabRedirect";
+    public static final String DESTROY_ACTION =
+            CustomTabActivity.class.getSimpleName() + ".action_destroy";
+
+    private BroadcastReceiver closeReceiver;
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
-        Intent intent = new Intent(this, FacebookActivity.class);
-        intent.putExtra("url", getIntent().getDataString());
+        Intent intent = new Intent(this, CustomTabMainActivity.class);
+        intent.setAction(CUSTOM_TAB_REDIRECT_ACTION);
+        intent.putExtra(CustomTabMainActivity.EXTRA_URL, getIntent().getDataString());
 
-        // these flags will open FacebookActivity from the back stack as well as closing this
-        // activity and the custom tab opened by FacebookActivity
+        // these flags will open CustomTabMainActivity from the back stack as well as closing this
+        // activity and the custom tab opened by CustomTabMainActivity.
         intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
 
-        startActivity(intent);
+        startActivityForResult(intent, CUSTOM_TAB_REDIRECT_REQUEST_CODE);
+    }
+
+    @Override
+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {
+        super.onActivityResult(requestCode, resultCode, data);
+
+        if (resultCode == RESULT_CANCELED) {
+            // We weren't able to open CustomTabMainActivity from the back stack. Send a broadcast
+            // instead.
+            Intent broadcast = new Intent(CUSTOM_TAB_REDIRECT_ACTION);
+            broadcast.putExtra(CustomTabMainActivity.EXTRA_URL, getIntent().getDataString());
+            LocalBroadcastManager.getInstance(this).sendBroadcast(broadcast);
+
+            // Wait for the custom tab to be removed from the back stack before finishing.
+            closeReceiver = new BroadcastReceiver() {
+                @Override
+                public void onReceive(Context context, Intent intent) {
+                    CustomTabActivity.this.finish();
+                }
+            };
+            LocalBroadcastManager.getInstance(this).registerReceiver(
+                    closeReceiver,
+                    new IntentFilter(CustomTabActivity.DESTROY_ACTION)
+            );
+        }
+    }
+
+    @Override
+    protected void onDestroy() {
+        LocalBroadcastManager.getInstance(this).unregisterReceiver(closeReceiver);
+        super.onDestroy();
     }
 }
diff --git a/facebook/src/main/java/com/facebook/CustomTabMainActivity.java b/facebook/src/main/java/com/facebook/CustomTabMainActivity.java
new file mode 100644
index 000000000..f29c027fb
--- /dev/null
+++ b/facebook/src/main/java/com/facebook/CustomTabMainActivity.java
@@ -0,0 +1,126 @@
+/**
+ * Copyright (c) 2014-present, Facebook, Inc. All rights reserved.
+ *
+ * You are hereby granted a non-exclusive, worldwide, royalty-free license to use,
+ * copy, modify, and distribute this software in source code or binary form for use
+ * in connection with the web services and APIs provided by Facebook.
+ *
+ * As with any software that integrates with the Facebook platform, your use of
+ * this software is subject to the Facebook Developer Principles and Policies
+ * [http://developers.facebook.com/policy/]. This copyright notice shall be
+ * included in all copies or substantial portions of the software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
+ * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
+ * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
+ * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+package com.facebook;
+
+
+import android.app.Activity;
+import android.content.BroadcastReceiver;
+import android.content.Context;
+import android.content.Intent;
+import android.content.IntentFilter;
+import android.os.Bundle;
+import android.support.v4.content.LocalBroadcastManager;
+
+import com.facebook.internal.CustomTab;
+
+public class CustomTabMainActivity extends Activity {
+    public static final String EXTRA_PARAMS =
+            CustomTabMainActivity.class.getSimpleName() + ".extra_params";
+    public static final String EXTRA_CHROME_PACKAGE =
+            CustomTabMainActivity.class.getSimpleName() + ".extra_chromePackage";
+    public static final String EXTRA_URL =
+            CustomTabMainActivity.class.getSimpleName() + ".extra_url";
+    public static final String REFRESH_ACTION =
+            CustomTabMainActivity.class.getSimpleName() + ".action_refresh";
+    public static final String getRedirectUrl() {
+        return "fb" + FacebookSdk.getApplicationId() + "://authorize";
+    }
+    private static final String OAUTH_DIALOG = "oauth";
+
+    private boolean shouldCloseCustomTab = true;
+    private BroadcastReceiver redirectReceiver;
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        // Custom Tab Redirects should not be creating a new instance of this activity
+        if (CustomTabActivity.CUSTOM_TAB_REDIRECT_ACTION.equals(getIntent().getAction())) {
+            setResult(RESULT_CANCELED);
+            finish();
+            return;
+        }
+
+        if (savedInstanceState == null) {
+            Bundle parameters = getIntent().getBundleExtra(EXTRA_PARAMS);
+            String chromePackage = getIntent().getStringExtra(EXTRA_CHROME_PACKAGE);
+
+            CustomTab customTab = new CustomTab(OAUTH_DIALOG, parameters);
+            customTab.openCustomTab(this, chromePackage);
+
+            shouldCloseCustomTab = false;
+
+            // This activity will receive a broadcast if it can't be opened from the back stack
+            redirectReceiver = new BroadcastReceiver() {
+                @Override
+                public void onReceive(Context context, Intent intent) {
+                    // Remove the custom tab on top of this activity.
+                    Intent newIntent =
+                            new Intent(CustomTabMainActivity.this, CustomTabMainActivity.class);
+                    newIntent.setAction(REFRESH_ACTION);
+                    newIntent.putExtra(EXTRA_URL, intent.getStringExtra(EXTRA_URL));
+                    newIntent.addFlags(
+                            Intent.FLAG_ACTIVITY_CLEAR_TOP |
+                            Intent.FLAG_ACTIVITY_SINGLE_TOP);
+                    startActivity(newIntent);
+                }
+            };
+            LocalBroadcastManager.getInstance(this).registerReceiver(
+                    redirectReceiver,
+                    new IntentFilter(CustomTabActivity.CUSTOM_TAB_REDIRECT_ACTION)
+            );
+        }
+    }
+
+    @Override
+    protected void onNewIntent(Intent intent) {
+        super.onNewIntent(intent);
+        if (REFRESH_ACTION.equals(intent.getAction())) {
+            // The custom tab is now destroyed so we can finish the redirect activity
+            Intent broadcast = new Intent(CustomTabActivity.DESTROY_ACTION);
+            LocalBroadcastManager.getInstance(this).sendBroadcast(broadcast);
+            sendResult(RESULT_OK, intent);
+        } else if (CustomTabActivity.CUSTOM_TAB_REDIRECT_ACTION.equals(intent.getAction())) {
+            // We have successfully redirected back to this activity. Return the result and close.
+            sendResult(RESULT_OK, intent);
+        }
+    }
+
+    @Override
+    protected void onResume() {
+        super.onResume();
+        if (shouldCloseCustomTab) {
+            // The custom tab was closed without getting a result.
+            sendResult(RESULT_CANCELED, null);
+        }
+        shouldCloseCustomTab = true;
+    }
+
+    private void sendResult(int resultCode, Intent resultIntent) {
+        LocalBroadcastManager.getInstance(this).unregisterReceiver(redirectReceiver);
+        if (resultIntent != null) {
+            setResult(resultCode, resultIntent);
+        } else {
+            setResult(resultCode);
+        }
+        finish();
+    }
+}
diff --git a/facebook/src/main/java/com/facebook/FacebookActivity.java b/facebook/src/main/java/com/facebook/FacebookActivity.java
index 5440724e1..4ca38c146 100644
--- a/facebook/src/main/java/com/facebook/FacebookActivity.java
+++ b/facebook/src/main/java/com/facebook/FacebookActivity.java
@@ -22,7 +22,6 @@
 
 import android.content.Intent;
 import android.content.res.Configuration;
-import android.net.Uri;
 import android.os.Bundle;
 import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentActivity;
@@ -31,10 +30,7 @@
 
 import com.facebook.internal.FacebookDialogFragment;
 import com.facebook.internal.NativeProtocol;
-import com.facebook.internal.Utility;
 import com.facebook.login.LoginFragment;
-import com.facebook.login.LoginManager;
-import com.facebook.share.DeviceShareDialog;
 import com.facebook.share.internal.DeviceShareDialogFragment;
 import com.facebook.share.model.ShareContent;
 
@@ -56,18 +52,14 @@
 
     public static String PASS_THROUGH_CANCEL_ACTION = "PassThrough";
     private static String FRAGMENT_TAG = "SingleFragment";
-    private static final int API_EC_DIALOG_CANCEL = 4201;
     private static final String TAG = FacebookActivity.class.getName();
 
     private Fragment singleFragment;
 
-    private static final String getRedirectUrl() {
-        return "fb" + FacebookSdk.getApplicationId() + "://authorize";
-    }
-
     @Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
+        Intent intent = getIntent();
 
         // Some apps using this sdk don't put the sdk initialize code in the application
         // on create method. This can cause issues when opening this activity after an application
@@ -83,7 +75,6 @@ public void onCreate(Bundle savedInstanceState) {
 
         setContentView(R.layout.com_facebook_activity_layout);
 
-        Intent intent = getIntent();
         if (PASS_THROUGH_CANCEL_ACTION.equals(intent.getAction())) {
             handlePassThroughError();
             return;
@@ -126,13 +117,6 @@ public void onConfigurationChanged(Configuration newConfig) {
         }
     }
 
-    @Override
-    protected void onNewIntent(Intent intent) {
-        super.onNewIntent(intent);
-        String url = intent.getStringExtra("url");
-        handlePassThroughUrl(url);
-    }
-
     public Fragment getCurrentFragment() {
         return singleFragment;
     }
@@ -144,72 +128,11 @@ private void handlePassThroughError() {
         Bundle errorResults = NativeProtocol.getMethodArgumentsFromIntent(requestIntent);
         FacebookException exception = NativeProtocol.getExceptionFromErrorData(errorResults);
 
-        sendResult(null, exception);
-    }
-
-    private void handlePassThroughUrl(String url) {
-        if (url != null && url.startsWith(getRedirectUrl())) {
-            Uri uri = Uri.parse(url);
-            Bundle values = Utility.parseUrlQueryString(uri.getQuery());
-            values.putAll(Utility.parseUrlQueryString(uri.getFragment()));
-
-            if (!(singleFragment instanceof LoginFragment)
-                    || !((LoginFragment) singleFragment).validateChallengeParam(values)) {
-                sendResult(null, new FacebookException("Invalid state parameter"));
-            }
-
-            String error = values.getString("error");
-            if (error == null) {
-                error = values.getString("error_type");
-            }
-
-            String errorMessage = values.getString("error_msg");
-            if (errorMessage == null) {
-                errorMessage = values.getString("error_message");
-            }
-            if (errorMessage == null) {
-                errorMessage = values.getString("error_description");
-            }
-            String errorCodeString = values.getString("error_code");
-            int errorCode = FacebookRequestError.INVALID_ERROR_CODE;
-            if (!Utility.isNullOrEmpty(errorCodeString)) {
-                try {
-                    errorCode = Integer.parseInt(errorCodeString);
-                } catch (NumberFormatException ex) {
-                    errorCode = FacebookRequestError.INVALID_ERROR_CODE;
-                }
-            }
-
-            if (Utility.isNullOrEmpty(error) && Utility.isNullOrEmpty(errorMessage)
-                    && errorCode == FacebookRequestError.INVALID_ERROR_CODE) {
-                sendResult(values, null);
-            } else if (error != null && (error.equals("access_denied") ||
-                    error.equals("OAuthAccessDeniedException"))) {
-                sendResult(null, new FacebookOperationCanceledException());
-            } else if (errorCode == API_EC_DIALOG_CANCEL) {
-                sendResult(null, new FacebookOperationCanceledException());
-            } else {
-                FacebookRequestError requestError =
-                        new FacebookRequestError(errorCode, error, errorMessage);
-                sendResult(null, new FacebookServiceException(requestError, errorMessage));
-            }
-        }
-    }
-
-    public void sendResult(Bundle results, FacebookException error) {
-        int resultCode;
-        Intent resultIntent = getIntent();
-        if (error == null) {
-            resultCode = RESULT_OK;
-            LoginManager.setSuccessResult(resultIntent, results);
-        } else {
-            resultCode = RESULT_CANCELED;
-            resultIntent = NativeProtocol.createProtocolResultIntent(
-                    resultIntent,
-                    results,
-                    error);
-        }
-        setResult(resultCode, resultIntent);
+        Intent resultIntent = NativeProtocol.createProtocolResultIntent(
+                getIntent(),
+                null,
+                exception);
+        setResult(RESULT_CANCELED, resultIntent);
         finish();
     }
 }
diff --git a/facebook/src/main/java/com/facebook/FacebookSdkVersion.java b/facebook/src/main/java/com/facebook/FacebookSdkVersion.java
index 60bfc5882..9ce152301 100644
--- a/facebook/src/main/java/com/facebook/FacebookSdkVersion.java
+++ b/facebook/src/main/java/com/facebook/FacebookSdkVersion.java
@@ -21,5 +21,5 @@
 package com.facebook;
 
 final class FacebookSdkVersion {
-    public static final String BUILD = "4.14.0";
+    public static final String BUILD = "4.15.0";
 }
diff --git a/facebook/src/main/java/com/facebook/GraphRequest.java b/facebook/src/main/java/com/facebook/GraphRequest.java
index 7a8a13bb0..17f40024c 100644
--- a/facebook/src/main/java/com/facebook/GraphRequest.java
+++ b/facebook/src/main/java/com/facebook/GraphRequest.java
@@ -1448,7 +1448,7 @@ private void addCommonParameters() {
     }
 
     private String appendParametersToBaseUrl(String baseUrl) {
-        Uri.Builder uriBuilder = new Uri.Builder().encodedPath(baseUrl);
+        Uri.Builder uriBuilder = Uri.parse(baseUrl).buildUpon();
 
         Set<String> keys = this.parameters.keySet();
         for (String key : keys) {
@@ -1477,14 +1477,18 @@ private String appendParametersToBaseUrl(String baseUrl) {
         return uriBuilder.toString();
     }
 
-    final String getUrlForBatchedRequest() {
+    final String getRelativeUrlForBatchedRequest() {
         if (overriddenURL != null) {
             throw new FacebookException("Can't override URL for a batch request");
         }
 
-        String baseUrl = getGraphPathWithVersion();
+        String baseUrl =
+                String.format("%s/%s", ServerProtocol.getGraphUrlBase(), getGraphPathWithVersion());
         addCommonParameters();
-        return appendParametersToBaseUrl(baseUrl);
+        String fullUrl = appendParametersToBaseUrl(baseUrl);
+        Uri uri = Uri.parse(fullUrl);
+        String relativeUrl = String.format("%s?%s", uri.getPath(), uri.getQuery());
+        return relativeUrl;
     }
 
     final String getUrlForSingleRequest() {
@@ -1548,7 +1552,7 @@ private void serializeToBatch(
             batchEntry.put(BATCH_ENTRY_DEPENDS_ON_PARAM, this.batchEntryDependsOn);
         }
 
-        String relativeURL = getUrlForBatchedRequest();
+        String relativeURL = getRelativeUrlForBatchedRequest();
         batchEntry.put(BATCH_RELATIVE_URL_PARAM, relativeURL);
         batchEntry.put(BATCH_METHOD_PARAM, httpMethod);
         if (this.accessToken != null) {
diff --git a/facebook/src/main/java/com/facebook/appevents/AppEvent.java b/facebook/src/main/java/com/facebook/appevents/AppEvent.java
index 266b09e41..84702399b 100644
--- a/facebook/src/main/java/com/facebook/appevents/AppEvent.java
+++ b/facebook/src/main/java/com/facebook/appevents/AppEvent.java
@@ -28,12 +28,16 @@
 import com.facebook.LoggingBehavior;
 import com.facebook.appevents.internal.Constants;
 import com.facebook.internal.Logger;
+import com.facebook.internal.Utility;
 import com.facebook.internal.Validate;
 
 import org.json.JSONException;
 import org.json.JSONObject;
 
 import java.io.Serializable;
+import java.io.UnsupportedEncodingException;
+import java.security.MessageDigest;
+import java.security.NoSuchAlgorithmException;
 import java.util.HashSet;
 import java.util.Locale;
 import java.util.UUID;
@@ -46,6 +50,7 @@
     private final JSONObject jsonObject;
     private final boolean isImplicit;
     private final String name;
+    private final String checksum;
 
     public AppEvent(
             String contextName,
@@ -64,16 +69,21 @@ public AppEvent(
                 currentSessionId);
         isImplicit = isImplicitlyLogged;
         name = eventName;
+        checksum = calculateChecksum();
     }
 
     public String getName() {
         return name;
     }
 
-    private AppEvent(String jsonString, boolean isImplicit) throws JSONException {
+    private AppEvent(
+            String jsonString,
+            boolean isImplicit,
+            String checksum) throws JSONException {
         jsonObject = new JSONObject(jsonString);
         this.isImplicit = isImplicit;
         this.name = jsonObject.optString(Constants.EVENT_NAME_EVENT_KEY);
+        this.checksum = checksum;
     }
 
     public boolean getIsImplicit() {
@@ -84,6 +94,15 @@ public JSONObject getJSONObject() {
         return jsonObject;
     }
 
+    public boolean isChecksumValid() {
+        if (this.checksum == null) {
+            // for old events we don't have a checksum
+            return true;
+        }
+
+        return calculateChecksum().equals(checksum);
+    }
+
     // throw exception if not valid.
     private static void validateIdentifier(String identifier) throws FacebookException {
 
@@ -185,6 +204,7 @@ private static JSONObject getJSONObjectForAppEvent(
         return eventObject;
     }
 
+    // OLD VERSION DO NOT USE
     static class SerializationProxyV1 implements Serializable {
         private static final long serialVersionUID = -2488473066578201069L;
         private final String jsonString;
@@ -196,12 +216,29 @@ private SerializationProxyV1(String jsonString, boolean isImplicit) {
         }
 
         private Object readResolve() throws JSONException {
-            return new AppEvent(jsonString, isImplicit);
+            return new AppEvent(jsonString, isImplicit, null);
+        }
+    }
+
+    static class SerializationProxyV2 implements Serializable {
+        private static final long serialVersionUID = 2016_08_03_001L;
+        private final String jsonString;
+        private final boolean isImplicit;
+        private final String checksum;
+
+        private SerializationProxyV2(String jsonString, boolean isImplicit, String checksum) {
+            this.jsonString = jsonString;
+            this.isImplicit = isImplicit;
+            this.checksum = checksum;
+        }
+
+        private Object readResolve() throws JSONException {
+            return new AppEvent(jsonString, isImplicit, checksum);
         }
     }
 
     private Object writeReplace() {
-        return new SerializationProxyV1(jsonObject.toString(), isImplicit);
+        return new SerializationProxyV2(jsonObject.toString(), isImplicit, checksum);
     }
 
     @Override
@@ -212,4 +249,40 @@ public String toString() {
                 isImplicit,
                 jsonObject.toString());
     }
+
+    private String calculateChecksum() {
+        return md5Checksum(jsonObject.toString());
+    }
+
+    private static String md5Checksum(String toHash )
+    {
+        String hash = null;
+        try
+        {
+            MessageDigest digest = MessageDigest.getInstance("MD5");
+            byte[] bytes = toHash.getBytes("UTF-8");
+            digest.update(bytes, 0, bytes.length);
+            bytes = digest.digest();
+            hash = bytesToHex( bytes );
+        }
+        catch(NoSuchAlgorithmException e )
+        {
+            Utility.logd("Failed to generate checksum: ", e);
+            return "0";
+        }
+        catch(UnsupportedEncodingException e )
+        {
+            Utility.logd("Failed to generate checksum: ", e);
+            return "1";
+        }
+        return hash;
+    }
+
+    private static String bytesToHex(byte[] bytes) {
+        StringBuffer sb = new StringBuffer();
+        for (byte b : bytes) {
+            sb.append(String.format("%02x", b));
+        }
+        return sb.toString();
+    }
 }
diff --git a/facebook/src/main/java/com/facebook/appevents/SessionEventsState.java b/facebook/src/main/java/com/facebook/appevents/SessionEventsState.java
index cf1890073..665ed4306 100644
--- a/facebook/src/main/java/com/facebook/appevents/SessionEventsState.java
+++ b/facebook/src/main/java/com/facebook/appevents/SessionEventsState.java
@@ -91,8 +91,12 @@ public int populateRequest(
 
             jsonArray = new JSONArray();
             for (AppEvent event : inFlightEvents) {
-                if (includeImplicitEvents || !event.getIsImplicit()) {
-                    jsonArray.put(event.getJSONObject());
+                if (event.isChecksumValid()) {
+                    if (includeImplicitEvents || !event.getIsImplicit()) {
+                        jsonArray.put(event.getJSONObject());
+                    }
+                } else {
+                    Utility.logd("Event with invalid checksum: %s", event.toString());
                 }
             }
 
diff --git a/facebook/src/main/java/com/facebook/internal/CustomTab.java b/facebook/src/main/java/com/facebook/internal/CustomTab.java
index a35c7448b..f6e86ea00 100644
--- a/facebook/src/main/java/com/facebook/internal/CustomTab.java
+++ b/facebook/src/main/java/com/facebook/internal/CustomTab.java
@@ -43,10 +43,10 @@ public CustomTab(String action, Bundle parameters) {
     }
 
     public void openCustomTab(Activity activity, String packageName) {
-        // CORONA: The custom tabs functionality is removed until the plugin uses the features that need it.
-//        android.util.Log.d("Corona", "Facebook SDK -> Hey, we're using a Chrome Custom Tab!");
+//        // CORONA: The custom tabs functionality is removed until the plugin uses the features that need it.
 //        CustomTabsIntent customTabsIntent = new CustomTabsIntent.Builder().build();
 //        customTabsIntent.intent.setPackage(packageName);
+//        customTabsIntent.intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);
 //        customTabsIntent.launchUrl(activity, uri);
     }
 }
diff --git a/facebook/src/main/java/com/facebook/internal/FacebookDialogFragment.java b/facebook/src/main/java/com/facebook/internal/FacebookDialogFragment.java
index fad56ee93..57d78ed6e 100644
--- a/facebook/src/main/java/com/facebook/internal/FacebookDialogFragment.java
+++ b/facebook/src/main/java/com/facebook/internal/FacebookDialogFragment.java
@@ -118,11 +118,18 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {
         return dialog;
     }
 
+    @Override
+    public void onResume () {
+        super.onResume();
+        if (this.dialog instanceof WebDialog) {
+            ((WebDialog)this.dialog).resize();
+        }
+    }
+
     @Override
     public void onConfigurationChanged (Configuration newConfig) {
         super.onConfigurationChanged(newConfig);
-
-        if (this.dialog instanceof WebDialog) {
+        if (this.dialog instanceof WebDialog && isResumed()) {
             ((WebDialog)this.dialog).resize();
         }
     }
diff --git a/facebook/src/main/java/com/facebook/internal/PlatformServiceClient.java b/facebook/src/main/java/com/facebook/internal/PlatformServiceClient.java
index e3bc3f090..45b7dfab8 100644
--- a/facebook/src/main/java/com/facebook/internal/PlatformServiceClient.java
+++ b/facebook/src/main/java/com/facebook/internal/PlatformServiceClient.java
@@ -142,7 +142,11 @@ protected void handleMessage(Message message) {
             } else {
                 callback(extras);
             }
-            context.unbindService(this);
+            try {
+                context.unbindService(this);
+            } catch (IllegalArgumentException ex) {
+                // Do nothing, the connection was already unbound
+            }
         }
     }
 
diff --git a/facebook/src/main/java/com/facebook/login/CustomTabLoginMethodHandler.java b/facebook/src/main/java/com/facebook/login/CustomTabLoginMethodHandler.java
index ca1a354b6..9298f6de5 100644
--- a/facebook/src/main/java/com/facebook/login/CustomTabLoginMethodHandler.java
+++ b/facebook/src/main/java/com/facebook/login/CustomTabLoginMethodHandler.java
@@ -25,14 +25,19 @@
 import android.content.Intent;
 import android.content.pm.ResolveInfo;
 import android.content.pm.ServiceInfo;
+import android.net.Uri;
 import android.os.Bundle;
 import android.os.Parcel;
 import android.os.Parcelable;
-import android.util.Log;
 
 import com.facebook.AccessTokenSource;
+import com.facebook.CustomTabMainActivity;
+import com.facebook.FacebookException;
+import com.facebook.FacebookOperationCanceledException;
+import com.facebook.FacebookRequestError;
 import com.facebook.FacebookSdk;
-import com.facebook.internal.CustomTab;
+import com.facebook.FacebookServiceException;
+import com.facebook.internal.ServerProtocol;
 import com.facebook.internal.Utility;
 import com.facebook.internal.Validate;
 
@@ -45,21 +50,23 @@
 import java.util.Set;
 
 public class CustomTabLoginMethodHandler extends WebLoginMethodHandler {
-    private static final String OAUTH_DIALOG = "oauth";
+    private static final int CUSTOM_TAB_REQUEST_CODE = 1;
+    private static final int CHALLENGE_LENGTH = 20;
+    private static final int API_EC_DIALOG_CANCEL = 4201;
     private static final String CUSTOM_TABS_SERVICE_ACTION =
             "android.support.customtabs.action.CustomTabsService";
-    private static final String CHROME_PACKAGE = "com.android.chrome";
     private static final String[] CHROME_PACKAGES = {
             "com.android.chrome",
             "com.chrome.beta",
             "com.chrome.dev",
     };
 
-    private CustomTab customTab;
     private String currentPackage;
+    private String expectedChallenge;
 
     CustomTabLoginMethodHandler(LoginClient loginClient) {
         super(loginClient);
+        expectedChallenge = Utility.generateRandomString(CHALLENGE_LENGTH);
     }
 
     @Override
@@ -87,21 +94,14 @@ boolean tryAuthorize(final LoginClient.Request request) {
         parameters = addExtraParameters(parameters, request);
         Activity activity = loginClient.getActivity();
 
-        customTab = new CustomTab(OAUTH_DIALOG, parameters);
-
-        customTab.openCustomTab(activity, getChromePackage());
+        Intent intent = new Intent(activity, CustomTabMainActivity.class);
+        intent.putExtra(CustomTabMainActivity.EXTRA_PARAMS, parameters);
+        intent.putExtra(CustomTabMainActivity.EXTRA_CHROME_PACKAGE, getChromePackage());
+        loginClient.getFragment().startActivityForResult(intent, CUSTOM_TAB_REQUEST_CODE);
 
         return true;
     }
 
-    @Override
-    protected void putChallengeParam(JSONObject param) throws JSONException {
-        if (loginClient.getFragment() instanceof LoginFragment) {
-            param.put(LoginLogger.EVENT_PARAM_CHALLENGE,
-                    ((LoginFragment) loginClient.getFragment()).getChallengeParam());
-        }
-    }
-
     private boolean isCustomTabsAllowed() {
         return isCustomTabsEnabled()
                 && getChromePackage() != null
@@ -133,7 +133,91 @@ private String getChromePackage() {
             }
         }
         return null;
+    }
+
+    @Override
+    boolean onActivityResult(int requestCode, int resultCode, Intent data) {
+        if (requestCode != CUSTOM_TAB_REQUEST_CODE) {
+            return super.onActivityResult(requestCode, resultCode, data);
+        }
+        LoginClient.Request request = loginClient.getPendingRequest();
+        if (resultCode == Activity.RESULT_OK) {
+            onCustomTabComplete(data.getStringExtra(CustomTabMainActivity.EXTRA_URL), request);
+            return true;
+        }
+        super.onComplete(request, null, new FacebookOperationCanceledException());
+        return false;
+    }
+
+    private void onCustomTabComplete(String url, LoginClient.Request request) {
+        if (url != null && url.startsWith(CustomTabMainActivity.getRedirectUrl())) {
+            Uri uri = Uri.parse(url);
+            Bundle values = Utility.parseUrlQueryString(uri.getQuery());
+            values.putAll(Utility.parseUrlQueryString(uri.getFragment()));
+
+            if (!validateChallengeParam(values)) {
+                super.onComplete(request, null, new FacebookException("Invalid state parameter"));
+                return;
+            }
+
+            String error = values.getString("error");
+            if (error == null) {
+                error = values.getString("error_type");
+            }
 
+            String errorMessage = values.getString("error_msg");
+            if (errorMessage == null) {
+                errorMessage = values.getString("error_message");
+            }
+            if (errorMessage == null) {
+                errorMessage = values.getString("error_description");
+            }
+            String errorCodeString = values.getString("error_code");
+            int errorCode = FacebookRequestError.INVALID_ERROR_CODE;
+            if (!Utility.isNullOrEmpty(errorCodeString)) {
+                try {
+                    errorCode = Integer.parseInt(errorCodeString);
+                } catch (NumberFormatException ex) {
+                    errorCode = FacebookRequestError.INVALID_ERROR_CODE;
+                }
+            }
+
+            if (Utility.isNullOrEmpty(error) && Utility.isNullOrEmpty(errorMessage)
+                    && errorCode == FacebookRequestError.INVALID_ERROR_CODE) {
+                super.onComplete(request, values, null);
+            } else if (error != null && (error.equals("access_denied") ||
+                    error.equals("OAuthAccessDeniedException"))) {
+                super.onComplete(request, null, new FacebookOperationCanceledException());
+            } else if (errorCode == API_EC_DIALOG_CANCEL) {
+                super.onComplete(request, null, new FacebookOperationCanceledException());
+            } else {
+                FacebookRequestError requestError =
+                        new FacebookRequestError(errorCode, error, errorMessage);
+                super.onComplete(
+                        request,
+                        null,
+                        new FacebookServiceException(requestError, errorMessage));
+            }
+        }
+    }
+
+    @Override
+    protected void putChallengeParam(JSONObject param) throws JSONException {
+        param.put(LoginLogger.EVENT_PARAM_CHALLENGE, expectedChallenge);
+    }
+
+    private boolean validateChallengeParam(Bundle values) {
+        try {
+            String stateString = values.getString(ServerProtocol.DIALOG_PARAM_STATE);
+            if (stateString == null) {
+                return false;
+            }
+            JSONObject state = new JSONObject(stateString);
+            String challenge = state.getString(LoginLogger.EVENT_PARAM_CHALLENGE);
+            return challenge.equals(expectedChallenge);
+        } catch (JSONException e) {
+            return false;
+        }
     }
 
     @Override
@@ -143,11 +227,13 @@ public int describeContents() {
 
     CustomTabLoginMethodHandler(Parcel source) {
         super(source);
+        expectedChallenge = source.readString();
     }
 
     @Override
     public void writeToParcel(Parcel dest, int flags) {
         super.writeToParcel(dest, flags);
+        dest.writeString(expectedChallenge);
     }
 
     public static final Parcelable.Creator<CustomTabLoginMethodHandler> CREATOR =
diff --git a/facebook/src/main/java/com/facebook/login/LoginBehavior.java b/facebook/src/main/java/com/facebook/login/LoginBehavior.java
index f7e0e005b..a7b8f1957 100644
--- a/facebook/src/main/java/com/facebook/login/LoginBehavior.java
+++ b/facebook/src/main/java/com/facebook/login/LoginBehavior.java
@@ -28,31 +28,37 @@
      * Specifies that login should attempt login in using the Facebook App, and if that
      * does not work fall back to web dialog auth. This is the default behavior.
      */
-    NATIVE_WITH_FALLBACK(true, true, false, true, true),
+    NATIVE_WITH_FALLBACK(true, true, true, false, true, true),
 
     /**
      * Specifies that login should only attempt to login using the Facebook App.
      * If the Facebook App cannot be used then the login fails.
      */
-    NATIVE_ONLY(true, false, false, false, true),
+    NATIVE_ONLY(true, true, false, false, false, true),
+
+    /**
+     * Specifies that login should only attempt to use Katana Proxy Login.
+     */
+    KATANA_ONLY(false, true, false, false, false, false),
 
     /**
      * Specifies that only the web dialog auth should be used.
      */
-    WEB_ONLY(false, true, false, true, false),
+    WEB_ONLY(false, false, true, false, true, false),
 
     /**
      * Specifies that only the web view dialog auth should be used.
      */
-    WEB_VIEW_ONLY(false, true, false, false, false),
+    WEB_VIEW_ONLY(false, false, true, false, false, false),
 
     /**
      * Specifies that device login authentication flow should be used.
      * Use it via ({@link com.facebook.login.widget.DeviceLoginButton DeviceLoginButton}
      * or ({@link com.facebook.login.DeviceLoginManager DeviceLoginManager} to authenticate.
      */
-    DEVICE_AUTH(false, false, true, false, false);
+    DEVICE_AUTH(false, false, false, true, false, false);
 
+    private final boolean allowsGetTokenAuth;
     private final boolean allowsKatanaAuth;
     private final boolean allowsWebViewAuth;
     private final boolean allowsDeviceAuth;
@@ -60,11 +66,13 @@
     private final boolean allowsFacebookLiteAuth;
 
     private LoginBehavior(
+            boolean allowsGetTokenAuth,
             boolean allowsKatanaAuth,
             boolean allowsWebViewAuth,
             boolean allowsDeviceAuth,
             boolean allowsCustomTabAuth,
             boolean allowsFacebookLiteAuth) {
+        this.allowsGetTokenAuth = allowsGetTokenAuth;
         this.allowsKatanaAuth = allowsKatanaAuth;
         this.allowsWebViewAuth = allowsWebViewAuth;
         this.allowsDeviceAuth = allowsDeviceAuth;
@@ -72,6 +80,10 @@ private LoginBehavior(
         this.allowsFacebookLiteAuth = allowsFacebookLiteAuth;
     }
 
+    boolean allowsGetTokenAuth() {
+        return allowsGetTokenAuth;
+    }
+
     boolean allowsKatanaAuth() {
         return allowsKatanaAuth;
     }
diff --git a/facebook/src/main/java/com/facebook/login/LoginClient.java b/facebook/src/main/java/com/facebook/login/LoginClient.java
index eb4f08e23..f3ce3b7f1 100644
--- a/facebook/src/main/java/com/facebook/login/LoginClient.java
+++ b/facebook/src/main/java/com/facebook/login/LoginClient.java
@@ -159,8 +159,11 @@ public boolean onActivityResult(int requestCode, int resultCode, Intent data) {
 
         final LoginBehavior behavior = request.getLoginBehavior();
 
-        if (behavior.allowsKatanaAuth()) {
+        if (behavior.allowsGetTokenAuth()) {
             handlers.add(new GetTokenLoginMethodHandler(this));
+        }
+
+        if (behavior.allowsKatanaAuth()) {
             handlers.add(new KatanaProxyLoginMethodHandler(this));
         }
 
@@ -262,6 +265,8 @@ boolean tryCurrentHandler() {
         } else {
             // We didn't try it, so we don't get any other completion
             // notification -- log that we skipped it.
+            getLogger().logAuthorizationMethodNotTried(pendingRequest.getAuthId(),
+                    handler.getNameForLogging());
             addLoggingExtra(
                     LoginLogger.EVENT_EXTRAS_NOT_TRIED,
                     handler.getNameForLogging(),
diff --git a/facebook/src/main/java/com/facebook/login/LoginFragment.java b/facebook/src/main/java/com/facebook/login/LoginFragment.java
index 0a7e50c8f..0fc60bb36 100644
--- a/facebook/src/main/java/com/facebook/login/LoginFragment.java
+++ b/facebook/src/main/java/com/facebook/login/LoginFragment.java
@@ -31,14 +31,7 @@
 import android.view.View;
 import android.view.ViewGroup;
 
-import com.facebook.FacebookActivity;
-import com.facebook.FacebookOperationCanceledException;
 import com.facebook.R;
-import com.facebook.internal.ServerProtocol;
-import com.facebook.internal.Utility;
-
-import org.json.JSONException;
-import org.json.JSONObject;
 
 /**
  * This Fragment is a necessary part of the overall Facebook login process
@@ -57,28 +50,20 @@
             "Cannot call LoginFragment with a null calling package. " +
                     "This can occur if the launchMode of the caller is singleInstance.";
     private static final String SAVED_LOGIN_CLIENT = "loginClient";
-    private static final String SAVED_CHALLENGE = "challenge";
-    private static final int CHALLENGE_LENGTH = 20;
 
     private String callingPackage;
     private LoginClient loginClient;
     private LoginClient.Request request;
-    private boolean restarted;
-    private String expectedChallenge;
 
     @Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
 
-        restarted = savedInstanceState != null;
-
         if (savedInstanceState != null) {
             loginClient = savedInstanceState.getParcelable(SAVED_LOGIN_CLIENT);
             loginClient.setFragment(this);
-            expectedChallenge = savedInstanceState.getString(SAVED_CHALLENGE);
         } else {
             loginClient = new LoginClient(this);
-            expectedChallenge = Utility.generateRandomString(CHALLENGE_LENGTH);
         }
 
         loginClient.setOnCompletedListener(new LoginClient.OnCompletedListener() {
@@ -162,17 +147,6 @@ public void onResume() {
             return;
         }
 
-        if (restarted) {
-            Activity activity = getActivity();
-            if (activity instanceof FacebookActivity
-                    && loginClient.getCurrentHandler() instanceof CustomTabLoginMethodHandler) {
-                // custom tab was closed
-                ((FacebookActivity) activity)
-                        .sendResult(null, new FacebookOperationCanceledException());
-            }
-        }
-        restarted = true;
-
         loginClient.startOrContinueAuth(request);
     }
 
@@ -195,7 +169,6 @@ public void onSaveInstanceState(Bundle outState) {
         super.onSaveInstanceState(outState);
 
         outState.putParcelable(SAVED_LOGIN_CLIENT, loginClient);
-        outState.putString(SAVED_CHALLENGE, expectedChallenge);
     }
 
     private void initializeCallingPackage(final Activity activity) {
@@ -206,24 +179,6 @@ private void initializeCallingPackage(final Activity activity) {
         callingPackage = componentName.getPackageName();
     }
 
-    public boolean validateChallengeParam(Bundle values) {
-        try {
-            String stateString = values.getString(ServerProtocol.DIALOG_PARAM_STATE);
-            if (stateString == null) {
-                return false;
-            }
-            JSONObject state = new JSONObject(stateString);
-            String challenge = state.getString(LoginLogger.EVENT_PARAM_CHALLENGE);
-            return challenge.equals(expectedChallenge);
-        } catch (JSONException e) {
-            return false;
-        }
-    }
-
-    public String getChallengeParam() {
-        return expectedChallenge;
-    }
-
     LoginClient getLoginClient() {
         return loginClient;
     }
diff --git a/facebook/src/main/java/com/facebook/login/LoginLogger.java b/facebook/src/main/java/com/facebook/login/LoginLogger.java
index c5a094c76..ad6cefbb2 100644
--- a/facebook/src/main/java/com/facebook/login/LoginLogger.java
+++ b/facebook/src/main/java/com/facebook/login/LoginLogger.java
@@ -37,6 +37,7 @@
     // Constants for logging login-related data.
     static final String EVENT_NAME_LOGIN_METHOD_START = "fb_mobile_login_method_start";
     static final String EVENT_NAME_LOGIN_METHOD_COMPLETE = "fb_mobile_login_method_complete";
+    static final String EVENT_NAME_LOGIN_METHOD_NOT_TRIED = "fb_mobile_login_method_not_tried";
     static final String EVENT_PARAM_METHOD_RESULT_SKIPPED = "skipped";
     static final String EVENT_NAME_LOGIN_START = "fb_mobile_login_start";
     static final String EVENT_NAME_LOGIN_COMPLETE = "fb_mobile_login_complete";
@@ -193,6 +194,13 @@ public void logAuthorizationMethodComplete(String authId, String method, String
         appEventsLogger.logSdkEvent(EVENT_NAME_LOGIN_METHOD_COMPLETE, null, bundle);
     }
 
+    public void logAuthorizationMethodNotTried(String authId, String method) {
+        Bundle bundle = LoginLogger.newAuthorizationLoggingBundle(authId);
+        bundle.putString(EVENT_PARAM_METHOD, method);
+
+        appEventsLogger.logSdkEvent(EVENT_NAME_LOGIN_METHOD_NOT_TRIED, null, bundle);
+    }
+
     public void logUnexpectedError(String eventName, String errorMessage) {
         logUnexpectedError(eventName, errorMessage, "");
     }
diff --git a/facebook/src/main/java/com/facebook/login/LoginManager.java b/facebook/src/main/java/com/facebook/login/LoginManager.java
index 053d77c4e..7e2803fb0 100644
--- a/facebook/src/main/java/com/facebook/login/LoginManager.java
+++ b/facebook/src/main/java/com/facebook/login/LoginManager.java
@@ -29,7 +29,6 @@
 import android.support.v4.app.Fragment;
 
 import com.facebook.AccessToken;
-import com.facebook.AccessTokenSource;
 import com.facebook.CallbackManager;
 import com.facebook.FacebookActivity;
 import com.facebook.FacebookAuthorizationException;
@@ -584,19 +583,6 @@ private void finishLogin(
         }
     }
 
-    public static void setSuccessResult(Intent intent, Bundle values) {
-        Bundle bundle = intent.getBundleExtra(LoginFragment.REQUEST_KEY);
-        LoginClient.Request request =
-                (LoginClient.Request) bundle.getParcelable(LoginFragment.EXTRA_REQUEST);
-        AccessToken token = LoginMethodHandler.createAccessTokenFromWebBundle(
-                request.getPermissions(),
-                values,
-                AccessTokenSource.CHROME_CUSTOM_TAB,
-                request.getApplicationId());
-        LoginClient.Result result = LoginClient.Result.createTokenResult(request, token);
-        intent.putExtra(LoginFragment.RESULT_KEY, result);
-    }
-
     private static class ActivityStartActivityDelegate implements StartActivityDelegate {
         private final Activity activity;
 
diff --git a/facebook/src/main/java/com/facebook/share/internal/DeviceShareDialogFragment.java b/facebook/src/main/java/com/facebook/share/internal/DeviceShareDialogFragment.java
index ba25eed17..82bc20cef 100644
--- a/facebook/src/main/java/com/facebook/share/internal/DeviceShareDialogFragment.java
+++ b/facebook/src/main/java/com/facebook/share/internal/DeviceShareDialogFragment.java
@@ -110,9 +110,6 @@ public void onClick(View v) {
         instructions.setText(
                 Html.fromHtml(getString(R.string.com_facebook_device_auth_instructions)));
 
-        TextView title = (TextView)view.findViewById(
-                R.id.com_facebook_device_dialog_title);
-        title.setText(getString(R.string.com_facebook_share_button_text));
         dialog.setContentView(view);
 
         this.startShare();
diff --git a/facebook/src/main/java/com/facebook/share/widget/CreateAppGroupDialog.java b/facebook/src/main/java/com/facebook/share/widget/CreateAppGroupDialog.java
index 020dbdce6..b5b0e99c4 100644
--- a/facebook/src/main/java/com/facebook/share/widget/CreateAppGroupDialog.java
+++ b/facebook/src/main/java/com/facebook/share/widget/CreateAppGroupDialog.java
@@ -40,8 +40,11 @@
 import java.util.List;
 
 /**
- * A dialog for creating app groups
+ * @deprecated
+ * App and game groups are being deprecated. See
+ * https://developers.facebook.com/docs/games/services/game-groups for more information.
  */
+@Deprecated
 public class CreateAppGroupDialog
         extends FacebookDialogBase<AppGroupCreationContent, CreateAppGroupDialog.Result> {
 
@@ -51,8 +54,11 @@
             CallbackManagerImpl.RequestCodeOffset.AppGroupCreate.toRequestCode();
 
     /**
-     * Helper object for handling the result from a create app group dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static final class Result {
         private final String id;
 
@@ -70,21 +76,21 @@ public String getId() {
     }
 
     /**
-     * Indicates whether the create app group dialog can be shown.
-     *
-     * @return true if the dialog can be shown
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static boolean canShow() {
         return true;
     }
 
     /**
-     * Shows an {@link CreateAppGroupDialog} to create a group with the passed in content, using
-     * the passed in activity. No callback will be invoked.
-     *
-     * @param activity Activity hosting the dialog
-     * @param appGroupCreationContent Content describing the group to be created
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final Activity activity,
             final AppGroupCreationContent appGroupCreationContent) {
@@ -92,12 +98,11 @@ public static void show(
     }
 
     /**
-     * Shows an {@link CreateAppGroupDialog} to create a group with the passed in content, using
-     * the passed in fragment. No callback will be invoked.
-     *
-     * @param fragment android.support.v4.app.Fragment hosting the dialog
-     * @param appGroupCreationContent Content describing the group to be created
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final Fragment fragment,
             AppGroupCreationContent appGroupCreationContent) {
@@ -105,12 +110,11 @@ public static void show(
     }
 
     /**
-     * Shows an {@link CreateAppGroupDialog} to create a group with the passed in content, using
-     * the passed in fragment. No callback will be invoked.
-     *
-     * @param fragment android.app.Fragment hosting the dialog
-     * @param appGroupCreationContent Content describing the group to be created
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final android.app.Fragment fragment,
             AppGroupCreationContent appGroupCreationContent) {
@@ -124,25 +128,31 @@ private static void show(
     }
 
     /**
-     * Constructs a new CreateAppGroupDialog.
-     * @param activity Activity hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public CreateAppGroupDialog(final Activity activity) {
         super(activity, DEFAULT_REQUEST_CODE);
     }
 
     /**
-     * Constructs a new CreateAppGroupDialog.
-     * @param fragment android.support.v4.app.Fragment hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public CreateAppGroupDialog(final Fragment fragment) {
         this(new FragmentWrapper(fragment));
     }
 
     /**
-     * Constructs a new CreateAppGroupDialog.
-     * @param fragment android.app.Fragment hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public CreateAppGroupDialog(final android.app.Fragment fragment) {
         this(new FragmentWrapper(fragment));
     }
diff --git a/facebook/src/main/java/com/facebook/share/widget/JoinAppGroupDialog.java b/facebook/src/main/java/com/facebook/share/widget/JoinAppGroupDialog.java
index a373da9b5..00298627f 100644
--- a/facebook/src/main/java/com/facebook/share/widget/JoinAppGroupDialog.java
+++ b/facebook/src/main/java/com/facebook/share/widget/JoinAppGroupDialog.java
@@ -39,8 +39,11 @@
 import java.util.List;
 
 /**
- * A dialog for joining app groups
+ * @deprecated
+ * App and game groups are being deprecated. See
+ * https://developers.facebook.com/docs/games/services/game-groups for more information.
  */
+@Deprecated
 public class JoinAppGroupDialog extends FacebookDialogBase<String, JoinAppGroupDialog.Result> {
 
     private static final String JOIN_GAME_GROUP_DIALOG = "game_group_join";
@@ -49,8 +52,11 @@
             CallbackManagerImpl.RequestCodeOffset.AppGroupJoin.toRequestCode();
 
     /**
-     * Helper object for handling the result from a join app group dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static final class Result {
         private final Bundle data;
 
@@ -68,21 +74,21 @@ public Bundle getData() {
     }
 
     /**
-     * Indicates whether the join app group dialog can be shown.
-     *
-     * @return true if the dialog can be shown
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static boolean canShow() {
         return true;
     }
 
     /**
-     * Shows an {@link JoinAppGroupDialog} to join a group with the passed in Id, using
-     * the passed in activity. No callback will be invoked.
-     *
-     * @param activity Activity hosting the dialog
-     * @param groupId Id of the group to join
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final Activity activity,
             final String groupId) {
@@ -90,12 +96,11 @@ public static void show(
     }
 
     /**
-     * Shows an {@link JoinAppGroupDialog} to join a group with the passed in Id, using
-     * the passed in fragment. No callback will be invoked.
-     *
-     * @param fragment android.support.v4.app.Fragment hosting the dialog
-     * @param groupId Id of the group to join
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final Fragment fragment,
             final String groupId) {
@@ -103,12 +108,11 @@ public static void show(
     }
 
     /**
-     * Shows an {@link JoinAppGroupDialog} to join a group with the passed in Id, using
-     * the passed in fragment. No callback will be invoked.
-     *
-     * @param fragment android.app.Fragment hosting the dialog
-     * @param groupId Id of the group to join
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public static void show(
             final android.app.Fragment fragment,
             final String groupId) {
@@ -122,25 +126,31 @@ private static void show(
     }
 
     /**
-     * Constructs a JoinAppGroupDialog.
-     * @param activity Activity hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public JoinAppGroupDialog(final Activity activity) {
         super(activity, DEFAULT_REQUEST_CODE);
     }
 
     /**
-     * Constructs a JoinAppGroupDialog.
-     * @param fragment android.support.v4.app.Fragment hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public JoinAppGroupDialog(final Fragment fragment) {
         this(new FragmentWrapper(fragment));
     }
 
     /**
-     * Constructs a JoinAppGroupDialog.
-     * @param fragment android.app.Fragment hosting the dialog.
+     * @deprecated
+     * App and game groups are being deprecated. See
+     * https://developers.facebook.com/docs/games/services/game-groups for more information.
      */
+    @Deprecated
     public JoinAppGroupDialog(final android.app.Fragment fragment) {
         this(new FragmentWrapper(fragment));
     }
diff --git a/facebook/src/main/res/drawable/com_facebook_auth_dialog_background.xml b/facebook/src/main/res/drawable/com_facebook_auth_dialog_background.xml
index 2088e1b1c..77fd0a910 100644
--- a/facebook/src/main/res/drawable/com_facebook_auth_dialog_background.xml
+++ b/facebook/src/main/res/drawable/com_facebook_auth_dialog_background.xml
@@ -20,7 +20,7 @@
 -->
 
 <shape xmlns:android="http://schemas.android.com/apk/res/android">
-    <solid android:color="#f2fafafa" />
+    <solid android:color="@android:color/white" />
     <corners
         android:bottomLeftRadius="@dimen/com_facebook_auth_dialog_corner_radius"
         android:bottomRightRadius="@dimen/com_facebook_auth_dialog_corner_radius"
diff --git a/facebook/src/main/res/drawable/com_facebook_auth_dialog_header_background.xml b/facebook/src/main/res/drawable/com_facebook_auth_dialog_header_background.xml
index 3321bf82c..66cd5cff4 100644
--- a/facebook/src/main/res/drawable/com_facebook_auth_dialog_header_background.xml
+++ b/facebook/src/main/res/drawable/com_facebook_auth_dialog_header_background.xml
@@ -20,7 +20,7 @@
 -->
 
 <shape xmlns:android="http://schemas.android.com/apk/res/android">
-    <solid android:color="@color/com_facebook_blue" />
+    <solid android:color="#fffafafa" />
     <corners
         android:bottomLeftRadius="0dp"
         android:bottomRightRadius="0dp"
diff --git a/facebook/src/main/res/layout/com_facebook_device_auth_dialog_fragment.xml b/facebook/src/main/res/layout/com_facebook_device_auth_dialog_fragment.xml
index d90cce2a5..e0dcff318 100644
--- a/facebook/src/main/res/layout/com_facebook_device_auth_dialog_fragment.xml
+++ b/facebook/src/main/res/layout/com_facebook_device_auth_dialog_fragment.xml
@@ -34,7 +34,7 @@
 
         <RelativeLayout
             android:layout_width="300dp"
-            android:layout_height="wrap_content"
+            android:layout_height="100dp"
             android:background="@drawable/com_facebook_auth_dialog_header_background"
             android:orientation="horizontal">
 
@@ -50,51 +50,18 @@
                     android:layout_marginTop="11dp"
                     android:adjustViewBounds="false"
                     android:scaleType="fitXY"
-                    android:src="@drawable/com_facebook_favicon_white" />
+                    android:src="@drawable/com_facebook_button_icon_blue" />
             </FrameLayout>
 
             <TextView
-                android:id="@+id/com_facebook_device_dialog_title"
+                android:id="@+id/confirmation_code"
                 android:layout_width="wrap_content"
                 android:layout_height="wrap_content"
                 android:layout_centerInParent="true"
-                android:fontFamily="sans-serif-light"
+                android:fontFamily="roboto_condensed"
                 android:gravity="center"
-                android:text="@string/com_facebook_loginview_log_in_button_long"
-                android:textColor="@color/com_facebook_share_button_text_color"
-                android:textSize="13sp"
-                android:typeface="sans" />
-
-        </RelativeLayout>
-
-        <TextView
-            android:id="@+id/com_facebook_device_auth_instructions"
-            android:layout_width="match_parent"
-            android:layout_height="wrap_content"
-            android:layout_marginEnd="16dp"
-            android:layout_marginStart="16dp"
-            android:layout_marginTop="28dp"
-            android:fontFamily="sans-serif-light"
-            android:gravity="center_horizontal"
-            android:singleLine="false"
-            android:textColor="@color/com_facebook_device_auth_text"
-            android:textSize="14sp"
-            android:typeface="sans" />
-
-        <RelativeLayout
-            android:layout_width="wrap_content"
-            android:layout_height="wrap_content"
-            android:layout_gravity="center_horizontal"
-            android:layout_marginTop="14dp">
-
-            <TextView
-                android:id="@+id/confirmation_code"
-                android:layout_width="wrap_content"
-                android:layout_height="wrap_content"
-                android:layout_gravity="center_horizontal"
-                android:fontFamily="sans-serif-light"
-                android:textColor="@color/com_facebook_device_auth_text"
-                android:textSize="23sp"
+                android:textColor="@color/com_facebook_blue"
+                android:textSize="30sp"
                 android:typeface="sans"
                 android:visibility="invisible" />
 
@@ -108,13 +75,28 @@
                 android:layout_centerHorizontal="true"
                 android:layout_centerInParent="true"
                 android:layout_centerVertical="true" />
+
         </RelativeLayout>
 
+        <TextView
+            android:id="@+id/com_facebook_device_auth_instructions"
+            android:layout_width="match_parent"
+            android:layout_height="wrap_content"
+            android:layout_marginEnd="16dp"
+            android:layout_marginStart="16dp"
+            android:layout_marginTop="20dp"
+            android:fontFamily="roboto_condensed"
+            android:gravity="center_horizontal"
+            android:singleLine="false"
+            android:textColor="@color/com_facebook_device_auth_text"
+            android:textSize="12sp"
+            android:typeface="sans" />
+
         <FrameLayout
             android:layout_width="match_parent"
             android:layout_height="match_parent"
-            android:layout_marginBottom="14dp"
-            android:layout_marginTop="17dp">
+            android:layout_marginBottom="17dp"
+            android:layout_marginTop="14dp">
 
             <Button
                 android:id="@+id/cancel_button"
@@ -124,7 +106,7 @@
                 android:background="@drawable/com_facebook_auth_dialog_cancel_background"
                 android:clickable="true"
                 android:focusable="true"
-                android:fontFamily="sans-serif-medium"
+                android:fontFamily="roboto_condensed"
                 android:text="@android:string/cancel"
                 android:textAllCaps="true"
                 android:textColor="@color/com_facebook_device_auth_text"
diff --git a/facebook/src/main/res/values-af/strings.xml b/facebook/src/main/res/values-af/strings.xml
index 9994b3430..c5932dc6a 100644
--- a/facebook/src/main/res/values-af/strings.xml
+++ b/facebook/src/main/res/values-af/strings.xml
@@ -37,5 +37,5 @@
         prent.</string>
     <string name="com_facebook_share_button_text">Deel</string>
     <string name="com_facebook_send_button_text">Stuur</string>
-    <string name="com_facebook_device_auth_instructions">Besoek &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; op jou slimfoon of rekenaar en voer hierdie kode in:</string>
+    <string name="com_facebook_device_auth_instructions">Besoek &lt;b&gt;facebook.com/device&lt;/b&gt; op jou slimfoon of rekenaar en voer hierdie kode in:</string>
 </resources>
diff --git a/facebook/src/main/res/values-ar/strings.xml b/facebook/src/main/res/values-ar/strings.xml
index dd52785f1..946c6c9b8 100644
--- a/facebook/src/main/res/values-ar/strings.xml
+++ b/facebook/src/main/res/values-ar/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">      .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;         :</string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;         :</string>
 </resources>
diff --git a/facebook/src/main/res/values-bn/strings.xml b/facebook/src/main/res/values-bn/strings.xml
index 0a546bf9f..1fb7ec1d1 100644
--- a/facebook/src/main/res/values-bn/strings.xml
+++ b/facebook/src/main/res/values-bn/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">        </string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;       :</string>
+    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;       :</string>
 </resources>
diff --git a/facebook/src/main/res/values-cs/strings.xml b/facebook/src/main/res/values-cs/strings.xml
index 6d42db85d..ff7de1b51 100644
--- a/facebook/src/main/res/values-cs/strings.xml
+++ b/facebook/src/main/res/values-cs/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Pi stahovn obrzku dolo k neekan chyb.</string>
     <string name="com_facebook_share_button_text">Sdlet</string>
     <string name="com_facebook_send_button_text">Odeslat</string>
-    <string name="com_facebook_device_auth_instructions">Pejdte ze smartphonu nebo potae na &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; a zadejte tento kd:</string>
+    <string name="com_facebook_device_auth_instructions">Pejdte ze smartphonu nebo potae na &lt;b&gt;facebook.com/device&lt;/b&gt; a zadejte tento kd:</string>
 </resources>
diff --git a/facebook/src/main/res/values-da/strings.xml b/facebook/src/main/res/values-da/strings.xml
index 18ce2f66e..994356453 100644
--- a/facebook/src/main/res/values-da/strings.xml
+++ b/facebook/src/main/res/values-da/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Der opstod en uventet fejl under download af et billede.</string>
     <string name="com_facebook_share_button_text">Del</string>
     <string name="com_facebook_send_button_text">Send</string>
-    <string name="com_facebook_device_auth_instructions">G til &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; p din smartphone eller computer, og indtast denne kode:</string>
+    <string name="com_facebook_device_auth_instructions">G til &lt;b&gt;facebook.com/device&lt;/b&gt; p din smartphone eller computer, og indtast denne kode:</string>
 </resources>
diff --git a/facebook/src/main/res/values-de/strings.xml b/facebook/src/main/res/values-de/strings.xml
index d18a7b36a..0913a44e6 100644
--- a/facebook/src/main/res/values-de/strings.xml
+++ b/facebook/src/main/res/values-de/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Unerwarteter Fehler beim Herunterladen eines Bildes.</string>
     <string name="com_facebook_share_button_text">Teilen</string>
     <string name="com_facebook_send_button_text">Senden</string>
-    <string name="com_facebook_device_auth_instructions">Gehe ber dein Smartphone oder deinen Computer zu &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; und gib diesen Code ein:</string>
+    <string name="com_facebook_device_auth_instructions">Gehe ber dein Smartphone oder deinen Computer zu &lt;b&gt;facebook.com/device&lt;/b&gt; und gib diesen Code ein:</string>
 </resources>
diff --git a/facebook/src/main/res/values-el/strings.xml b/facebook/src/main/res/values-el/strings.xml
index 763ef0351..0d4699dcb 100644
--- a/facebook/src/main/res/values-el/strings.xml
+++ b/facebook/src/main/res/values-el/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">        .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">   &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;   smartphone         :</string>
+    <string name="com_facebook_device_auth_instructions">   &lt;b&gt;facebook.com/device&lt;/b&gt;   smartphone         :</string>
 </resources>
diff --git a/facebook/src/main/res/values-es-rES/strings.xml b/facebook/src/main/res/values-es-rES/strings.xml
index 6f16e91cf..bc0b08e39 100644
--- a/facebook/src/main/res/values-es-rES/strings.xml
+++ b/facebook/src/main/res/values-es-rES/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Error inesperado al descargar una imagen.</string>
     <string name="com_facebook_share_button_text">Compartir</string>
     <string name="com_facebook_send_button_text">Enviar</string>
-    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; en tu smartphone o computadora e ingresa este cdigo:</string>
+    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt; en tu smartphone o computadora e ingresa este cdigo:</string>
 </resources>
diff --git a/facebook/src/main/res/values-es/strings.xml b/facebook/src/main/res/values-es/strings.xml
index d542783f4..9a211ca6c 100644
--- a/facebook/src/main/res/values-es/strings.xml
+++ b/facebook/src/main/res/values-es/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Se produjo un error inesperado al descargar una imagen.</string>
     <string name="com_facebook_share_button_text">Compartir</string>
     <string name="com_facebook_send_button_text">Enviar</string>
-    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; en tu smartphone u ordenador e introduce este cdigo:</string>
+    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt; en tu smartphone u ordenador e introduce este cdigo:</string>
 </resources>
diff --git a/facebook/src/main/res/values-fi/strings.xml b/facebook/src/main/res/values-fi/strings.xml
index 712ea7111..3962c6cc3 100644
--- a/facebook/src/main/res/values-fi/strings.xml
+++ b/facebook/src/main/res/values-fi/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Odottamaton virhe kuvan palvelimesta lataamisen aikana.</string>
     <string name="com_facebook_share_button_text">Jaa</string>
     <string name="com_facebook_send_button_text">Lhet</string>
-    <string name="com_facebook_device_auth_instructions">Siirry osoitteeseen &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; lypuhelimella tai tietokoneella ja anna seuraava koodi:</string>
+    <string name="com_facebook_device_auth_instructions">Siirry osoitteeseen &lt;b&gt;facebook.com/device&lt;/b&gt; lypuhelimella tai tietokoneella ja anna seuraava koodi:</string>
 </resources>
diff --git a/facebook/src/main/res/values-fr/strings.xml b/facebook/src/main/res/values-fr/strings.xml
index 6db1554e9..d7a686d8b 100644
--- a/facebook/src/main/res/values-fr/strings.xml
+++ b/facebook/src/main/res/values-fr/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Une erreur inattendue sest produite au moment de tlcharger une image.</string>
     <string name="com_facebook_share_button_text">Partager</string>
     <string name="com_facebook_send_button_text">Envoyer</string>
-    <string name="com_facebook_device_auth_instructions">Rendez-vous sur &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; sur votre smartphone ou votre ordinateur et entrez ce code:</string>
+    <string name="com_facebook_device_auth_instructions">Rendez-vous sur &lt;b&gt;facebook.com/device&lt;/b&gt; sur votre smartphone ou votre ordinateur et entrez ce code:</string>
 </resources>
diff --git a/facebook/src/main/res/values-gu/strings.xml b/facebook/src/main/res/values-gu/strings.xml
index 12d239c2d..633e58a60 100644
--- a/facebook/src/main/res/values-gu/strings.xml
+++ b/facebook/src/main/res/values-gu/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">      .</string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;        :</string>
+    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;        :</string>
 </resources>
diff --git a/facebook/src/main/res/values-hi/strings.xml b/facebook/src/main/res/values-hi/strings.xml
index 7bd0b35b8..1784ecf2d 100644
--- a/facebook/src/main/res/values-hi/strings.xml
+++ b/facebook/src/main/res/values-hi/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">       .</string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;      :</string>
+    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;      :</string>
 </resources>
diff --git a/facebook/src/main/res/values-hr/strings.xml b/facebook/src/main/res/values-hr/strings.xml
index 5f68d1345..24cd1b72f 100644
--- a/facebook/src/main/res/values-hr/strings.xml
+++ b/facebook/src/main/res/values-hr/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Prilikom preuzimanja slike dolo je do neoekivane pogreke.</string>
     <string name="com_facebook_share_button_text">Dijeli</string>
     <string name="com_facebook_send_button_text">Poalji</string>
-    <string name="com_facebook_device_auth_instructions">Posjetite &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; na pametnom telefonu ili raunalu i unesite ovaj kd:</string>
+    <string name="com_facebook_device_auth_instructions">Posjetite &lt;b&gt;facebook.com/device&lt;/b&gt; na pametnom telefonu ili raunalu i unesite ovaj kd:</string>
 </resources>
diff --git a/facebook/src/main/res/values-hu/strings.xml b/facebook/src/main/res/values-hu/strings.xml
index 1aeee7076..e91c8444e 100644
--- a/facebook/src/main/res/values-hu/strings.xml
+++ b/facebook/src/main/res/values-hu/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Vratlan hiba trtnt egy kp betltse kzben.</string>
     <string name="com_facebook_share_button_text">Megoszts</string>
     <string name="com_facebook_send_button_text">Klds</string>
-    <string name="com_facebook_device_auth_instructions">Keresd fel a(z) &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; oldalt a telefonodrl vagy szmtgprl, s rd be a kvetkez kdot:</string>
+    <string name="com_facebook_device_auth_instructions">Keresd fel a(z) &lt;b&gt;facebook.com/device&lt;/b&gt; oldalt a telefonodrl vagy szmtgprl, s rd be a kvetkez kdot:</string>
 </resources>
diff --git a/facebook/src/main/res/values-id/strings.xml b/facebook/src/main/res/values-id/strings.xml
index 115bb6c09..76bbb24bc 100644
--- a/facebook/src/main/res/values-id/strings.xml
+++ b/facebook/src/main/res/values-id/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Kesalahan yang tidak diharapkan saat mengunduh gambar.</string>
     <string name="com_facebook_share_button_text">Berbagi</string>
     <string name="com_facebook_send_button_text">Kirim</string>
-    <string name="com_facebook_device_auth_instructions">Buka &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; dari smartphone Anda atau komputer dan masukkan kode ini:</string>
+    <string name="com_facebook_device_auth_instructions">Buka &lt;b&gt;facebook.com/device&lt;/b&gt; dari smartphone Anda atau komputer dan masukkan kode ini:</string>
 </resources>
diff --git a/facebook/src/main/res/values-it/strings.xml b/facebook/src/main/res/values-it/strings.xml
index a28cd2a6e..9e46b98bd 100644
--- a/facebook/src/main/res/values-it/strings.xml
+++ b/facebook/src/main/res/values-it/strings.xml
@@ -38,5 +38,5 @@
         caricamento di un\'immagine.</string>
     <string name="com_facebook_share_button_text">Condividi</string>
     <string name="com_facebook_send_button_text">Invia</string>
-    <string name="com_facebook_device_auth_instructions">Accedi a &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; nel tuo smartphone o computer e inserisci questo codice:</string>
+    <string name="com_facebook_device_auth_instructions">Accedi a &lt;b&gt;facebook.com/device&lt;/b&gt; nel tuo smartphone o computer e inserisci questo codice:</string>
 </resources>
diff --git a/facebook/src/main/res/values-ja/strings.xml b/facebook/src/main/res/values-ja/strings.xml
index 1e41192d9..858d388e5 100644
--- a/facebook/src/main/res/values-ja/strings.xml
+++ b/facebook/src/main/res/values-ja/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error"></string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">&lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;</string>
+    <string name="com_facebook_device_auth_instructions">&lt;b&gt;facebook.com/device&lt;/b&gt;</string>
 </resources>
diff --git a/facebook/src/main/res/values-kn/strings.xml b/facebook/src/main/res/values-kn/strings.xml
index 3aeaadd06..c3ca7a696 100644
--- a/facebook/src/main/res/values-kn/strings.xml
+++ b/facebook/src/main/res/values-kn/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">     .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;        :</string>
+    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;        :</string>
 </resources>
diff --git a/facebook/src/main/res/values-ko/strings.xml b/facebook/src/main/res/values-ko/strings.xml
index 4cf56e58f..c925e6ef7 100644
--- a/facebook/src/main/res/values-ko/strings.xml
+++ b/facebook/src/main/res/values-ko/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">      .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">  &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;     .</string>
+    <string name="com_facebook_device_auth_instructions">  &lt;b&gt;facebook.com/device&lt;/b&gt;     .</string>
 </resources>
diff --git a/facebook/src/main/res/values-ml/strings.xml b/facebook/src/main/res/values-ml/strings.xml
index ab5788b41..ff740a8ed 100644
--- a/facebook/src/main/res/values-ml/strings.xml
+++ b/facebook/src/main/res/values-ml/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">    .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;    :</string>
+    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt;    :</string>
 </resources>
diff --git a/facebook/src/main/res/values-mr/strings.xml b/facebook/src/main/res/values-mr/strings.xml
index 10ecc97e4..ab6105bb9 100644
--- a/facebook/src/main/res/values-mr/strings.xml
+++ b/facebook/src/main/res/values-mr/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">    .</string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;        :</string>
+    <string name="com_facebook_device_auth_instructions">     &lt;b&gt;facebook.com/device&lt;/b&gt;        :</string>
 </resources>
diff --git a/facebook/src/main/res/values-nb/strings.xml b/facebook/src/main/res/values-nb/strings.xml
index 86ec2c58f..1b909f5eb 100644
--- a/facebook/src/main/res/values-nb/strings.xml
+++ b/facebook/src/main/res/values-nb/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Det oppstod en uventet feil ved nedlasting av et bilde.</string>
     <string name="com_facebook_share_button_text">Del</string>
     <string name="com_facebook_send_button_text">Send</string>
-    <string name="com_facebook_device_auth_instructions">G til &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; p smarttelefonen eller datamaskinen din, og oppgi denne koden:</string>
+    <string name="com_facebook_device_auth_instructions">G til &lt;b&gt;facebook.com/device&lt;/b&gt; p smarttelefonen eller datamaskinen din, og oppgi denne koden:</string>
 </resources>
diff --git a/facebook/src/main/res/values-nl/strings.xml b/facebook/src/main/res/values-nl/strings.xml
index 4695792a1..cb9e6235d 100644
--- a/facebook/src/main/res/values-nl/strings.xml
+++ b/facebook/src/main/res/values-nl/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Onverwachte fout tijdens het downloaden van een afbeelding.</string>
     <string name="com_facebook_share_button_text">Delen</string>
     <string name="com_facebook_send_button_text">Verzenden</string>
-    <string name="com_facebook_device_auth_instructions">Ga op je smartphone of computer naar &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; en voer deze code in:</string>
+    <string name="com_facebook_device_auth_instructions">Ga op je smartphone of computer naar &lt;b&gt;facebook.com/device&lt;/b&gt; en voer deze code in:</string>
 </resources>
diff --git a/facebook/src/main/res/values-pa/strings.xml b/facebook/src/main/res/values-pa/strings.xml
index 2c8e186ce..391c572f4 100644
--- a/facebook/src/main/res/values-pa/strings.xml
+++ b/facebook/src/main/res/values-pa/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">         </string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">    \' &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;        :</string>
+    <string name="com_facebook_device_auth_instructions">    \' &lt;b&gt;facebook.com/device&lt;/b&gt;        :</string>
 </resources>
diff --git a/facebook/src/main/res/values-pl/strings.xml b/facebook/src/main/res/values-pl/strings.xml
index 92965e0a1..e0a49498b 100644
--- a/facebook/src/main/res/values-pl/strings.xml
+++ b/facebook/src/main/res/values-pl/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Nieoczekiwany bd podczas pobierania obrazu.</string>
     <string name="com_facebook_share_button_text">Udostpnij</string>
     <string name="com_facebook_send_button_text">Wylij</string>
-    <string name="com_facebook_device_auth_instructions">Przejd do &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; na smartfonie lub komputerze i wprowad ten kod:</string>
+    <string name="com_facebook_device_auth_instructions">Przejd do &lt;b&gt;facebook.com/device&lt;/b&gt; na smartfonie lub komputerze i wprowad ten kod:</string>
 </resources>
diff --git a/facebook/src/main/res/values-pt-rPT/strings.xml b/facebook/src/main/res/values-pt-rPT/strings.xml
index 7ecd4538f..6df0f03e5 100644
--- a/facebook/src/main/res/values-pt-rPT/strings.xml
+++ b/facebook/src/main/res/values-pt-rPT/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Ocorreu um erro inesperado ao descarregar uma imagem.</string>
     <string name="com_facebook_share_button_text">Partilhar</string>
     <string name="com_facebook_send_button_text">Enviar</string>
-    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; no teu smartphone ou computador e insere este cdigo:</string>
+    <string name="com_facebook_device_auth_instructions">Visita &lt;b&gt;facebook.com/device&lt;/b&gt; no teu smartphone ou computador e insere este cdigo:</string>
 </resources>
diff --git a/facebook/src/main/res/values-pt/strings.xml b/facebook/src/main/res/values-pt/strings.xml
index 5c5372d2f..9f09bbd33 100644
--- a/facebook/src/main/res/values-pt/strings.xml
+++ b/facebook/src/main/res/values-pt/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Erro inesperado ao baixar uma imagem.</string>
     <string name="com_facebook_share_button_text">Compartilhar</string>
     <string name="com_facebook_send_button_text">Envio</string>
-    <string name="com_facebook_device_auth_instructions">Acesse &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; no seu smartphone ou computador e insira este cdigo:</string>
+    <string name="com_facebook_device_auth_instructions">Acesse &lt;b&gt;facebook.com/device&lt;/b&gt; no seu smartphone ou computador e insira este cdigo:</string>
 </resources>
diff --git a/facebook/src/main/res/values-ru/strings.xml b/facebook/src/main/res/values-ru/strings.xml
index 8029cd41f..8f47ce62b 100644
--- a/facebook/src/main/res/values-ru/strings.xml
+++ b/facebook/src/main/res/values-ru/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">     .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;         :</string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;         :</string>
 </resources>
diff --git a/facebook/src/main/res/values-sk/strings.xml b/facebook/src/main/res/values-sk/strings.xml
index 714146c1a..c67312513 100644
--- a/facebook/src/main/res/values-sk/strings.xml
+++ b/facebook/src/main/res/values-sk/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Pri sahovan obrzka sa vyskytla neoakvan chyba.</string>
     <string name="com_facebook_share_button_text">Zdiea</string>
     <string name="com_facebook_send_button_text">Odosla</string>
-    <string name="com_facebook_device_auth_instructions">Navtvte &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; v smartfne alebo potai a zadajte tento kd:</string>
+    <string name="com_facebook_device_auth_instructions">Navtvte &lt;b&gt;facebook.com/device&lt;/b&gt; v smartfne alebo potai a zadajte tento kd:</string>
 </resources>
diff --git a/facebook/src/main/res/values-sv/strings.xml b/facebook/src/main/res/values-sv/strings.xml
index 8ddafab1c..af2f460e6 100644
--- a/facebook/src/main/res/values-sv/strings.xml
+++ b/facebook/src/main/res/values-sv/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Ovntat fel vid hmtning av en bild.</string>
     <string name="com_facebook_share_button_text">Dela</string>
     <string name="com_facebook_send_button_text">Skicka</string>
-    <string name="com_facebook_device_auth_instructions">Besk &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; p din smartphone eller dator och ange den hr koden:</string>
+    <string name="com_facebook_device_auth_instructions">Besk &lt;b&gt;facebook.com/device&lt;/b&gt; p din smartphone eller dator och ange den hr koden:</string>
 </resources>
diff --git a/facebook/src/main/res/values-ta/strings.xml b/facebook/src/main/res/values-ta/strings.xml
index 0c54447d9..95d878bee 100644
--- a/facebook/src/main/res/values-ta/strings.xml
+++ b/facebook/src/main/res/values-ta/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">    .</string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;  ,   :</string>
+    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt;  ,   :</string>
 </resources>
diff --git a/facebook/src/main/res/values-te/strings.xml b/facebook/src/main/res/values-te/strings.xml
index 4c3266afc..3421df3eb 100644
--- a/facebook/src/main/res/values-te/strings.xml
+++ b/facebook/src/main/res/values-te/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">     .</string>
     <string name="com_facebook_share_button_text"> </string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; ,    :</string>
+    <string name="com_facebook_device_auth_instructions">    &lt;b&gt;facebook.com/device&lt;/b&gt; ,    :</string>
 </resources>
diff --git a/facebook/src/main/res/values-th/strings.xml b/facebook/src/main/res/values-th/strings.xml
index cee546de4..f044656db 100644
--- a/facebook/src/main/res/values-th/strings.xml
+++ b/facebook/src/main/res/values-th/strings.xml
@@ -36,6 +36,6 @@
     <string name="com_facebook_image_download_unknown_error"></string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;  :</string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;  :</string>
 
 </resources>
diff --git a/facebook/src/main/res/values-tl/strings.xml b/facebook/src/main/res/values-tl/strings.xml
index 729867b5c..3d8fe9009 100644
--- a/facebook/src/main/res/values-tl/strings.xml
+++ b/facebook/src/main/res/values-tl/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Hindi inaasahang error habang dina-download ang imahe.</string>
     <string name="com_facebook_share_button_text">Ibahagi</string>
     <string name="com_facebook_send_button_text">Ipadala</string>
-    <string name="com_facebook_device_auth_instructions">Puntahan ang &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; sa iyong smartphone o computer at ilagay ang code na ito:</string>
+    <string name="com_facebook_device_auth_instructions">Puntahan ang &lt;b&gt;facebook.com/device&lt;/b&gt; sa iyong smartphone o computer at ilagay ang code na ito:</string>
 </resources>
diff --git a/facebook/src/main/res/values-tr/strings.xml b/facebook/src/main/res/values-tr/strings.xml
index 47d67494c..2e9595ffd 100644
--- a/facebook/src/main/res/values-tr/strings.xml
+++ b/facebook/src/main/res/values-tr/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Grsel indirilirken beklenmeyen hata.</string>
     <string name="com_facebook_share_button_text">Payla</string>
     <string name="com_facebook_send_button_text">Gnder</string>
-    <string name="com_facebook_device_auth_instructions">Akll telefonunda veya bilgisayarnda &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; adresine git ve bu kodu gir:</string>
+    <string name="com_facebook_device_auth_instructions">Akll telefonunda veya bilgisayarnda &lt;b&gt;facebook.com/device&lt;/b&gt; adresine git ve bu kodu gir:</string>
 </resources>
diff --git a/facebook/src/main/res/values-vi/strings.xml b/facebook/src/main/res/values-vi/strings.xml
index 9fcda0173..480478e3e 100644
--- a/facebook/src/main/res/values-vi/strings.xml
+++ b/facebook/src/main/res/values-vi/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error">Li bt ng khi ti nh xung.</string>
     <string name="com_facebook_share_button_text">Chia s</string>
     <string name="com_facebook_send_button_text">Gi</string>
-    <string name="com_facebook_device_auth_instructions">Truy cp &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; trn in thoi thng minh hoc my tnh v nhp m sau:</string>
+    <string name="com_facebook_device_auth_instructions">Truy cp &lt;b&gt;facebook.com/device&lt;/b&gt; trn in thoi thng minh hoc my tnh v nhp m sau:</string>
 </resources>
diff --git a/facebook/src/main/res/values-zh-rCN/strings.xml b/facebook/src/main/res/values-zh-rCN/strings.xml
index 57b984e4a..868a0fa2d 100644
--- a/facebook/src/main/res/values-zh-rCN/strings.xml
+++ b/facebook/src/main/res/values-zh-rCN/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error"></string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;</string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;</string>
 </resources>
diff --git a/facebook/src/main/res/values-zh-rHK/strings.xml b/facebook/src/main/res/values-zh-rHK/strings.xml
index 3a12cd231..3bb5b4a1d 100644
--- a/facebook/src/main/res/values-zh-rHK/strings.xml
+++ b/facebook/src/main/res/values-zh-rHK/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error"></string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt; </string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt; </string>
 </resources>
diff --git a/facebook/src/main/res/values-zh-rTW/strings.xml b/facebook/src/main/res/values-zh-rTW/strings.xml
index cc496cd12..914ca3023 100644
--- a/facebook/src/main/res/values-zh-rTW/strings.xml
+++ b/facebook/src/main/res/values-zh-rTW/strings.xml
@@ -36,5 +36,5 @@
     <string name="com_facebook_image_download_unknown_error"></string>
     <string name="com_facebook_share_button_text"></string>
     <string name="com_facebook_send_button_text"></string>
-    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;</string>
+    <string name="com_facebook_device_auth_instructions"> &lt;b&gt;facebook.com/device&lt;/b&gt;</string>
 </resources>
diff --git a/facebook/src/main/res/values/strings.xml b/facebook/src/main/res/values/strings.xml
index ca8ed5464..3cda9f6f5 100644
--- a/facebook/src/main/res/values/strings.xml
+++ b/facebook/src/main/res/values/strings.xml
@@ -36,7 +36,7 @@
     <string name="com_facebook_image_download_unknown_error">Unexpected error while downloading an image.</string>
     <string name="com_facebook_share_button_text">Share</string>
     <string name="com_facebook_send_button_text">Send</string>
-    <string name="com_facebook_device_auth_instructions">Visit &lt;b&gt;facebook.com/device&lt;/b&gt;&lt;br /&gt;on your smartphone or computer&lt;br /&gt;and enter this code</string>
+    <string name="com_facebook_device_auth_instructions">Visit &lt;b&gt;facebook.com/device&lt;/b&gt; on your smartphone or computer and enter this code</string>
 
     <!-- Picker additions from Scrumptious sample -->
     <string name="picker_placepicker_subtitle_format">%1$s  %2$,d were here</string>
@@ -45,5 +45,6 @@
     <string name="picker_picker_done_button_text">Done</string>
     <string name="choose_friends">Choose Friends</string>
 	<string name="nearby">Nearby</string>
+
 </resources>
 
diff --git a/facebook/src/test/java/com/facebook/appevents/AppEventTest.java b/facebook/src/test/java/com/facebook/appevents/AppEventTest.java
new file mode 100644
index 000000000..d20e42e7f
--- /dev/null
+++ b/facebook/src/test/java/com/facebook/appevents/AppEventTest.java
@@ -0,0 +1,79 @@
+/**
+ * Copyright (c) 2014-present, Facebook, Inc. All rights reserved.
+ *
+ * You are hereby granted a non-exclusive, worldwide, royalty-free license to use,
+ * copy, modify, and distribute this software in source code or binary form for use
+ * in connection with the web services and APIs provided by Facebook.
+ *
+ * As with any software that integrates with the Facebook platform, your use of
+ * this software is subject to the Facebook Developer Principles and Policies
+ * [http://developers.facebook.com/policy/]. This copyright notice shall be
+ * included in all copies or substantial portions of the software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
+ * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
+ * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
+ * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+package com.facebook.appevents;
+
+import android.os.Bundle;
+
+import com.facebook.FacebookTestCase;
+
+import org.junit.Assert;
+import org.junit.Test;
+
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.util.UUID;
+
+public class AppEventTest extends FacebookTestCase {
+    @Test
+    public void testChecksumOfAppEvent() throws Exception {
+        AppEvent appEvent = getTestAppEvent();
+        Assert.assertTrue(getTestAppEvent().isChecksumValid());
+        appEvent.getJSONObject().put("new_key", "corrupted");
+        Assert.assertFalse(appEvent.isChecksumValid());
+    }
+
+    @Test
+    public void testAppEventSerializedChecksum() throws Exception {
+        AppEvent appEvent1 = getTestAppEvent();
+
+        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
+        ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);
+        objectOutputStream.writeObject(appEvent1);
+
+        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(
+                byteArrayOutputStream.toByteArray());
+        ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);
+
+        AppEvent appEvent2 = (AppEvent)objectInputStream.readObject();
+        Assert.assertTrue(appEvent2.isChecksumValid());
+
+        // A secondary validation ensure that the json string matches the original
+        Assert.assertTrue(
+                appEvent1.getJSONObject().toString().equals(appEvent2.getJSONObject().toString()));
+    }
+
+    public AppEvent getTestAppEvent() throws Exception {
+        Bundle customParams = new Bundle();
+        customParams.putString("key1", "value1");
+        customParams.putString("key2", "value2");
+        AppEvent appEvent = new AppEvent(
+                "contextName",
+                "eventName",
+                1.0,
+                customParams,
+                false,
+                UUID.fromString("65565271-1ace-4580-bd13-b2bc6d0df035"));
+        appEvent.isChecksumValid();
+        return appEvent;
+    }
+}
diff --git a/facebook/src/test/java/com/facebook/login/CustomTabLoginMethodHandlerTest.java b/facebook/src/test/java/com/facebook/login/CustomTabLoginMethodHandlerTest.java
index 2d9f23209..4e50fc641 100644
--- a/facebook/src/test/java/com/facebook/login/CustomTabLoginMethodHandlerTest.java
+++ b/facebook/src/test/java/com/facebook/login/CustomTabLoginMethodHandlerTest.java
@@ -26,9 +26,11 @@
 import android.content.pm.ResolveInfo;
 import android.content.pm.ServiceInfo;
 import android.os.Bundle;
+import android.support.v4.app.Fragment;
 import android.support.v4.app.FragmentActivity;
 
 import com.facebook.AccessToken;
+import com.facebook.FacebookActivity;
 import com.facebook.FacebookException;
 import com.facebook.FacebookOperationCanceledException;
 import com.facebook.FacebookSdk;
@@ -194,6 +196,8 @@ private void mockTryAuthorize() {
         when(FacebookSdk.isInitialized()).thenReturn(true);
         mockStatic(AccessToken.class);
         when(AccessToken.getCurrentAccessToken()).thenReturn(null);
+        Fragment fragment = mock(LoginFragment.class);
+        when(mockLoginClient.getFragment()).thenReturn(fragment);
     }
 
     private void mockChromeCustomTabsSupported(final boolean supported, final String packageName) {
@@ -208,7 +212,7 @@ private void mockChromeCustomTabsSupported(final boolean supported, final String
         final PackageManager packageManager = mock(PackageManager.class);
         when(packageManager.queryIntentServices(any(Intent.class), anyInt()))
                 .thenReturn(resolveInfos);
-        activity = mock(FragmentActivity.class);
+        activity = mock(FacebookActivity.class);
         when(mockLoginClient.getActivity()).thenReturn(activity);
         when(activity.getPackageManager()).thenReturn(packageManager);
     }
diff --git a/samples/SwitchUserSample/src/com/example/switchuser/ProfileFragment.java b/samples/SwitchUserSample/src/com/example/switchuser/ProfileFragment.java
index cca057952..310e9ebe9 100644
--- a/samples/SwitchUserSample/src/com/example/switchuser/ProfileFragment.java
+++ b/samples/SwitchUserSample/src/com/example/switchuser/ProfileFragment.java
@@ -120,7 +120,7 @@ public void onActivityResult(int requestCode, int resultCode, Intent data) {
     public void onDestroy() {
         super.onDestroy();
         profileTracker.stopTracking();
-        accessTokenTracker.startTracking();
+        accessTokenTracker.stopTracking();
     }
 
     public void setOnOptionsItemSelectedListener(OnOptionsItemSelectedListener listener) {
diff --git a/samples/SwitchUserSample/src/com/example/switchuser/UserInfoCache.java b/samples/SwitchUserSample/src/com/example/switchuser/UserInfoCache.java
index c65e9fedd..2ac7fdb9a 100644
--- a/samples/SwitchUserSample/src/com/example/switchuser/UserInfoCache.java
+++ b/samples/SwitchUserSample/src/com/example/switchuser/UserInfoCache.java
@@ -42,7 +42,12 @@ public UserInfo get() {
         if(encodedToken == null) {
             return null;
         }
-        return decodeUserInfo(encodedToken);
+        UserInfo info = decodeUserInfo(encodedToken);
+        if (info.getAccessToken().isExpired()) {
+            clear();
+            return null;
+        }
+        return info;
     }
 
     public void put(UserInfo userInfo) {
